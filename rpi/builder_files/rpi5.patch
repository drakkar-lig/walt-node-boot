From patchwork Wed Feb  5 10:15:41 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042678
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=WIJfp6EJ;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp14g02MXz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:17:54 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id AA109808E6;
	Wed,  5 Feb 2025 14:15:33 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="WIJfp6EJ";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 19B21805E7; Wed,  5 Feb 2025 11:15:52 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 02693805E7
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:50 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=hYYbgEFWbesDjb6yYNEj82tecjd8lEWM9d4LSwMAble7UOZnJFvQMflD3Y4PjhQpV0OX/874CAgHzryL4iJXi8Segi8VJD8oloab5e0U4KSNw5S9GZCiat4X1FcQtZwKR31cXxwmizXgxdmzWsFcogEHbWLw/E5b51y8G7E6NkEQRJnXPAsQCVAz7fsl6YBwR9wZzewE7zjBCLhMjhP7fyVmDbq//qorIAWVHDXW7sdAd37h6SslEV4KdVPCXO4Eo5Z4DRF52qSB9Qyejopck2GJNFqn6dlHj4w9Hcii3mr8tmr2/LTAB+IF5PnRrPtKHh536Dmw+9PAvDcUMsemKQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=c+jQM9nRT8Ckyts9mE2QaZi3YgLK7kZoGQk7BSOekeI=;
 b=MuDD+THHQ3vdxi5MGWPFP7noBxRVEKsPjCl2IWLTnX1mK/kgkBzi6Q7XL4EcdXbpM8Pm8ZT/mT5eyOnDyjGkwvMv3Cug8CqVP0Y6Ly5kABvbxiH9a1ZNqE3LdsNyDRVjecmpVTuuRl9NzYo8jv/kkYCBJOPzFDqTVrQZNW1/7X/qoFXpn1sGSIufovE4SOzx+ITpDEjN4x1HOdvhNRMr4QyuzVlATd/ORvox9mRpJwgywmzqzaPJDQ6b3Ge+oDM8iVrwgYfSB4OTbbIrYsxvp3fh50qdnnH5qnRTOCnOV8WXOnA6NZ7ckA+iEatCXkRyji/Lak4qH6YE+AC8/tCewg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=c+jQM9nRT8Ckyts9mE2QaZi3YgLK7kZoGQk7BSOekeI=;
 b=WIJfp6EJVEZLK9MghsyKaWab+8UoumjDs3z9sqB7n6xo4nBUuNiedU5413dpdoJC9et5jerDpv2F+3IShqCqJAyuHosURtdJy+pPVbjO1+eRH/8pOfXsOasxHqftWhNpNYJHbMXuuQTIGBxK/lAiKfj8QVcfseqP6S2YemN/hkRNDB7Ur1fRDdvGdcQBAGhBigvPfSg0bC3tJy/NAK5hErFXyfh3eNUJoh325Q+vvhdBA/TV0sioG67wY4fSbILskyCux3pGU8xnYaDoHyT5hwajGHaR3bpVoGspUEyQfHgsZkXjlGG6cMTLvJMpNu1oCgdSUuvcM+Dve8/fRZpNrw==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:44 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:41 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 01/20] include: dt-bindings: clk: introduce bindings
 for rp1 clock
Thread-Topic: [RFC PATCH v1 01/20] include: dt-bindings: clk: introduce
 bindings for rp1 clock
Thread-Index: AQHbd7bpD0KJdoQLqEOfnUnOXvc65A==
Date: Wed, 5 Feb 2025 10:15:41 +0000
Message-ID: 
 <e6caf0dbfa861eb12e6298efa784a7184e2769c5.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: adf684ec-d2e7-4075-85eb-08dd45ce0bad
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?YsWVFn8xfHXc0hbhLAiWwLtLIi?=
	=?iso-8859-1?q?WIwsyZoSlq0kdqRf59E2T4tuVsZdVUK+nKavNszWWPehZjicWIIffPNdPqW3?=
	=?iso-8859-1?q?NljLupfjpWTQOEVuHOhkKxaVZ32mzw3JGa5zGKhEr/yokiWLjywdakpkMoxJ?=
	=?iso-8859-1?q?jZa7S3QGNnvLEy3K5LDIp08U7hkSoBsa15Wa688Wo/jN27vVekbr2M8Mza2l?=
	=?iso-8859-1?q?36oY1iO2eEeYdjUaZh5Kvhaowxmi4KDSxZfn5MhZxKQpJt2OJ9TqqJTWczWs?=
	=?iso-8859-1?q?6NBxLB4F2asaEknA3YyOj5eQ/kADXtue4halbOm7Y9r2ejfNuOsBhL69yJ5A?=
	=?iso-8859-1?q?9c9ePEsRzaPp/LWGhLLNfdIp8Lj+4GXXQ52fWeKVzyflRCnizRx1ndZ+wCB4?=
	=?iso-8859-1?q?Ww3ZEJYWp+ZOa1CzTJdkOGm/TNV8qjok+xSIHiM2iQn0s2NIlBEpT2THMMgq?=
	=?iso-8859-1?q?4hlCdZvxqJ+puT6ibtWDL984vgi967Nc2Jf84v83KehDzGSGDJcDrnJVGipH?=
	=?iso-8859-1?q?NnMqZ+bhWzPLVG9W9Q9aX64ed4EvsovmjM4zPvN1cnwe/WOCX7OfwfNbMNqe?=
	=?iso-8859-1?q?Y1Z5KoCGfZxAtM2bCdbKPquXAqzDN7wKZK+PVubxhDeWQjV6hk+eRzxSRecP?=
	=?iso-8859-1?q?QW4nKN3OjfYHyWb8bT289miTyyqFp5nSWiCeNUKWTe2MUYc48hMbRdQgMb5X?=
	=?iso-8859-1?q?JG6lUGzm7FPejY2U/xIXbS6/bDxSoWOjm30z77zG/Yof7PtCHXQjXaxTdp2f?=
	=?iso-8859-1?q?vpL3LlpVN3AwG1whD8FdGskySkUNkNA92HvOLtiK0B+yMNcqNyoZbdCAg8s5?=
	=?iso-8859-1?q?mTP1MNj6PJ53u7tgjorKppGke7jsW1+kBkwkzSoL79qp7TrqSiIqNjL6ZtWK?=
	=?iso-8859-1?q?Ta42bJ3mcDLueH9QnoH6bi9goyUccwFuEHxQCVuh92ALnpJVdz4pV9hpVhqk?=
	=?iso-8859-1?q?03EQ/xTRt5MA5sgmkpmCCP/kz/OjfN4dN9LgaECmx9a7xG+NVug4VDpNpR46?=
	=?iso-8859-1?q?aG5wzL5ce0W54ayz0kNzbF48G1SZzjaETK+AUh6rfDRaPfgRzTqBHJLvXcQ1?=
	=?iso-8859-1?q?0IwtVbvASzGFXvTI+MP2W7jF849CBfzFIEFim2WnTSt568AOzYBbF/ryEoUr?=
	=?iso-8859-1?q?XPhTDeN89Ws80jnJ98+BbkR4592PB2GUTk2Pct0CDZnB63YY5Tq5rV0HrsZs?=
	=?iso-8859-1?q?ao97+YrUeL1+NXnEIRl4QcFHk6dz9uahZjoHOV17pV1th72mOJrJeAWFpcg5?=
	=?iso-8859-1?q?FJyu3aQxpVrI85MiCHRUqly4wRCHLNlur1qIHLb0VV/YxGVEqjbx40pbDp0U?=
	=?iso-8859-1?q?Bm8HJW+JHlCw5TWb3Q6v1gY9i3gHe4JTfuZo0t/Ruvy+AiH4Azj4flJvAvP4?=
	=?iso-8859-1?q?Lf18wwGPUdOGTkMVJgUhY741JaF0KO2h6E/wxDx8w8ad8awmvrmSftzO50jK?=
	=?iso-8859-1?q?deEHeznV/C+pklCOg6mIphY+0Jp6H17JcDZgMr7peFpu9zSETyJZM0ptfiYV?=
	=?iso-8859-1?q?nXkEMp?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?XUdQt6kyI1Lkyo/gQEmUrCt?=
	=?iso-8859-1?q?uItZqGniuHkQmu8iKK/sdUcC9DrdXRi6Hl9P8BFN9MKHaiO6vJ/32wYJqMt1?=
	=?iso-8859-1?q?IPT6YZAIeFTkUViEdgBzNYR+4Q67ZD2RfUQ9WDjgq8LRYn3rFv8qe2OXPE85?=
	=?iso-8859-1?q?+G+wYmG7hOq46gEEaE8m6xqpxMOCuiPtOjOGefuUHdNd5dm12XYv6lJZTM3s?=
	=?iso-8859-1?q?mkTNeALfAeMVL88T3xWsqRsjv5URZdwCPMnOGIdkZjG6O6b3ORelsJ1RqzD/?=
	=?iso-8859-1?q?YoS++KWwnOSy0msgqkgzFXwVUEuouy186xOmdI86dD4H2z6xXBViXfOlKdyc?=
	=?iso-8859-1?q?KbQfM1sIOiqmsM0JywBLtBGiBat8tckOlby3DbToO+DTbutAa+d3QsEipFev?=
	=?iso-8859-1?q?eOfjveSPC1uEYComFPInXMDcL3ZzmdOdVvAQVIVuOcTLYG9oaK8kdcYTW/bg?=
	=?iso-8859-1?q?jFPALdvkeLx5nrHNhph+AZBduXyp3G+ppDEp5q3ZFCB/xlS/Zr+3RhOPZfCn?=
	=?iso-8859-1?q?RF4LTN8109/+V0SMwgbfWcb8a/4OWrEf1XWp6CgJRWwunDdQruiXaOlbA64d?=
	=?iso-8859-1?q?UGJtj5fhANo3FIL3AYnbjgXmtJkso75aqPaEMOfgNSevmW1plLyoLO8KXuwm?=
	=?iso-8859-1?q?FcRa3WQQEK7o6Pd5b5jARkzV7Uh2rTHyPl6dNvCAMjo2+FvsVAPa0cqL8KAn?=
	=?iso-8859-1?q?C/5xf9xbFhzpdrqOZA/7XFMsNS1ysBR3aCMSH01hef7bw5rBXL79FgxtwJ3N?=
	=?iso-8859-1?q?DaCmUTP4N+QRt0DW3WBrm72FNQ05WmT77iaV+zifzCuJ54GIw+/HZH0BG9sv?=
	=?iso-8859-1?q?QbidO0M6xLhM04IFqp4G1or93k6M6dAo8x1w5cbqdYk9YxuiIbvkBvOOvJUD?=
	=?iso-8859-1?q?TDPnYNR4NRXfx0tm7lchfB9NiQbXVRvgCDiPHLxw3xqgYTWjhO1gf9Ph2iER?=
	=?iso-8859-1?q?qz3BKIxh5MiHLvVmVfoDpnpCg/NRIfkHnYNGgHsFiOKPEyP0TsBVqjUJHzWM?=
	=?iso-8859-1?q?oTn8BYgTSLwBG6KjFDVQGa+19TqRiH9rbByJmlEgEw8AumfscRgsgf3Z8hBB?=
	=?iso-8859-1?q?xppTa1nwyT3wjQwzvGwKIiGrUwOMAR/gKZkGVPFWrrm1mkyF9CLL7cQFcauO?=
	=?iso-8859-1?q?ImncGYE0Ir5fFNyxxLXGPuPMebokDXHrq3dZbMCGu5oUGOms6vOrH/2Ub4wb?=
	=?iso-8859-1?q?3JGPmvI/TQVJ9/lxKDMPEZxEHOei1Ko0Q9DAtVDFjQKZFWtuPyFmvaQy09mB?=
	=?iso-8859-1?q?EiNzC/OF4QuUrDWQLR33FG4cFd4j/Bm04h1cAkSUS5/OeywA2cv3WgRa23C3?=
	=?iso-8859-1?q?JNzfIjk2oAo5LU9pzH4GxIwYcs9LV9RjiVtSPgwF4Q8Nde3UkWvPKYvrPrm/?=
	=?iso-8859-1?q?yPncm6VrRG/pMcScc9/n/YWWdF0ilBvK6NYRUcVgUj9dWZ2tUZxM51qvwAvv?=
	=?iso-8859-1?q?/J11536rMhoBQNXdAJPvetw1NMaiYjmOKK2uJV5pU5yTF6+Vep6cYRt/trW+?=
	=?iso-8859-1?q?ZmqBU1DF9soDZvFVeqXa3qpnYJqsPf7Q8zAzGxQvEki+wp/a91Slg+/QXDta?=
	=?iso-8859-1?q?QGGA8y0OTeN9zhxiWrFQdVZ/vPc7/UiwZq76Z2owsmywD0PZP0uMNu95ABDG?=
	=?iso-8859-1?q?GWnKevBNgz24QKrITMUv2xEXPSGLQ8f9M3j7Xzw=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 adf684ec-d2e7-4075-85eb-08dd45ce0bad
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:41.7368 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 WGxJoGo7bk+c7NmpeGnUw6S3PS5LdwRcK/hBcVuZ3IFxp0AePstv4gVodn+bhhJgKqLCC7LGoo1SLVLv3k2MSpjLYOe3vxxedM+Wr+M1bow=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Introducing device-tree bindings for the RP1 clocks.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 include/dt-bindings/clk/rp1.h | 56 +++++++++++++++++++++++++++++++++++
 1 file changed, 56 insertions(+)
 create mode 100644 include/dt-bindings/clk/rp1.h

diff --git a/include/dt-bindings/clk/rp1.h b/include/dt-bindings/clk/rp1.h
new file mode 100644
index 0000000000..27cbb6e130
--- /dev/null
+++ b/include/dt-bindings/clk/rp1.h
@@ -0,0 +1,56 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+/*
+ * Copyright (C) 2021 Raspberry Pi Ltd.
+ */
+
+#define RP1_PLL_SYS_CORE		0
+#define RP1_PLL_AUDIO_CORE		1
+#define RP1_PLL_VIDEO_CORE		2
+
+#define RP1_PLL_SYS			3
+#define RP1_PLL_AUDIO			4
+#define RP1_PLL_VIDEO			5
+
+#define RP1_PLL_SYS_PRI_PH		6
+#define RP1_PLL_SYS_SEC_PH		7
+#define RP1_PLL_AUDIO_PRI_PH		8
+
+#define RP1_PLL_SYS_SEC			9
+#define RP1_PLL_AUDIO_SEC		10
+#define RP1_PLL_VIDEO_SEC		11
+
+#define RP1_CLK_SYS			12
+#define RP1_CLK_SLOW_SYS		13
+#define RP1_CLK_DMA			14
+#define RP1_CLK_UART			15
+#define RP1_CLK_ETH			16
+#define RP1_CLK_PWM0			17
+#define RP1_CLK_PWM1			18
+#define RP1_CLK_AUDIO_IN		19
+#define RP1_CLK_AUDIO_OUT		20
+#define RP1_CLK_I2S			21
+#define RP1_CLK_MIPI0_CFG		22
+#define RP1_CLK_MIPI1_CFG		23
+#define RP1_CLK_PCIE_AUX		24
+#define RP1_CLK_USBH0_MICROFRAME	25
+#define RP1_CLK_USBH1_MICROFRAME	26
+#define RP1_CLK_USBH0_SUSPEND		27
+#define RP1_CLK_USBH1_SUSPEND		28
+#define RP1_CLK_ETH_TSU			29
+#define RP1_CLK_ADC			30
+#define RP1_CLK_SDIO_TIMER		31
+#define RP1_CLK_SDIO_ALT_SRC		32
+#define RP1_CLK_GP0			33
+#define RP1_CLK_GP1			34
+#define RP1_CLK_GP2			35
+#define RP1_CLK_GP3			36
+#define RP1_CLK_GP4			37
+#define RP1_CLK_GP5			38
+#define RP1_CLK_VEC			39
+#define RP1_CLK_DPI			40
+#define RP1_CLK_MIPI0_DPI		41
+#define RP1_CLK_MIPI1_DPI		42
+
+/* Extra PLL output channels - RP1B0 only */
+#define RP1_PLL_VIDEO_PRI_PH		43
+#define RP1_PLL_AUDIO_TERN		44

From patchwork Wed Feb  5 10:15:42 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042682
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=PgJ+1qai;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=85.214.62.61; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de [85.214.62.61])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp15M4fclz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:18:31 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 796518083F;
	Wed,  5 Feb 2025 14:15:36 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="PgJ+1qai";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 5AADC806C9; Wed,  5 Feb 2025 11:15:54 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 3188D806DC
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:50 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=W/igEf5bRXiknBHlyp0JgdFL3cDxiz5B4IHfZ5rIV5j9nLgCeUuMj3es7kpkr+uxcqYiLgmsjp1P1HmKvQM9xOIaZ3xRDtlNqJ6MizxVMnbJ1UymB28fM3+t+FYGeh+tWw7qXjIiWhW6cvP3qgn6rpCExMp7UyMVe7T3sAcB+kIATslb7KIJyq5nq5QZxgOG3WPT8VwjviveuSg9ePZw7pEWOGYqBCxxVkyINWjrvizhgJ76oxHwxdKFFyEnTmjfnZbbcsCK7Y4NX1AhpSPhT3NaVcnW80JV9kovud0lMdYJ9xnpHZnaAXzX115iL7ypfxWiWrHZXoQz/iqYM4JRVg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=VVXCfpV+F7cUSYS+VV9T4D8xGvfOAxU97UNq6AgGMs0=;
 b=HY16zzZjBhsYuNM4OeZEE1FRz90f06sYANHjg48tibSm6We0N7lI1RSLlcUxuqCl15opU1Nw90ltJ9mICLuc+vnzCiTek0edUPg2AcQQMHEIgMc29LYwEXbyKTgECYV31BmmRFxpLUI7s7YVIko049YX9e9703IPFwp2lt2IeaKcFdLCeKTG9LS+dMPUM//V6EnLpyQfBrQq1g3WppdpglnjpAl2k8QeqMn7alqPyMtbUEhACEp/naCNPlMGLDYY1c9nJOg0IQmlcOozHZTGLmOspwl4Gn+k4GRy0Qz/Pr1pYKYCWSeL92nqXm47S4gQp33F91XHSeBb5bJxRXHZjw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=VVXCfpV+F7cUSYS+VV9T4D8xGvfOAxU97UNq6AgGMs0=;
 b=PgJ+1qaiddbs8yDehQ13D1excuiRixgkQvhM59BKFJq/kf82elMv34CsgIQIuc+DWkt4OZNxJ0zRt9YHCYDwYZc1uAbJ5X/Fe80fzBGWopAQR+kZPoNbRDhaSlnD2y2gljJUlDqKCdLkc9gseg+66yNG7nwLDc42ZmaRqEVChrl5SX/UhzG3RV+iNCJxHmkv680Ef3LM5p82CBWZOWS0mRetI3djEmEJDyiKtmUdUr51hiBPkDeeY/F1RmsM2aozzNiA93w1AHWY5cnEmT0Y1tgeQ3lOsjhjVM3DuhhFxd7ecSvHbi+Mv2r21EmSQZGjcSWSFZbNoRZAuHgU3hBgTw==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:44 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:44 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 02/20] include: dt-bindings: mfd: introduce bindings
 for RP1 driver
Thread-Topic: [RFC PATCH v1 02/20] include: dt-bindings: mfd: introduce
 bindings for RP1 driver
Thread-Index: AQHbd7bpVwErdOpEIUy02zQldLHDbQ==
Date: Wed, 5 Feb 2025 10:15:42 +0000
Message-ID: 
 <af9a51c8c43bad746535ff1137555fbba4874a4a.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 1e87c994-db21-4340-633e-08dd45ce0d56
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?DnQDB4N4kr8a0tAnbRUmk5tUvT?=
	=?iso-8859-1?q?TljNYj3O0bbXdBPWFZ8OOugGCc4UzMftlZs6s5CneY0v1W3L5LVtd/f7BCuL?=
	=?iso-8859-1?q?NibD1KUAxVSRbTko7M6ZbNh1zMg3V9nx5s6F1ebKmuRLUpdImbABlehJ47Lp?=
	=?iso-8859-1?q?88SAHz5s83diXIN7N4MKUyEcNrlXV5tixnbMt3XdBstbdG7LaJzfhFReNO+G?=
	=?iso-8859-1?q?Zo4Bnaxybv8pQwU7rNrsl+eML2bXnRwKr6id+F5LD1WD4wfRZI0g7P7WN7Xd?=
	=?iso-8859-1?q?roCsTM7fdhoBVTgCkTC12IDYLOkfAOoXIbmK6FMxZi1mTpIiFTx+CS7CMf7t?=
	=?iso-8859-1?q?Msx1U+AFQtylVltm5sKT9hHMk9mWMPRqLX3Q1XbFtNbrCJHnsV3EERKo7Mqv?=
	=?iso-8859-1?q?MTNfxqQdGx9UreSqsU5wydYgnXC58Qpf/FxOoF6miyF9jUZFwba7Z0Q11e5e?=
	=?iso-8859-1?q?MYJ6c5L16KfNveMcyQbzqChuPVlQuKDjgR48C1kzkGcJMPEDiQZ7ry1UzSYa?=
	=?iso-8859-1?q?L78dnefI0yWHRYNx32JExI/lBmdQ2Oap72PNj8MFfKLhZHBcxUytaELoOzNV?=
	=?iso-8859-1?q?o4HwV5UnSsn3aTg4eZ2RzLwySCEjfr1ZzQNzY+uQJxlOb5MFpwTnuBTre+5U?=
	=?iso-8859-1?q?gzL5OYsPfvHkAxZ3sfNo64gZrucdDcLaqaTze2X3qYMbJz4SX4aErtwmCAzr?=
	=?iso-8859-1?q?psYbBVvUugrHLnOaHy09ek8fPu3OnF4QCXIUzj7lpwhUI3iOtOOSCAHP38QX?=
	=?iso-8859-1?q?c2FewauvbTHSQ5Kjlyb7oXsZIHINYB7hg60W/EDtWoxRPgHB/R9Jc92LUvMr?=
	=?iso-8859-1?q?oeaeCTF7OfEndytQEDZM6ZE3IRrv6/m/GK0sx2DKehuCmyEE0yMxm0bgX1TF?=
	=?iso-8859-1?q?NLDh5xqetvMm2LZphwpZNh85GJUZHpVoueOnEvpczHv/R4pBRlwcob/sCjhl?=
	=?iso-8859-1?q?9IDiGCtX3Pj9vvV2NsqynKrKuHTWKzRGYkmDBjVHtlXuseJKMNeR/MX2LTL/?=
	=?iso-8859-1?q?UV7VWXb6r3xgpQo6BkMbfzKuVqGR2GnkXqAkmwbSJtF3Uk5p5+douzZAHwFr?=
	=?iso-8859-1?q?V3g5tAm9sQOC3l8BggJGQwMNePXE+RYUFTOX9Yvw+Ug8YcjTnJTdXEm2E8nn?=
	=?iso-8859-1?q?chj5x2HMeo5mW+UTfgawB/slzIZvX38oEFC2AhMWtxcgsX9uiI4f96T/CEKl?=
	=?iso-8859-1?q?QXd4sSpTHuql1IcDzgF4BrhCn+FJeqK7VStRfzD3AdQlYvo2cmNLyfLbcYd0?=
	=?iso-8859-1?q?y+adv1YgaxK7o6JmIUGl0sJsb+sov6F8UyVdomx3jYr/yfbCikhWfoKq2sBz?=
	=?iso-8859-1?q?sTt03XEVsm81pRWOWuD+b5dm+Z7DPPYttuBIKhLhZJC51e+Q0MA/Gs7bpxb5?=
	=?iso-8859-1?q?lVXkUeCHZ8GciBfKu3KX5CagfY9e9sPuY3p+ZiMxbmbfxVpuAg9JtWx8u2d2?=
	=?iso-8859-1?q?AMrIpquvn27O24z1VZY3rqi0OffwJ8bAxWQ0jwQaHDhLM/l6tR61WylNreqS?=
	=?iso-8859-1?q?1eBAl7?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?3RNXD+T4aoM07jbuS3RaFo8?=
	=?iso-8859-1?q?hca8s32IU2CJY2egAzXtG15bJZqzHvfkWHrt0QGh1plc3Au3X+ALW/6StEcy?=
	=?iso-8859-1?q?ySlRHrSAryY1M9a9kYARRXx26zmjYbvPclnWKQJrfcF6x+gYDrqzvPqnly4L?=
	=?iso-8859-1?q?PwxQaucUkj2Tdl4WheONq7Jeijurxp2o5L9j4LWnitXqTFZuqjAkkt08UPzS?=
	=?iso-8859-1?q?tv3TW/e6ZsCbaqk74DV3fN1lpRiAWmdSbtz+9yZyHXytl++FIAab18gtS+SY?=
	=?iso-8859-1?q?eWJJpp1q+0jTQ6NoC43cmgSeMFK3McOF9v3OgGDxusULXhg4l6XvPnzGNHVJ?=
	=?iso-8859-1?q?GaeKKlKWNMD4kG45I30xCOrY0EVVOkNG+io7FNLYoCo4+GeeharxXgR2jHNY?=
	=?iso-8859-1?q?zLDhYc9aECJGNg77g8Bg901G2hgBfxGaT8k20xFjT1nM0wnnQs5lyda6xK8k?=
	=?iso-8859-1?q?E5urIwrfCkMgne/1/oGqfdyHZoCTzdeyko7eYNTQUDhPO0Jbi02rtA1ULCj0?=
	=?iso-8859-1?q?pll2GXnikehJBb1u2ssuoQyRsxVc/qCZEJpIj5TUPNypMnro2NaYMv7Rq8vy?=
	=?iso-8859-1?q?8B6DMCgubZPDpr1p7B99R0ZD0XXfDe4CnplfG5KmTpx03qI2ZusiRkWAIMaj?=
	=?iso-8859-1?q?9i+vGWPRYfdRxLGLWD71liOzmmXKfTYAtGoUdCro2pfHUF9qaDCJK6ATQFg5?=
	=?iso-8859-1?q?Twy583bXWWGt+QIbbaME0K4YJuiH75836PmdLFPTzRSyiwrz4bsgOhp58gt6?=
	=?iso-8859-1?q?xI0c0wXpCVKZt3RALYoAAh3ImCGs12mpzaej3u4tAYHPMZphfD8chDQqfyar?=
	=?iso-8859-1?q?HoJjbRvsRtoH4uITeQXM59ROnSTkXOrm7q+LL7k/AL58UtuvH10hTXHMC4L4?=
	=?iso-8859-1?q?eJGZ2jKiBwLcvR7lS72VOwXg9Ms7CgI9Hfr4U+Kq7eNkgMmxADctdE0esbAx?=
	=?iso-8859-1?q?WvCXPBBxoHW3/jzlBg9Fi/9NKMbUstsNBAwELlLgqdqbrpUbmQ7x8qMcrxPo?=
	=?iso-8859-1?q?J7oqax7yYRleKUJCPrQcajcm7IgeZ1DXWqHQ2aHFizaENxIh3Ip6sDXMXU/A?=
	=?iso-8859-1?q?Tdq1u8pmm9pvWwo3pOdBMefd9xqQQGOyohSHlb709gGXzE0Cpvt68tOuwUOI?=
	=?iso-8859-1?q?MjrqvIFiK5hrIavzSp4SivaG2q+0olkxMeXHWLFZR1LswlnjA4MBqSzXmw23?=
	=?iso-8859-1?q?zcGBJjrNVQ83FB0HdxyxBkr9hXkFCVXRbT0hayOw217iRKyaTK+Wi3bG1jBn?=
	=?iso-8859-1?q?mOVFJwVRyhMO8Z4C+Ljr4W2k/sFdBmAb6/xs3LXG+a2ZCH1VRTkcYbcd6TiD?=
	=?iso-8859-1?q?InZScZEPqz5fHTW3UUVp5hECKPob3edkUU7B3jG0HjqZ5l3CUe8fu8lxgnpR?=
	=?iso-8859-1?q?P9Qcjm5ckkWBW9rSo8PsXOteHBfyuBUsJv7S4OnVzgF+6jS/ZBHOaUiAHLPE?=
	=?iso-8859-1?q?GvMmMLLFlzwn1+yf6TeekvUKB5e1FXyJFgrz/qcXQE0uvp507ZOzHKqtY78A?=
	=?iso-8859-1?q?APaN8Gv5jW41xw6k4DGvGKFt0i0xXu759hxdluDDJ/0rNYXZPT1Slks4TgTJ?=
	=?iso-8859-1?q?Y9JD/TPNZYjdrJJZMkUDDIqf+e3kbsU9n9eMrEXra1VhGqreURCWQwnQYPph?=
	=?iso-8859-1?q?mIEP8q2YC1CdPiPHIZVcmqOs2aVDHEG2TVNjpQg=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 1e87c994-db21-4340-633e-08dd45ce0d56
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:42.1546 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 tMtx5BSsrFOGGapnrNcGBSYforSAdHUqS6dv4Zw1I5tJstnTXDvM3OHYNj4Hvf1lyH016rwZxc1L05hDJIARibnnIVdxKlCj+hyT3onfhpk=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Header includes all needed defines to be used in the device-tree
bindings.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 include/dt-bindings/mfd/rp1.h | 239 ++++++++++++++++++++++++++++++++++
 1 file changed, 239 insertions(+)
 create mode 100644 include/dt-bindings/mfd/rp1.h

diff --git a/include/dt-bindings/mfd/rp1.h b/include/dt-bindings/mfd/rp1.h
new file mode 100644
index 0000000000..fca5729deb
--- /dev/null
+++ b/include/dt-bindings/mfd/rp1.h
@@ -0,0 +1,239 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+/*
+ * This header provides constants for the PY MFD.
+ *
+ * Copyright (c) 2024 EPAM Systems
+ *
+ * Derived from linux rp1.h.
+ */
+
+#ifndef _RP1_H
+#define _RP1_H
+
+/* Address map */
+#define RP1_SYSINFO_BASE 0x000000
+#define RP1_TBMAN_BASE 0x004000
+#define RP1_SYSCFG_BASE 0x008000
+#define RP1_OTP_BASE 0x00c000
+#define RP1_POWER_BASE 0x010000
+#define RP1_RESETS_BASE 0x014000
+#define RP1_CLOCKS_BANK_DEFAULT_BASE 0x018000
+#define RP1_CLOCKS_BANK_VIDEO_BASE 0x01c000
+#define RP1_PLL_SYS_BASE 0x020000
+#define RP1_PLL_AUDIO_BASE 0x024000
+#define RP1_PLL_VIDEO_BASE 0x028000
+#define RP1_UART0_BASE 0x030000
+#define RP1_UART1_BASE 0x034000
+#define RP1_UART2_BASE 0x038000
+#define RP1_UART3_BASE 0x03c000
+#define RP1_UART4_BASE 0x040000
+#define RP1_UART5_BASE 0x044000
+#define RP1_SPI8_BASE 0x04c000
+#define RP1_SPI0_BASE 0x050000
+#define RP1_SPI1_BASE 0x054000
+#define RP1_SPI2_BASE 0x058000
+#define RP1_SPI3_BASE 0x05c000
+#define RP1_SPI4_BASE 0x060000
+#define RP1_SPI5_BASE 0x064000
+#define RP1_SPI6_BASE 0x068000
+#define RP1_SPI7_BASE 0x06c000
+#define RP1_I2C0_BASE 0x070000
+#define RP1_I2C1_BASE 0x074000
+#define RP1_I2C2_BASE 0x078000
+#define RP1_I2C3_BASE 0x07c000
+#define RP1_I2C4_BASE 0x080000
+#define RP1_I2C5_BASE 0x084000
+#define RP1_I2C6_BASE 0x088000
+#define RP1_AUDIO_IN_BASE 0x090000
+#define RP1_AUDIO_OUT_BASE 0x094000
+#define RP1_PWM0_BASE 0x098000
+#define RP1_PWM1_BASE 0x09c000
+#define RP1_I2S0_BASE 0x0a0000
+#define RP1_I2S1_BASE 0x0a4000
+#define RP1_I2S2_BASE 0x0a8000
+#define RP1_TIMER_BASE 0x0ac000
+#define RP1_SDIO0_APBS_BASE 0x0b0000
+#define RP1_SDIO1_APBS_BASE 0x0b4000
+#define RP1_BUSFABRIC_MONITOR_BASE 0x0c0000
+#define RP1_BUSFABRIC_AXISHIM_BASE 0x0c4000
+#define RP1_ADC_BASE 0x0c8000
+#define RP1_IO_BANK0_BASE 0x0d0000
+#define RP1_IO_BANK1_BASE 0x0d4000
+#define RP1_IO_BANK2_BASE 0x0d8000
+#define RP1_SYS_RIO0_BASE 0x0e0000
+#define RP1_SYS_RIO1_BASE 0x0e4000
+#define RP1_SYS_RIO2_BASE 0x0e8000
+#define RP1_PADS_BANK0_BASE 0x0f0000
+#define RP1_PADS_BANK1_BASE 0x0f4000
+#define RP1_PADS_BANK2_BASE 0x0f8000
+#define RP1_PADS_ETH_BASE 0x0fc000
+#define RP1_ETH_IP_BASE 0x100000
+#define RP1_ETH_CFG_BASE 0x104000
+#define RP1_PCIE_APBS_BASE 0x108000
+#define RP1_MIPI0_CSIDMA_BASE 0x110000
+#define RP1_MIPI0_CSIHOST_BASE 0x114000
+#define RP1_MIPI0_DSIDMA_BASE 0x118000
+#define RP1_MIPI0_DSIHOST_BASE 0x11c000
+#define RP1_MIPI0_MIPICFG_BASE 0x120000
+#define RP1_MIPI0_ISP_BASE 0x124000
+#define RP1_MIPI1_CSIDMA_BASE 0x128000
+#define RP1_MIPI1_CSIHOST_BASE 0x12c000
+#define RP1_MIPI1_DSIDMA_BASE 0x130000
+#define RP1_MIPI1_DSIHOST_BASE 0x134000
+#define RP1_MIPI1_MIPICFG_BASE 0x138000
+#define RP1_MIPI1_ISP_BASE 0x13c000
+#define RP1_VIDEO_OUT_CFG_BASE 0x140000
+#define RP1_VIDEO_OUT_VEC_BASE 0x144000
+#define RP1_VIDEO_OUT_DPI_BASE 0x148000
+#define RP1_XOSC_BASE 0x150000
+#define RP1_WATCHDOG_BASE 0x154000
+#define RP1_DMA_TICK_BASE 0x158000
+#define RP1_SDIO_CLOCKS_BASE 0x15c000
+#define RP1_USBHOST0_APBS_BASE 0x160000
+#define RP1_USBHOST1_APBS_BASE 0x164000
+#define RP1_ROSC0_BASE 0x168000
+#define RP1_ROSC1_BASE 0x16c000
+#define RP1_VBUSCTRL_BASE 0x170000
+#define RP1_TICKS_BASE 0x174000
+#define RP1_PIO_APBS_BASE 0x178000
+#define RP1_SDIO0_AHBLS_BASE 0x180000
+#define RP1_SDIO1_AHBLS_BASE 0x184000
+#define RP1_DMA_BASE 0x188000
+#define RP1_RAM_BASE 0x1c0000
+#define RP1_RAM_SIZE 0x020000
+#define RP1_USBHOST0_AXIS_BASE 0x200000
+#define RP1_USBHOST1_AXIS_BASE 0x300000
+#define RP1_EXAC_BASE 0x400000
+
+/* Interrupts */
+
+#define RP1_INT_IO_BANK0 0
+#define RP1_INT_IO_BANK1 1
+#define RP1_INT_IO_BANK2 2
+#define RP1_INT_AUDIO_IN 3
+#define RP1_INT_AUDIO_OUT 4
+#define RP1_INT_PWM0 5
+#define RP1_INT_ETH 6
+#define RP1_INT_I2C0 7
+#define RP1_INT_I2C1 8
+#define RP1_INT_I2C2 9
+#define RP1_INT_I2C3 10
+#define RP1_INT_I2C4 11
+#define RP1_INT_I2C5 12
+#define RP1_INT_I2C6 13
+#define RP1_INT_I2S0 14
+#define RP1_INT_I2S1 15
+#define RP1_INT_I2S2 16
+#define RP1_INT_SDIO0 17
+#define RP1_INT_SDIO1 18
+#define RP1_INT_SPI0 19
+#define RP1_INT_SPI1 20
+#define RP1_INT_SPI2 21
+#define RP1_INT_SPI3 22
+#define RP1_INT_SPI4 23
+#define RP1_INT_SPI5 24
+#define RP1_INT_UART0 25
+#define RP1_INT_TIMER_0 26
+#define RP1_INT_TIMER_1 27
+#define RP1_INT_TIMER_2 28
+#define RP1_INT_TIMER_3 29
+#define RP1_INT_USBHOST0 30
+#define RP1_INT_USBHOST0_0 31
+#define RP1_INT_USBHOST0_1 32
+#define RP1_INT_USBHOST0_2 33
+#define RP1_INT_USBHOST0_3 34
+#define RP1_INT_USBHOST1 35
+#define RP1_INT_USBHOST1_0 36
+#define RP1_INT_USBHOST1_1 37
+#define RP1_INT_USBHOST1_2 38
+#define RP1_INT_USBHOST1_3 39
+#define RP1_INT_DMA 40
+#define RP1_INT_PWM1 41
+#define RP1_INT_UART1 42
+#define RP1_INT_UART2 43
+#define RP1_INT_UART3 44
+#define RP1_INT_UART4 45
+#define RP1_INT_UART5 46
+#define RP1_INT_MIPI0 47
+#define RP1_INT_MIPI1 48
+#define RP1_INT_VIDEO_OUT 49
+#define RP1_INT_PIO_0 50
+#define RP1_INT_PIO_1 51
+#define RP1_INT_ADC_FIFO 52
+#define RP1_INT_PCIE_OUT 53
+#define RP1_INT_SPI6 54
+#define RP1_INT_SPI7 55
+#define RP1_INT_SPI8 56
+#define RP1_INT_SYSCFG 58
+#define RP1_INT_CLOCKS_DEFAULT 59
+#define RP1_INT_VBUSCTRL 60
+#define RP1_INT_PROC_MISC 57
+#define RP1_INT_END 61
+
+/* DMA peripherals (for pacing) */
+#define RP1_DMA_I2C0_RX 0x0
+#define RP1_DMA_I2C0_TX 0x1
+#define RP1_DMA_I2C1_RX 0x2
+#define RP1_DMA_I2C1_TX 0x3
+#define RP1_DMA_I2C2_RX 0x4
+#define RP1_DMA_I2C2_TX 0x5
+#define RP1_DMA_I2C3_RX 0x6
+#define RP1_DMA_I2C3_TX 0x7
+#define RP1_DMA_I2C4_RX 0x8
+#define RP1_DMA_I2C4_TX 0x9
+#define RP1_DMA_I2C5_RX 0xa
+#define RP1_DMA_I2C5_TX 0xb
+#define RP1_DMA_SPI0_RX 0xc
+#define RP1_DMA_SPI0_TX 0xd
+#define RP1_DMA_SPI1_RX 0xe
+#define RP1_DMA_SPI1_TX 0xf
+#define RP1_DMA_SPI2_RX 0x10
+#define RP1_DMA_SPI2_TX 0x11
+#define RP1_DMA_SPI3_RX 0x12
+#define RP1_DMA_SPI3_TX 0x13
+#define RP1_DMA_SPI4_RX 0x14
+#define RP1_DMA_SPI4_TX 0x15
+#define RP1_DMA_SPI5_RX 0x16
+#define RP1_DMA_SPI5_TX 0x17
+#define RP1_DMA_PWM0 0x18
+#define RP1_DMA_UART0_RX 0x19
+#define RP1_DMA_UART0_TX 0x1a
+#define RP1_DMA_AUDIO_IN_CH0 0x1b
+#define RP1_DMA_AUDIO_IN_CH1 0x1c
+#define RP1_DMA_AUDIO_OUT 0x1d
+#define RP1_DMA_PWM1 0x1e
+#define RP1_DMA_I2S0_RX 0x1f
+#define RP1_DMA_I2S0_TX 0x20
+#define RP1_DMA_I2S1_RX 0x21
+#define RP1_DMA_I2S1_TX 0x22
+#define RP1_DMA_I2S2_RX 0x23
+#define RP1_DMA_I2S2_TX 0x24
+#define RP1_DMA_UART1_RX 0x25
+#define RP1_DMA_UART1_TX 0x26
+#define RP1_DMA_UART2_RX 0x27
+#define RP1_DMA_UART2_TX 0x28
+#define RP1_DMA_UART3_RX 0x29
+#define RP1_DMA_UART3_TX 0x2a
+#define RP1_DMA_UART4_RX 0x2b
+#define RP1_DMA_UART4_TX 0x2c
+#define RP1_DMA_UART5_RX 0x2d
+#define RP1_DMA_UART5_TX 0x2e
+#define RP1_DMA_ADC 0x2f
+#define RP1_DMA_DMA_TICK_TICK0 0x30
+#define RP1_DMA_DMA_TICK_TICK1 0x31
+#define RP1_DMA_SPI6_RX 0x32
+#define RP1_DMA_SPI6_TX 0x33
+#define RP1_DMA_SPI7_RX 0x34
+#define RP1_DMA_SPI7_TX 0x35
+#define RP1_DMA_SPI8_RX 0x36
+#define RP1_DMA_SPI8_TX 0x37
+#define RP1_DMA_PIO_CH0_TX 0x38
+#define RP1_DMA_PIO_CH0_RX 0x39
+#define RP1_DMA_PIO_CH1_TX 0x3a
+#define RP1_DMA_PIO_CH1_RX 0x3b
+#define RP1_DMA_PIO_CH2_TX 0x3c
+#define RP1_DMA_PIO_CH2_RX 0x3d
+#define RP1_DMA_PIO_CH3_TX 0x3e
+#define RP1_DMA_PIO_CH3_RX 0x3f
+
+#endif

From patchwork Wed Feb  5 10:15:42 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042680
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=dvp1uJQX;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp1514tWPz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:18:13 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id C07B580B9C;
	Wed,  5 Feb 2025 14:15:34 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="dvp1uJQX";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 42ED38081A; Wed,  5 Feb 2025 11:15:54 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 8027580762
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:50 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=a7bUG3/Bmp/fFSNnIgksKi1UvCOg2UWiRyyJ6G+nBKXGkiHcYlfv+uqbCjFP7OlVZaqBOZB5BnPRLf/3HoBLH75199ik8fzIkOtdaOcq/Ax6vmgv+mEp92CXQmqZ1uNBBCVgDX+2HGrG2yi2WYqdNoEpTEGaP7t4l6sReImRXCoEhxzu3v3Q18yUaOZMW3sGkPsNpIjGOQi0e8MjRSsKvp67APF7+/R31RUBuW7jT6YCZ6/KCccB4qOR65EewEU9Ms9NIqIVnLchNk+VD7nH0ce6PG4cdB6weLJg9s5ETicJ0G6a2kDKd9HUOY/DKioyBfgKlqXxLJj4kdyVXq7HsA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=KTrz2XGzVYK3Hpzvz/BgLGdIXz2kyZHZ8gc5VwQ9phM=;
 b=M+SX947ATiAP4rvlEDj65IkYSG9hVscN16vKMug8/AFaqS17PRghtr6Wfvu5QsVfPsm24IyBlpXqFApxlYW6K/U2ULsc4nnZg3O4k6aEDNikwDJ1fKPsWfYNBFoWHo6fV+4/PE3XhIgVzIYdd7tzJY1kZ1u5YmFyRQcP03GsPs8SS7IItT4V5F68S2WkO1Aw9zYEq64ILAaGxMt8GAbwyyL5UbeYl2BVoM2vjvRfjnRN2Oe2QRwdDt99KiBfqWQKEjUZ1DXpJRvCn/cjEF+kBF6VtktMds862tBxDsUaty9FTrr7qF7pbUtIanO7HBMbf4oTYddXwX4KbOCdEKV8Iw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=KTrz2XGzVYK3Hpzvz/BgLGdIXz2kyZHZ8gc5VwQ9phM=;
 b=dvp1uJQXEnfk2LBrAuNMgSQUjLYr8JyaNthkSqItBigPN9fSmnQI/yCTrK7EJkozrU4ErNe95XOYOlJSE+/MAABDTU9vZu05GrittGT0BsG19Yqp6bMseUa4RehiFg78T5gztVJlUiQ8FU7QeRHps7CZT9Uuhc45LLOae0d3susTAbixF2nHk0tQsAMSYjZpbLj2zlrUHFICBrk3eaSo2nQvHz2+cK2wNah/0S9lKyXBIXyGQCa4xWEMLLit1eBnS5cyHvOoctvhQvlKGHSWEDMa8fMQL/C03pxI8Pq/L/rZ40asJnc2/TYeAHIWszAos/TEcRLeE+bGCdPx+0m/Zw==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:45 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:45 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Matthias Brugger
 <mbrugger@suse.com>, Peter Robinson <pbrobinson@gmail.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 03/20] arch: arm: mach-bcm283x: add pcie memory region
 to BCM2712 memmap
Thread-Topic: [RFC PATCH v1 03/20] arch: arm: mach-bcm283x: add pcie memory
 region to BCM2712 memmap
Thread-Index: AQHbd7bpNGKyKk2nz0GhDFVfccs8yA==
Date: Wed, 5 Feb 2025 10:15:42 +0000
Message-ID: 
 <6aa35ee2b1ea651f44bcfeea2e6d1d24002729d5.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: cfe0c84a-6da4-47c0-0c86-08dd45ce0dac
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?mG9DX5cAzmAPkCtlVblBGMZMX2?=
	=?iso-8859-1?q?YDON54Mwi7AIZrtKqui/3FqD1SoXUSLjrffOJ+CdDbbkRCGz2CXjnJeKcml7?=
	=?iso-8859-1?q?AbblQdbE1bb3pQyTc642ZOAYSl1GUGAE2l4AuDmDQ4FuG9QvgqWNMI/+w71a?=
	=?iso-8859-1?q?3ZZF/G2aFBDBjmnE37QDtsQ9F+cF9bZ5a2ZtPXEz9llGKLUriYOd5H2XGDI4?=
	=?iso-8859-1?q?NTq2tQ+Y9CqGdwd+1lzl9/CXnnK9wU11O6rTTidMTCj8IuMIG48M1DRolizK?=
	=?iso-8859-1?q?oW/aTB9MHRT78sV4vAcqQWYNoCQqfBYgYBqkZTNrFsLuuMClb9D/lkjqPGjY?=
	=?iso-8859-1?q?lp2a2hCOvkW9eaFVZZFocZYEruGl8/2zSD+0vel8/DyotNbIldR1KMG4jt/s?=
	=?iso-8859-1?q?wIRrhcdLnlohkHbA16V0PmYdi7JAoH+NvPjM9lv4HpezCKWB7kDiXmIlBC30?=
	=?iso-8859-1?q?Ja02OD9nJCexMc6rut9RdRXJmZP6hhWTiw7mg4nj3eueYfVcKp0aJ9uJC0Ge?=
	=?iso-8859-1?q?q7QIJlc++miE6+Ban7ytA8NgFZ635AekPe1fLre+pwj6IgZ+cP9iIQdNb9YS?=
	=?iso-8859-1?q?OvVKju/jvcJ3vOYQ1SBC/g1LL3Tc+bfGWVdaonxXUKL6GtIOqXfIEdv+x3fX?=
	=?iso-8859-1?q?emWWEkHzCsgHWZTOyjVBMNJcpXHcTo2sra7esAjgeFwQml+tGHqL1BNEJ64d?=
	=?iso-8859-1?q?A1LFN1tvLvm4Bd0FXHxeDQFAfHnXr1IFp0yeMWv2i3YB4TatRZIHghjMK3qo?=
	=?iso-8859-1?q?SQxp94i0CJveMvxxZOeKeTrjBjNcnEXvXBthBglHrgI2m/UaJ7HmAyZXlbNr?=
	=?iso-8859-1?q?Zcu6IbxBDUhih7EHQC3898XZ3WIVjqkhaS1CpN2J8M9X6W9ySQyOtkCejhef?=
	=?iso-8859-1?q?EGw9Z/AZew3nFZEhdAlzDjB5hBoSxBQ4KPK8Uq/6t4hGSef974SM8qgRX3UN?=
	=?iso-8859-1?q?/4addwfuxK/FdTNySIyGqJ/oAet+RM8f4ZQqWyk5VBo7+Z0OkD8TGlLra02A?=
	=?iso-8859-1?q?Ucnc46+AdHrkG8pcuuUdKzUQxPaGvAOzvIPWzDC6rMXxvUOX2+a6XTNiHS0B?=
	=?iso-8859-1?q?B1j6/siLp+GP+NEPiR+RkQZpyrdFCUiYmlkKWW1bX3MvREsDtktqK9rMGIIX?=
	=?iso-8859-1?q?lW1iTD3k5CiT4ollhYmaSIR9G1mDpCfOfmi+VCtO8oUuE2avTo1agPrdnbbX?=
	=?iso-8859-1?q?dwrsC5DarA7pSwDn0YsE8xb5n6HZG3VJAn58HzLprkPQqvpzASNhiEV8NpU1?=
	=?iso-8859-1?q?EpylLLiQ1x+Us8VhTI0kPUE5if7WwB1AIbE/V9TLP2vBuhOEHKvHFMV8gOwN?=
	=?iso-8859-1?q?VdFJgvewxduVg8PGZ/EAmpjS6T+PSS2S8rdJadJwyYrGTnAID5b+7wXZ+Nz8?=
	=?iso-8859-1?q?mxaAUFIY3gT9HMf+k0Bgmm0aU/Y2UaZwi78oQk4diFIkJpW0fp/krh5bMHxw?=
	=?iso-8859-1?q?+tETIG9jsg5whvrUhlzCsl3qJMfATSVMsETLu9GzLTO79edUUh7tSXsYPT87?=
	=?iso-8859-1?q?8WmA+M?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?wANMcyHl2NKBHV2pUFZwqBG?=
	=?iso-8859-1?q?UPMaI94nALrhJ/E658eu3S5H/PcqXOo8D3yevntnhti1eH4W6Ym1qt3+8z8+?=
	=?iso-8859-1?q?cNxz3Osq5dQDikuF0FLTpY/u4QELDkiSinexb9z/hbI7nAjMYf/0vFJKld/Y?=
	=?iso-8859-1?q?ElqQuKVFE6IWId/tLPXzUngFgvwP9FqeYBA68WiJgRYk6rhJLasqmC78ZhRf?=
	=?iso-8859-1?q?ZQkipJdgpN5rhuHUJc3sZSoV1HiQUKrKq/fPDr6Sk7rdPA7+csFluG6aQ1F1?=
	=?iso-8859-1?q?aDwaKPlwUwM4PzZgXuXAzcf0CybyFbaUcoanJ/LF20zQNLmnRLa4ZqYMhKga?=
	=?iso-8859-1?q?n9OCZ0NFLFXbVEKaU4MM8Y3udVzTNDMgRE2fuI1tdjIJu5SI181wEA4Or+hV?=
	=?iso-8859-1?q?EktANVmtqUM5mkZTh/fqTAg4wBQg/Crsmnn4jHyM+eMu1OH15Mv8PAk3zg73?=
	=?iso-8859-1?q?xvfOajG4Ex36qz4u/vhKvCeNQy16J0ZSQUEYJsdhiHJTyCK+0OxxmUzfyZ9E?=
	=?iso-8859-1?q?9jF9tS8QvRuWsvFPlpQXEgblZu0GbC+5Cx4KGytaKolRfisdqLoVgasYc0wK?=
	=?iso-8859-1?q?SU/unwohDcsBqfXytkhvtPriOjwI0HTB4Bgq51yE38C6uSu383ZEUiUeuMdV?=
	=?iso-8859-1?q?BG5JG4TUAR/zMRT4Zimg4nHdTfPsAgIEilzpm3bdLeFr1UbaS0Tz8Vm77MPf?=
	=?iso-8859-1?q?2LEY0z+spPR8hY6g277VaZhk/XYYTLxN+GWbJMq45a7hWOXhbXaTBp4px71M?=
	=?iso-8859-1?q?UyQpuMWmqrpVwenYbwzRsLK3tvc9j3XpiCjXj9itbF0PnYGKfvLqMZX1PvBz?=
	=?iso-8859-1?q?KSM/cerqwgs1u7w49FAQVMN9aPAKPvrRzP6KM9nKTYvCk++7YmObCUzSlxHu?=
	=?iso-8859-1?q?J7uSR7jHJXR/Pr4gsID2w+84/ZyoGopJVoQJbzbw5XXcjaX79IrEsX8T0wtq?=
	=?iso-8859-1?q?RPuBzgPlZdOM/0AUyc0zoFlVV0ffNtmsu9PEQHT6HJ6tugkk1iqn73iUp/pw?=
	=?iso-8859-1?q?xoEmsQ19HWbo5WMSi+TH8rB7WWPVa04GBIM5d5n2MC5Zy8FJjM1Hr3rBZl0a?=
	=?iso-8859-1?q?jPFYiBUbzqS19Ce5NwpVm52F9+6sRTglK4ge+8E0gwpKDAR4frSXwURXMcZ1?=
	=?iso-8859-1?q?UoY+8OqcfWkCLsxjUbHERL7QHkUq8Mb44BSjoAJ0G0WPttyJo3yrWT0EX/v4?=
	=?iso-8859-1?q?5DojEbz3ATAb8mtCmkhr2p5jBRkh74D3j9QmxWWIYoTXHQ+ceWXdWZeloTbH?=
	=?iso-8859-1?q?meyVhxhkqhKWwBYqIr2m4DGZm761l+ZGiyGcwg0XpphWqQKOwUERmqf7VaH6?=
	=?iso-8859-1?q?GIVgV7h1cuR8qZ1Gpl0pNCdDCkllz7sx5j/eQ7uHsGNb9ZjMPG5d7VXW/LCN?=
	=?iso-8859-1?q?210q2vZCfKp0TAoem62yR0eL1UgFFeKtjnLulXnWUbHk5DZCajslfcVxrsoO?=
	=?iso-8859-1?q?4CPmT7DyqNN5zEvugXmL45p6DAdtyIL2VT5nRy6+x4ACT1Ovn/Gkl9S6NNq/?=
	=?iso-8859-1?q?SsLaUlloYivo8f48DWKgdfgGoE0yzM+phci1NDvLC58Gry5MPTchQaTFz0Sb?=
	=?iso-8859-1?q?s7G/9r6zTGHdDa3K3dj6L4u/EWsI/8ywKJnfU4s4Duna4QjQsyAxb4BFOgGq?=
	=?iso-8859-1?q?Lx+F7IlNx9IqtYnJbYxP4wgbAUa2P/Q0oLF95Gg=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 cfe0c84a-6da4-47c0-0c86-08dd45ce0dac
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:42.8587 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 /8jmxDv3z7PoRaEc2guA2VRQHgVuJPYENzfOZQwQ1JcB2AcYlys6y2Ev0bPN9afbtFlsKIFH7T7INhHs3jKTkhTA+4bfBxQOnGAKxwbCAd8=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Update initial memory map for the BCM2712 board. Add PCIe memory
regions.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 arch/arm/mach-bcm283x/init.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/arch/arm/mach-bcm283x/init.c b/arch/arm/mach-bcm283x/init.c
index 016bc1eb41..284324c78d 100644
--- a/arch/arm/mach-bcm283x/init.c
+++ b/arch/arm/mach-bcm283x/init.c
@@ -19,7 +19,7 @@
 #ifdef CONFIG_ARM64
 #include <asm/armv8/mmu.h>
 
-#define MEM_MAP_MAX_ENTRIES (4)
+#define MEM_MAP_MAX_ENTRIES (5)
 
 static struct mm_region bcm283x_mem_map[MEM_MAP_MAX_ENTRIES] = {
 	{
@@ -84,6 +84,14 @@ static struct mm_region bcm2712_mem_map[MEM_MAP_MAX_ENTRIES] = {
 		.attrs = PTE_BLOCK_MEMTYPE(MT_DEVICE_NGNRNE) |
 			 PTE_BLOCK_NON_SHARE |
 			 PTE_BLOCK_PXN | PTE_BLOCK_UXN
+	}, {
+		/* Beginning of PCIe section */
+		.virt = 0x1f00000000UL,
+		.phys = 0x1f00000000UL,
+		.size = 0x0002000000UL,
+		.attrs = PTE_BLOCK_MEMTYPE(MT_DEVICE_NGNRNE) |
+			 PTE_BLOCK_NON_SHARE |
+			 PTE_BLOCK_PXN | PTE_BLOCK_UXN
 	}, {
 		/* SoC bus */
 		.virt = 0x107c000000UL,

From patchwork Wed Feb  5 10:15:43 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042683
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=gpo+lm3y;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=85.214.62.61; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de [85.214.62.61])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp15X5q9Kz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:18:40 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id D96C680A35;
	Wed,  5 Feb 2025 14:15:36 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="gpo+lm3y";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id C9B7A806C9; Wed,  5 Feb 2025 11:15:54 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 595BF8070F
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:50 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=WvoSyNS/znpmDKktm9mg9v+KSia/kSJIqDMd/YT6RGBh7KK1zlFX7b8Pm9IQzHLQ9HeTAt5q3e7a6vlM3hQxaQM8GFE/WPe1FGMk/s9KgzWzHkggk5poYYwVM8xRqLc3zdoCw1JYdqWtKKD7DSQJ54sysKWdffZa950MqmIZYRbxkHUtxQRHisrHHMJrNGX0iOM0MhYmXwlqy9BWECMlbO7AlTApY3Juemwsze5PqwMslczCwC4ozlRfsMQVfNyRLBcFuiuIcQlSufQy/ZELBwDpUek93jPiLnLDncWw8T9hEL98ZpOk5ZA7aDOLQKaB17VbgB/viq1XjBSpm+WOeg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=l4tTmO4QfO4rhACeXtAJegn2On7BXU9if5tQfs/yu9o=;
 b=xgdoqO84hXLkjo956gMdzsAddlbNVSvsfZI8dpV/EVQi8Nq7Nr7DrHYoP8MPF7k3mPblNLrAVr5UffOpSVoKiWnbicO41nVccIx1MX3OmkeGo0F6wgKmB6K63srnS6Ao3ssK9EL1EI6mWNYggkqbeUZyaqA9PqRaDQUXZU52NXDeorKg+2J5KOQAeI+vwE8BhF9YZXDRqvJ1JFP/wbDexaecL+6QzBZdvzIF0O01UZguQymKPxiwFrxeAxKRgz0hSSjdE5NkIhCPDQcBrUKQzt/cDMJT19Y1rA9sD9CZB0h+wWTY+aJ0zHFIO56CznAE1IdFe7YfioE7RR6w+MngDw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=l4tTmO4QfO4rhACeXtAJegn2On7BXU9if5tQfs/yu9o=;
 b=gpo+lm3ybo9MiXYsAYK2Om9Hs2gm/ui4K2PteGL9JCXEGtYrCEUGAJOxwqdHWsWmJL0Mux+V6/BypOkioVbS4R996TlTn9Qb8tEuViuZRw5QpAzqTz8nRLC9tjAiG1qqwFBrAJYAFiMIZrspC532j3CayVv19HGxA5gpVv2Q9A153FNFr/KS12M0R2x+sL97BcfGBxFXkZfr31o8or4BJkCtqGXWmdn335WLAnPJ64Q8ENtGrlNyeL0D+CIN9eztz1BcgK1glWkBxJD1t7yKjowLFU8oPgPwpRDIkTzwiuXbGt4zoJFPMLqw27h4PXXBlIVQ3ooE42AuVPKxCRAKPg==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:45 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:45 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Matthias Brugger
 <mbrugger@suse.com>, Peter Robinson <pbrobinson@gmail.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 04/20] arch: arm: mach-bcm283x: add BCM2712 board
 support
Thread-Topic: [RFC PATCH v1 04/20] arch: arm: mach-bcm283x: add BCM2712 board
 support
Thread-Index: AQHbd7bqW8a3v5ECeUuHqvHh5d2jzg==
Date: Wed, 5 Feb 2025 10:15:43 +0000
Message-ID: 
 <fd70dabe61df73e33bb2498570a9a849139e4019.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: f6a37023-4038-4d2c-7f25-08dd45ce0dd5
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?Y5S/o2ts3DuyTGhdgwa3SfXAfX?=
	=?iso-8859-1?q?YSz9Dmrw/PFnNFHIM1La8OVuaOJppizW4MkF20P2dSwgz/qE1ykRIRuo7Z6S?=
	=?iso-8859-1?q?xDQVWGE8Y5bJDWhQhLz+PG/WNcm5Thwky4Zqc2aDMAGyoqncMx/dlI11Zx9e?=
	=?iso-8859-1?q?jAhg0RQV46/0nCOb8LyyhtW0UTiwx1lBrV1gKjxnhay68uVPRBHriCeIIDh0?=
	=?iso-8859-1?q?Gw4a80tuIABwqa+q4uYI8PbtbX2e4zR7LDWtEDaNcww4j7zHsrpeevd626l2?=
	=?iso-8859-1?q?N8/gx4Ctr1sEA6IOM8cD/TXVXthxFjXC9OqJo7W919TksGGak/sWIsygnwp6?=
	=?iso-8859-1?q?+nQxeyQaPOAdHXnouJd+vI0awHXOh7Xf0l9DtNG2T9z5qXAeDCAPFzp4Mxhy?=
	=?iso-8859-1?q?nC8U5ujHSgiyQFh8PNty6h/ssl/XC4lyMtLqYZoTn4Rdov4kLo7rbdT6WM4k?=
	=?iso-8859-1?q?c9jx7JZg7IAtgb7DzNDZJ7chF2s98CoaQABLuSxPMPtv3RQeOsFnKtPnlt8N?=
	=?iso-8859-1?q?jJ21IPMPx+jpMKCRgoE5sUS2x38Xlp1ihetTWJgMRmtNoAt6sGAgBO8uQgEL?=
	=?iso-8859-1?q?rPEVTS+Ew3LW06QN/2qVDtb/t2zgZxQvwbsnSflhXM5BXKUZ0TRgGWXo7unP?=
	=?iso-8859-1?q?N4d//nvx8YXQlQD48acABDdPYvpDU1RkOw8aBVwsSw6Cn4ETX7/wwXjaKbhJ?=
	=?iso-8859-1?q?mYSHXL8SDA8vL8qrbnCySsNG/F0kDVxEmcwSDFnol+P7F1oLeMF+dIiiu80r?=
	=?iso-8859-1?q?kmel1RA7z76tiux+ayM0cK2spHfc6TbG5axNQ13JQFJM0qh4vGhLg/XAHQyy?=
	=?iso-8859-1?q?9mrhWPUF4u4p0saTi9FSspURufuV7LQ/PP86Ij5r76Hc9k95WYPqcHKfINwd?=
	=?iso-8859-1?q?h+IAUztIxDMRfRRhEHxM3qlSkx5GMKdBqC8TZ8CpJ6EcjaxBdNvBi8m8X/VY?=
	=?iso-8859-1?q?vhWjdPd/oCatC9Wn2KQtOxmMFrR/k16unE+6IiEsMqwrHIctZ7bCoU9y4OiU?=
	=?iso-8859-1?q?6T/GX8IQq1ljmTMzIDXfFoVOYWTqqYh8ORJOlnZ7TENzrmqFMbve3tqYTwnc?=
	=?iso-8859-1?q?Mb0D8yCBfzmug30GZGO+leVcLZ/04a05fQfBaPfgbzQsx8PVAJkTc+kray9s?=
	=?iso-8859-1?q?GTe6C1/V9Kw5m34qDTfBFe1AmeOX//uzYoRtixOG0h4DzGU+DX7fMJfbJ4rI?=
	=?iso-8859-1?q?zlj4NKJL/ur/IMWX0IkJ5d3ewMUaDSmi5834/Ipa4Z08ByxmmE94jOPyZnwI?=
	=?iso-8859-1?q?HfH0rB66rk2fw7MxS2PEqToCEmKIkxCZEA2W+7Mpvk16LmOasdYjQzBNBkpa?=
	=?iso-8859-1?q?i9Rlg219FgO1FbvXdgOMSjQ6M9JnBSD4WpHaAyBiMYPPqpxK/mtUXTssCn5M?=
	=?iso-8859-1?q?hzZCPrdHFGyP0sCWnNJnS04HqlOW1q+qzxSPfkJ44DXzn/6PLBFRL7fMlVdr?=
	=?iso-8859-1?q?Lc0PgfQn5xaJStyB2uRhUdfmQ+SneZcaXF895emKMWiukmZXNhFKMJsNpPX1?=
	=?iso-8859-1?q?9S/+AC?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?QcvvYjHyn6wG29Z8+q2Jola?=
	=?iso-8859-1?q?S5xlOhh5KpaXft7mHg/llSK3p8ADN43xGk0kgvlfMs9qZNB1ac+FENxS4aRD?=
	=?iso-8859-1?q?+CtUkgshGZxRZszU/gNn54nUsaCpumiimEJbHoMTKkumDl3WPIIPY5jjN8RD?=
	=?iso-8859-1?q?78fctZUtCJRP2tp4LZPGSHrGjHOTo7W2RvffvhnlbyYjP7gHhX4fHCesaC1+?=
	=?iso-8859-1?q?Dw2CjZIZZqk+6+CkQUTL6kADMwjy4+lpJB/1ZlreuJYx03JfN3FnPaxz99Q4?=
	=?iso-8859-1?q?42SKZA8rX/ieIOcvGMY8iiiSSAS/cak5DeYgyblB4GFlK3siw4FTdBM//4RD?=
	=?iso-8859-1?q?db+LJSH8e5EWaHIGBaek1GsvBXqV9csTgdj8eQNSWs2R99iuJVRng2WdAWdl?=
	=?iso-8859-1?q?RGf2ci8BXX1RZNnKpF+qtpD8yt0bZDHfXUgyt3EKOvDaO/F7YeogzUIBQHJ8?=
	=?iso-8859-1?q?NoO2buTwqOJJX0ClFu+Uk5d3Yh72f9WOCLSSFFcFRyiliHMow3OB6snuk7Da?=
	=?iso-8859-1?q?LNMt5VR+LRHIO/r2VD4+VjM+vTZ0fHXm1x/1soVyBxqS7X/sb5+saufhVND+?=
	=?iso-8859-1?q?04F12owajorv82GNhltMBbBqW1KAcNpdp7IqAypVd/paD2MoI0fC97LaA58a?=
	=?iso-8859-1?q?1iQ4FQuSFtKveif7YTDWaxBHQ7XcVQWN4iD8qFmhkUV9EvOqWQkr3U8SNDG2?=
	=?iso-8859-1?q?9rhosVGpqgDx8CMhWiUdZKZ1ISAc09Qb1posKbIlTlhhbj/0CCSaK3Mwqzjp?=
	=?iso-8859-1?q?qNc6gHnrxI5dn7sYGKt1eiURP+pxYn+s73FsCijRedn8ugrn/01cllU3AhBL?=
	=?iso-8859-1?q?T6b5W56VFXO1EYJGakA7PjNLA7idK6QDv11fPPo6W9JxJN9BmVh53WgRt31k?=
	=?iso-8859-1?q?Re3I5+fPhvgrIJKXewYGmB2WT2RlYIUnGiMc7id1Ai4CaSjeMezJQTMhXZm9?=
	=?iso-8859-1?q?9SBNnpCB/GzBTksciP7DD7VL7DaLZfYzNEsQIrD9NMmxNG84u52ADnOjj8Jk?=
	=?iso-8859-1?q?Tz2xLqCfEWRyGbR412PWU7GadzXjcz2VgshKLMS+dTAG/TOfuT0lmHi+OQQF?=
	=?iso-8859-1?q?Y5J7XrVCEnUQzfZWy/JomnLASDbgX/FjkB7xGgWrrYyJVEZqMWFqojRtvtTF?=
	=?iso-8859-1?q?5APASHhO8J16PjBSfS6K/g8HVxCsSEK3Ln6bIYC4Rpd9jvLo+P2n4F5xnQ8E?=
	=?iso-8859-1?q?5yOMnK5DrZRPGe8RpogrQruJ/WKUezM+jM5C6fq1399JrEBhULOTUfPHyXq6?=
	=?iso-8859-1?q?K/Icdvht3oq1+epGHKIhMzAXU8KbN3CuTmDkAnpux5H/vwVYjy6o/Pa69xiy?=
	=?iso-8859-1?q?SK7tJvOF7fM19ydZ0a1JiVas/Vb81eH4bHx+FaZAAhoOEOzegDvJl7bA9HCk?=
	=?iso-8859-1?q?k59pcD8n4YiUK6ijF4j1QMkACc4PtoG3I/UAA47NKYacqgGHZe9r0OKKT/kC?=
	=?iso-8859-1?q?E8Pbe3XLsc+uB1YgK8RmTP/htF5HbTcnzNakUJ7Cjq+Sua/E5WLtkV+rzobt?=
	=?iso-8859-1?q?KC/P0y4nJnPn2fs9OqhowM3YnqNpTTtUeuV0p1upQpDsBSY20uZBWH3QTuON?=
	=?iso-8859-1?q?J4MVAOm0C19nV2/2QpWRMXGObMTwWx1dcTfhX9GVaH1rGuAGeXtUHBXmbgJE?=
	=?iso-8859-1?q?5iShjjdnYPffPAYFc0DZUFlmr70DFLvDIvyWwvw=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 f6a37023-4038-4d2c-7f25-08dd45ce0dd5
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:43.1580 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 kiEI+QdFqnG/pIKKWS8QdCxh9DCsfYR/bRU94fr1toJEDUZMNwxEZLr2RHbvaJBImPerQkbus6p92F0ko6aSIPJbgQkIZoeNA5dvl2RASZE=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Add BCM2712 board support to U-Boot.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 arch/arm/mach-bcm283x/Kconfig | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/arch/arm/mach-bcm283x/Kconfig b/arch/arm/mach-bcm283x/Kconfig
index 6ce278c6d2..c7509146be 100644
--- a/arch/arm/mach-bcm283x/Kconfig
+++ b/arch/arm/mach-bcm283x/Kconfig
@@ -44,6 +44,10 @@ config BCM2711_64B
 	select BCM2711
 	select ARM64
 
+config BCM2712
+	bool "Broadcom BCM2712 SoC support"
+	depends on ARCH_BCM283X
+
 menu "Broadcom BCM283X family"
 	depends on ARCH_BCM283X
 

From patchwork Wed Feb  5 10:15:43 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042681
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=skcNKxE6;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp15B4l64z20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:18:22 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 2529B80BA0;
	Wed,  5 Feb 2025 14:15:35 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="skcNKxE6";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 502F780780; Wed,  5 Feb 2025 11:15:54 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id A9A528078B
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:50 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=FsaDKF4ifgmNEaVMSVerj6QdJVhGkokEM3rf3srKtAKXOtXGumDCGz+/iEt7N0wUV0rHuy6ArrbZ3oEXS+MskCbR6/EoZhZ+dpKXh4mc7pzNWfi1oysZT9Zm7NTcYKInagFS74e1Pca7japM3EPhYqHg1CN6RraS0abMyOIEHl0ZKz+ISOUtmofiZBbOiVJO/HZrDthXnIDffO50JK5DhMqDGsDYVz5oaGMC558NLqJV6EJe1YzimBPNKvV4f2XoTsFgb6N18KBRo642c5SDaEBLfAQObNaMcU1ZSsiX3ewFzm64FYsPBCduGZKNqzVEApIK+pmXz5OZXxNDFADEBA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=34wIgJz/wak422r06Oc/YeeP5pmQskdhQ2cJUoqa3oY=;
 b=n0yGfsfjl1S8hQZ1jmrNz8tvgbbtWj6COLrwAXCT+68GnI2ZCQQwClzKWTDHStS+vlI+UhZNCk9GXrqU5OFNPh08sxrQpqMCe4uwl6NxRbDivXh3kEnS1E485uBtcAexCQMnNT/hQA3WyQNFZhKhKyoEwzjMugWUpwrMkbwbOJPd5MrJEwxhotB5Riloh4fOqr+mkzbr6ZQ/bRY4n0Y/RE/X+scXm6QmP+qvILKLYnRZPUZPkeEhYvkbFDCQZWC/Y8A8MRafiI0Dj3VnhQ9kjBdUVjqEaDr9aFgPVXoTVANaMKscnAgGyyI6K0L+2KduI01JQjA0k45FjgYONrLkmg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=34wIgJz/wak422r06Oc/YeeP5pmQskdhQ2cJUoqa3oY=;
 b=skcNKxE60NNatrwBOSOdf2To7h7zWED+bK1pxZWQ2Hya9gzKREqIt2At9uFeIml1myjEMrWt7OopsPiA2HTng1ju0gyz/IKvpUSiEfrcaaHm/ovh89BlBzFkrVaLpZevTIvl7b4QjAXvzGALKJ78+5gNzIvDObdVnDZzyn1e1lLgrb5qpBLQosGIG6ra9TNrWo27gDM7zrvcbthFar7psH7CnMSagYESDau3SujdrnVe1OVbheJ/qEZ486JpRugR7UrtlEPH2tp4oxOb+la58HpTS8I3dTXz5AViCeCOCvToR9s2V5fkHeCtKg22jhKuKi89Ab5cZbDaZpMuWZUj7Q==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:45 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:45 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, BELOUARGA Mohamed
 <m.belouarga@technologyandstrategy.com>, Joe Hershberger
 <joe.hershberger@ni.com>, Ramon Fried <rfried.dev@gmail.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 05/20] drivers: net: macb: do not include arch/clk.h
 when clocks enabled
Thread-Topic: [RFC PATCH v1 05/20] drivers: net: macb: do not include
 arch/clk.h when clocks enabled
Thread-Index: AQHbd7bqbZ3i7h07JUyAGHxnPeCOww==
Date: Wed, 5 Feb 2025 10:15:43 +0000
Message-ID: 
 <2a2ea020033af7a2b7d92ce15d0111578cc09036.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: c1933e50-45dd-46b4-6781-08dd45ce0dfd
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?LcPGGUyiZGEeCwL+3fU/PZ4sKJ?=
	=?iso-8859-1?q?vvYenpZnnpX6vLkFPp9ISgGIkuefs0VuCe+7EWslqTaD4fgcmmxbihTiyxUh?=
	=?iso-8859-1?q?E/2wZR7RxYUKxd/u24rnK4lDA1GnvUTWZ7zcX/kcEbuEdn72kiTRZy0XCDy1?=
	=?iso-8859-1?q?KTDysaD9QS81ecL63pSnsr2atDZBMo62qLao86+UZRrLXiu1C07YN7p4Z2T2?=
	=?iso-8859-1?q?VHVbmlU9wz2z6UK1nvKRPfVlE3S2RXEchu2HF6hC7Yy8Ti3f8ZRbgmJlofkI?=
	=?iso-8859-1?q?ieqAwQ+DAD1gTCSMcrLTuGKJ9f1/p5uMIj8ze4zU6gd1BCSt9HDMBBrNORFB?=
	=?iso-8859-1?q?8iMopGl27II2VkchJfUEhBmWS2GCAJXDgn9QqV88dWRdyjaDonAzuXvShM/P?=
	=?iso-8859-1?q?9i6Be/NTCxk57SgllSLslZCltBzK8mK5ZvbNHEVMrcAHq7h0gku07UMqHq/l?=
	=?iso-8859-1?q?wJKA5YUKN5KK63lFeJagjRr9eTzU8P2/qEpBDqm8gZTvrB1Ml5o/xfN3t+Et?=
	=?iso-8859-1?q?qsdt0fS/mCVEvXU+bWyXF2tqM8Ot4cKIkRZ1/Ew66MRB3VWhcAIkK1reZONB?=
	=?iso-8859-1?q?dIpsPIA/e4GTe3nZ3YHdzJcxLUwVkwrlS1Yvr9uBfgAv04eepLaljI1/qnVh?=
	=?iso-8859-1?q?KJzEzuw0G2wRr9bK8emyyYsnXq9U3a342Bz+Blr8UGXjM/XOZh9feMYZheMP?=
	=?iso-8859-1?q?rhT5wxd/BCKuF22lljz4dJSw5LkRft5sxW6d+fuOtF4YE7jjTWmVsQzqz3wa?=
	=?iso-8859-1?q?8f+aNK/CY6NXtmVSZtzTryc9sfo8UhQC0GAMEpux0uL6pCTjCTclDhOVVBCQ?=
	=?iso-8859-1?q?Sse0oaCbfmyA3PH+HCR22r5Zvmhef7103xi5uI3vbkUFcdbzeRcQnFq37VNh?=
	=?iso-8859-1?q?wzPbDmSzUNZ0TKJeHzGjC8G/o4KGvLpQfo/onCwMkEtucdZuM9/ubG6uN6wY?=
	=?iso-8859-1?q?i6tnnYxdd8+X1Sz1mtRnYzF5cCxyrW77as2Qk/ok9QSGs4hGk+cl+U0WmIch?=
	=?iso-8859-1?q?JclU4CL7IhOCU8oUqeK1CAypanvcZZFE5bz4KW7iReJfNgEzOiOPdrKHDbex?=
	=?iso-8859-1?q?pQz/UB9uA69JIERYOs0FVSM8v0JTam4dRzPA1sVt48R5PzhBaxboCVLGDMkH?=
	=?iso-8859-1?q?nfd6VScK35hSCSRfVA/olHe/Yiwt78k/7F+z/uwwlxS6mhIoaFOiWBW9q/gs?=
	=?iso-8859-1?q?8Zh5XWxXooOUEP58a5OfPpBgC6qlzksvf7Bcm3uRZHxtRjt6h4FZrX2be2ot?=
	=?iso-8859-1?q?p2FSA8yA42m9lOCdQbbnanqs2BgkmcfdVofYdiio5g/+drX15K9WOVVLE4XJ?=
	=?iso-8859-1?q?M9vJNaS26ighDdpN97wkAV9tcRPGXwFJH0uVi0HNjkGiKWsaZKIowv1hNgB7?=
	=?iso-8859-1?q?ciDDuCjeW8v+VZxrVho/JiMWXzR+gR62hc/qEkkqEruc8de6O4baJUS6RmjS?=
	=?iso-8859-1?q?pZybXHfQmW4ZJM4XevGtGfadyfFaOzTYBrAVuw3zOeszVsEFSNRttgd1la/Y?=
	=?iso-8859-1?q?8WB6eM?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?V3tIAvs5Y20wnTMTTSATq5Z?=
	=?iso-8859-1?q?3jreRWK0rG5993MPBp0xDCm+UZext8bDzDlI3ujVEenziSEyIpS6vVCQT9/q?=
	=?iso-8859-1?q?Uz0Ac38MTfOfAYAkptGk+MK5CJvytTbA0hEqUlOSWL4p+5ifcvgKOuNEljWw?=
	=?iso-8859-1?q?GQZPyPruQUnrJwm8ziOu/7jNkeeVDpqcmJ7QOrSaWg1Zzq5eq26qfILAs+bl?=
	=?iso-8859-1?q?Dl4zoERkspIofWsCaU/52auywwEhQfNOg3COwZTtUpLyI8P8tSH/DmvbXbWa?=
	=?iso-8859-1?q?KzWpkLRoStJu0p88mXK90k8CJhC9/KbYWDpxx2OsKTGYpFnTIWJdJPGdAmLX?=
	=?iso-8859-1?q?bzWM0ZUf+8l9yQ/dArPpkdwcN9PIUcKHBvEeu315aYqwIbJMYz3uo8L5MuYc?=
	=?iso-8859-1?q?CT4mDgz+wbiT94F9v5HiOFlaqOg9pBwKjJvLdwe31D0AYlmd1lGsSbAwCvr4?=
	=?iso-8859-1?q?4/ZX0C9nUqT3KHCSh0Rr0EqT3Jjy8Ru5OPIfjdWCahRXR5uwsyNQe2JtEs8V?=
	=?iso-8859-1?q?CbVPhDgnzB4DdYRP9ALfp74aHHNKt+qnpeilCL2mfcKnLH8sEw206M1nfdIM?=
	=?iso-8859-1?q?I1b1iE/PEnM3EWHgQvCQXsDv1poqtyObAqUspQFmNpyCzXCPnlHl5vRmD/4o?=
	=?iso-8859-1?q?xr2JaxUAaiXYneclEXqEYtdoBDjjbMIsjtB9+qEVLznJUlmIbY2Il22UgDsF?=
	=?iso-8859-1?q?oRI8yUzCd0D540X03jlJiP7adrRnQKpQHdVTeBNripnP/wXxD72eWzsr5fzx?=
	=?iso-8859-1?q?SkJQ0q0cuLSh+UL359RxHU5+Qbp0kgZ/cm9P/JEu30pdndK2PwtRM6EizsGn?=
	=?iso-8859-1?q?+2NW/4bjp0ybpnGVVX5+7b6zx6EcmZRT1FbPzqa/i31uAmoplhrWHRSn4V1v?=
	=?iso-8859-1?q?MqCSk2gMj7sM6bfSZrrjb20MJNVyIRjtpzrrzmsIDam4YBCN4N1Cf81k/k44?=
	=?iso-8859-1?q?w9JE72MJiLMmoPRt5r7xsg9i5EF4Htij7NXjYFhxW+ZZSrlEcZOYsHfolWUd?=
	=?iso-8859-1?q?x3oUzF/XewH6Zt33zZWvI0qVHIbPm2tKVE5liVbl4MZT2ipSvNBDYKFF31Sc?=
	=?iso-8859-1?q?h6cchVIo+XDAvLB965FyXLTyKexJ6fWjdqlztXAgevuG/km2pd0MCeAbjsuz?=
	=?iso-8859-1?q?ksZbBmmL4HWbVMbvLwp8/ZaIExBodT4G2br7FFOxLELy3FWtZgoSezeW/oyg?=
	=?iso-8859-1?q?SuMg6GYB6CsisOfMR6g6++SBOuVQH26YHmrGQzx9fM9UiD3TKaXz/rFQxrUw?=
	=?iso-8859-1?q?m8x866ySrWtm8XMqjo7qFr+WjDrJE2pSPy7x8uTSzpY41HTUjRvO1Pr0H6nF?=
	=?iso-8859-1?q?MZe95AvjpteRXni37l89qXj4bH80Lj6q3+sGv7L7sgIa4vjjpA5AT1VeWOxY?=
	=?iso-8859-1?q?Z6AkazHdv6HG7nK4DYUKsxV2IDDFswYpU7OyMDNvzfWxQI+FKXXMNDp2Xw2O?=
	=?iso-8859-1?q?dxEA7a1F4u59OWtDP7X2Wvb/vENxFhwE24imERE1yLG+ZJFWQxfs4o15TSi9?=
	=?iso-8859-1?q?ZvkX390P5l6y001uL54hdS3LwXP/T9xOrlohqKYEtyCJufhopY6I+4L7hfp0?=
	=?iso-8859-1?q?xx/a5ZlIOt8DzLrmOGLjBeHM1aAHGoMm3g8Leu64YKH4goRwe8Sx9OXp0TL/?=
	=?iso-8859-1?q?JArcpweAEKre0mmvcoTy3uZ9YvbiM5Z9ON2iCBw=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 c1933e50-45dd-46b4-6781-08dd45ce0dfd
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:43.4705 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 DTAB4jdmBPHjaQbCIw6XdDSCBIl1hhnxy98fIcYKrLiroO08thzOLkUDDWeXEgHMs+m71uxp0tBSAiZ6AHGVu4tSh6tDdwTCkCHZ210dfUg=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

During initialization MACB should request clock rates to work
properly. If CONFIG_CLK is not set then it uses special arch call
named: 'get_macb_pclk_rate'
This function is arch specific and should return fixed rate for macb
clock even if clock subsystem was disabled.
When CONFIG_CLK is enabled there is no need to include arch specific
code and no need to declare 'get_macb_pclk_rate' call.
Added conditional to include arch/clk.h only if clock subsystem is
disabled.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/net/macb.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/net/macb.c b/drivers/net/macb.c
index bca014c3cb..a6a9a9b5d7 100644
--- a/drivers/net/macb.c
+++ b/drivers/net/macb.c
@@ -39,7 +39,9 @@
 #include <linux/mii.h>
 #include <asm/io.h>
 #include <linux/dma-mapping.h>
+#if !defined(CONFIG_CLK)
 #include <asm/arch/clk.h>
+#endif
 #include <linux/errno.h>
 
 #include "macb.h"

From patchwork Wed Feb  5 10:15:43 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042679
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=I3jrTw1v;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=85.214.62.61; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de [85.214.62.61])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp14r22cQz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:18:04 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 2CE1F80AE3;
	Wed,  5 Feb 2025 14:15:34 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="I3jrTw1v";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 35885807E2; Wed,  5 Feb 2025 11:15:54 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id D63AB807A7
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:50 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=YZIxdKKPXsqLiMXvxilj4OQ5/XMhPjDoEsmel6xGrNKLWtnia1tnnbr4RTGS6TCSOKSoQ/3xAgnJkMfO/7f9JNSZUV7B+7o9n/a+Lu+UQ0jJz2uiuzlb+vhCbJaqR01w6FNaCuf/rwIFbZA+HST32LiNwzG1DFBkgw1/c4XL4sqeKl5El3+4a1SYoZ8WsyDvyMKZQkp8v0rKFHl5Mz5wdiK+htxsNVaD6LTlwE8AEyLvjT8SSvYMFoEiD5DQX/BBkGaH/6nF92A3vZ18fzm2/wlBj6kidbpveUf6Va+UdK+GKGm120QojpCMQj+ioZjQSM9HU6AmRkgFHEQh2piRKg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=ZODOimQBfNbNO+adMZLJsgrW4Z0xnefAwIolxgSSIzw=;
 b=zJw7HrwWE/ozpoX6gLudh36z8UIZ6RNYk94hNDmw/sfIZN5qva52BjEqIil+/M4Ngwyyp8xY9igkQdc0SFeGxG+g737RjC8QpEiFPcDlFHvAJVJmhzK7AkfC9XCjem8LibULO2QJr1RzgiPTB5y8tNkZweIndLBZvAU57Z7YiNi9R+BcOXi22PO7KJew4laCPitCZLiGzTiR3Xj1EOyIhPLCLh178ps4Av6e/h7R3MudDbKVdYoCyTpvwiUjmuZMwQAwzpnqfbJG/T+XzxTw8gGHY7pLwgQWbwCji0cKJ5urVmW0JfK/OBuYVU2gZ/u0fQCN2+VJ7uDY6oEOvOq7YQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=ZODOimQBfNbNO+adMZLJsgrW4Z0xnefAwIolxgSSIzw=;
 b=I3jrTw1vla7nXQPrrDg3fuLJO/3EOqbBpozqpqXUu3L87zQtp+NDi4wt++nFPXe3/ECNBxiJnHotEAU1M29mEDLCNc7pFeU9RaXxTKBTBE4izUmwwVrWUjw+qI05L1b9cuL7wdZ7YDIxwLcCz/xkOkGVP8tWdRSY7+RZS4XXMZGyUmSKHgWnKdV1E09ycQJz4U5NuB/IIEpf1drXwC01ARagO/vyd+kH9IdCRSe1EyxbVcTzR3Oatkrb4U2Sd/dJgdeZY4BV86PXVaGD7lJ/utvPSSKXy8YWspsjcbY3OVzH4JIV5KlyK/M+TIXf7+Bc5SCBH0aX6tAadkzMNlMU0w==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:46 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:45 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>, Tom Rini
 <trini@konsulko.com>, Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
Subject: [RFC PATCH v1 06/20] drivers: pci: take into account that
 ofnode_read_pci_vendev can fail
Thread-Topic: [RFC PATCH v1 06/20] drivers: pci: take into account that
 ofnode_read_pci_vendev can fail
Thread-Index: AQHbd7bqyJo5gDYh10GiP53gpvkDEg==
Date: Wed, 5 Feb 2025 10:15:43 +0000
Message-ID: 
 <653f6ddd2821a7e27cdca5b7489204829123beac.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 7a132613-642d-49f2-f76c-08dd45ce0e28
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?AHrFxZYBuhKs7JlU9A5SIF51Ql?=
	=?iso-8859-1?q?u+BdkRWxmXLiMFuLbdkjGeXZKj/6xEqAfehcJ69Oo3qwIKIlsM3RfkKNM4QX?=
	=?iso-8859-1?q?lWkR3t24sJCv6rXv3YCQ2Ci7eVn2dP51Tuz70bEI8d0XSrYNaHbcXedQ6vM8?=
	=?iso-8859-1?q?cIcAjYRGtKF8KK2tEIUUwUBgfGHS0ntFDvk1TsOMVnaP1fgackhm4qa8Dp9f?=
	=?iso-8859-1?q?ZKrSqJBpmyf0t2S5xCpNX+aeDtBmMN51Ck6dPFbvhMnKVT+X6XI9aMaYaynm?=
	=?iso-8859-1?q?2Xyz8j9QDKLfX+F2C3JWZt9Y5nWBE1fhV2Gw4t5EMWRlSBxKec1HFP3g7LV+?=
	=?iso-8859-1?q?l6bea+gNSVrr3CqlfSSYDWIirqrNA2rRvf0PRBFem4GNGzQ8iex8UkZt7hKH?=
	=?iso-8859-1?q?BUnPZxGOa4u58kzgYIT2Z4f3xrW2e2VPb6ghzwHBjY7ajP0gytNvQ9wqKnFU?=
	=?iso-8859-1?q?SgBu1YDp2ssrs75qE99SbfTrkbGQ3+m/h2zMDwStunCm2sXWEwpPUOc5dwl6?=
	=?iso-8859-1?q?/6m4/7ynvsvPnABVAGcHUkFh7KDAZV9QVmNv7gBJ9yP0BgTTQ7oE2l7XoXg9?=
	=?iso-8859-1?q?5hJNlvhYRC9Oisip/Kr3QTa0q1YfbzcwVl7/GFW5pY4a4OYIO9yUueMM86Hk?=
	=?iso-8859-1?q?w4NB2OEBHrORM7xNP+xtw+gFpXRC5Cli05G2C81aUKYSJf79roSDRzH7xQdr?=
	=?iso-8859-1?q?sV2iYXALhMHfP3EXVzL3TtPk4Len119k8boUY80zd9DnjITYkLNfow0cIw/s?=
	=?iso-8859-1?q?q+PJ//jIY9RJXoJ30OVRaZr+xXAlXuraHi0CFw/2XgiYCfNgmhuOy8bJT76b?=
	=?iso-8859-1?q?vZbRS5tRzcJFmmePSykArOmsqxyp1cabtQWsm0SfHEXz+zPFGdjv2kUIEYmf?=
	=?iso-8859-1?q?/pGCHCLKo8ruxEDcnlxFRWfMTuU/0CGeypH3nBRJsAs5Je3qRM/S7ZmbhQ1y?=
	=?iso-8859-1?q?FxDESy6y8oaE9n+huos6beQtlDPdw5e4Lvz6wqGBCCYGsDxNQ/SAlYY5+XeE?=
	=?iso-8859-1?q?L4DxAXnkwSKQcSbFHKyaYdSne9MbGdXWQULFeB/A7kMCtd9j5U8QCp6gu1Ow?=
	=?iso-8859-1?q?Np1RCj8UPODv6pd9nXT1kCHnZC+a63cQAiULr5LrMFVUHkPNmCnPmhX1IJiB?=
	=?iso-8859-1?q?SjZ4lRXTjD40KiYFrtxPZ2cRqH2obqI50z9sEykx7iASfvF1/WH2BC0ZWWq8?=
	=?iso-8859-1?q?Y2i7h/a1y/5iUgFwhVoQUVCFlZ2SqzGn7mX8kWvCvlxB/fo/qQOvseC6f0MW?=
	=?iso-8859-1?q?HZKGaD3ZzSwVSjHu7Sz6qdnA9Zjtcy0zvP5CPCokdZOYN8NDF0DXlHvjzXn8?=
	=?iso-8859-1?q?z1TOfW3uTDqek+d6BP9Ew7Zvf5f3lnXlOBsx5XmUm+PZroxvJxJjKzUsIVHb?=
	=?iso-8859-1?q?iBmchPh7rlDEycAV4toNeXtFDlS3nwIbkathMaY/IYPMahwr45g8o3eDvIvw?=
	=?iso-8859-1?q?3ykWaJXGjvpX+cQT1MZO/qNHGzF7gbf2Xrw/KKJ2SemiE+nKb77ox4Ke3RAQ?=
	=?iso-8859-1?q?EvjSUt?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?8WV9Inc3caQrkuvrz2m6ioB?=
	=?iso-8859-1?q?+DnLRN7yLqU+OeDKn9Yg11XuXD2oZl/BLZwLqluFWi/2R87uMGo9ojqGG6DW?=
	=?iso-8859-1?q?w5VN7W5emQjwNrbgFqmEkG/QTKmY0+TsgBaoE5sHiijgYfw4m6LlsM4VtGWQ?=
	=?iso-8859-1?q?P5Ps+am+mIQ6gObibNRnYyl9N6cr0QZY76rPIFrA1nBM/U+t1Oawu+J3Ooun?=
	=?iso-8859-1?q?rsH4AbmU5AzG1PC8ESvlD3Aovejh8yx477cCBygOZk0dOhD7jgS53p8vwtI3?=
	=?iso-8859-1?q?Adp2855fNVHJ5mvkUPRVa1IOJ6bbAsbxpB4X59iRvsS9Lg1mZJIQJLiO1+Ka?=
	=?iso-8859-1?q?8v4ZOhOS5Zt1wOJ5iz/qO2J3nBXht7RVbQiiBBqWD/LNnZ++sprv51Zvv4Rr?=
	=?iso-8859-1?q?0zHgk50x9w9YmPGrxFptwY2p+e3dfC2NltuXG0BhezVO/6IsRDavJbc9jPYR?=
	=?iso-8859-1?q?N5vFBQhs/QGt0ZeIrBbS2DLQNWC04fjyQH0ld/f5VTInEwo5FhM9LcxqP5QZ?=
	=?iso-8859-1?q?s+/LOXPVpTFxiJOT6RB9NGRlbszF/ZP2bW5o5QVDWaOFjHmJ8rwmj/rO+X6V?=
	=?iso-8859-1?q?7OEbLPOhCL0+kd+AJNn6+7g9k79yxGG0t5n2swZqQSp9BFanjADVy/8EWb4z?=
	=?iso-8859-1?q?8Lsg9s+an/4O1q/BfwZ9fWgz7fwOHA/MCC8JSfCkFg3bzRN8xuETl9IqeSTv?=
	=?iso-8859-1?q?UkfcAIy6VB2PmX3hMygqWwx83HeiGsrh2dkhFDV6uIokZL7QbEH6xc+tfLK2?=
	=?iso-8859-1?q?sIgUZGtUhUBfKZc5xm79IeSJOG6maZNfKHsFT+7aAgjvHXs0A9Es3VxNyJZC?=
	=?iso-8859-1?q?ZiVvMi7nrm+jnQ/MlWvIHwaaaHFD/yuxLZCyEhyWfX3G8YUENCJje7/zOMJF?=
	=?iso-8859-1?q?Wvo5ZJhwq6SoMEcqrbNcS1ARwLwJhZp04baWFxxAH6cK6jYk3iDO0hsSLrBh?=
	=?iso-8859-1?q?NBw27HkcgygPIkqJAJR2Hb37Gq2Xb91FhvCDqvR/Z0yqyjZhi2Rhov1V/xOp?=
	=?iso-8859-1?q?uAUOvqeRC81fc3MBh5KPbBM8fiYng8olZLByaCl8rakbCZEmaLE4/zvnWftn?=
	=?iso-8859-1?q?jbKFyqGXfTyjuKMGkeDwq2/cwWfHFazw+0b4lMYEqyg7tCAsoRP/5Zrx8pTH?=
	=?iso-8859-1?q?O0p1/CoAOqYBst8fmw9reTA4bxC5+lvyDoW1mRLBQ6DWz8fpMoMdiStzjCUw?=
	=?iso-8859-1?q?1/Odb5YNVGTWNou2LUdsdAKVFQs6V0oOXVAReDHwupTFHN/gScR/9Fw9pglZ?=
	=?iso-8859-1?q?t8+NG1JuKIG6iEn2H8e4Y6xum7wpBZZU5/cwjVN4qaSs5aBZJRw61bMjC/yY?=
	=?iso-8859-1?q?X5BqTYoeY9UbaIcA31z59qQr2oPWFh4ZkZ+PFyen2+bDHcMvvZ5a+W66T1AX?=
	=?iso-8859-1?q?MdFzzzghpETtdO3JwOxuVuTU4Vc/XiGDXGdhNbA16SWUg8tk4aEynZgLYwDG?=
	=?iso-8859-1?q?pTMKPqGpOtj0fTeh+NXrQK94FVP51naIhfMwkT2oODePHXi6ssiY+8l/hAkm?=
	=?iso-8859-1?q?9h3o5kB2TqKLW2UnAsMuXEeRh8EeR0njIkxd+u0wa/465G3/HlaQW8leDNoh?=
	=?iso-8859-1?q?JjVT2Uhw6EJbBAuztYrN2usNAhoK3zOwHNjP29gYT92+/H49juZmXNEM/Dv0?=
	=?iso-8859-1?q?rYMWqAVVEsn3JyRdV/OxLKtGRpUJPjQ64vyYyZw=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 7a132613-642d-49f2-f76c-08dd45ce0e28
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:43.7292 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 KfB+KF/LTjHDWc0OENheuwv5j6+L5stLUjkbGf2H7xz/T+yJEkYCBOpfBYz9UbEutXx2AigAQ1NOhWBZ/vta1vTJY5IFH7yd0XLpki0u9mw=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

From: Volodymyr Babchuk <volodymyr_babchuk@epam.com>

Prior to this fix devfn was set to 0, which lead to funny consequences
because PCI subsystem tried to use RP1 driver as a host bridge driver.

Signed-off-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
---

 drivers/pci/pci-uclass.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/drivers/pci/pci-uclass.c b/drivers/pci/pci-uclass.c
index 1a48256de0..18b94583b6 100644
--- a/drivers/pci/pci-uclass.c
+++ b/drivers/pci/pci-uclass.c
@@ -1187,6 +1187,7 @@ static int pci_uclass_post_probe(struct udevice *bus)
 static int pci_uclass_child_post_bind(struct udevice *dev)
 {
 	struct pci_child_plat *pplat;
+	int err;
 
 	if (!dev_has_ofnode(dev))
 		return 0;
@@ -1194,7 +1195,13 @@ static int pci_uclass_child_post_bind(struct udevice *dev)
 	pplat = dev_get_parent_plat(dev);
 
 	/* Extract vendor id and device id if available */
-	ofnode_read_pci_vendev(dev_ofnode(dev), &pplat->vendor, &pplat->device);
+	err = ofnode_read_pci_vendev(dev_ofnode(dev), &pplat->vendor,
+				     &pplat->device);
+	if (err) {
+		/* Set invalid devfn if OF node describes not a PCI device */
+		pplat->devfn = -1;
+		return 0;
+	}
 
 	/* Extract the devfn from fdt_pci_addr */
 	pplat->devfn = pci_get_devfn(dev);

From patchwork Wed Feb  5 10:15:44 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042686
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=JlcK3JSw;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=85.214.62.61; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de [85.214.62.61])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp1645vzrz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:19:08 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id E501280BAE;
	Wed,  5 Feb 2025 14:15:37 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="JlcK3JSw";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 7CA7F80834; Wed,  5 Feb 2025 11:15:56 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 0E052807A8
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:51 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=wXL9Jl9lPRoYa2uXGTC7txOlSlBbJ/Q/goHzBqOH2gWtKM3Gq84AR0isE7RbEZ9NiZ/Zkj3cPz2nqhlaEhqFIiAcb73Og1J5pD4YHlORKZa6FbwkwyMBKk+N8dqoUnOse6ZcUFyO1UO8bW9bWpikF7wO4Uk3SDuMhFv2UEg8Np6ryGjCuBAQIEHr+A4HMOGCKXVuatNZOs84DdPR5gPpgruz1B3MCQzMEhIQn1kXNN8aJC3pCilBoH+AYGwB7P5WFbKnjvRXi8oxiiMIvkFvQOR6ldKiPhcCYixi+SgP5wxAFoV4i24ftbOFpg3nH0cfI/5XQbwOYuSd3FU83rf3BQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=W+oPQYrzcw6CKs7ok229ID17TeL0Ecdtn1XrXAufYog=;
 b=oEWjkYz3284SV12XQTFgApf/0Uyf6fLEgKSVWIU2njnKDwrFFL32/dTtZqL5c0wnGU62zfTGR5MjbuW8ED4qsHWXWqRdA5tHEg5d9oJlcJtaatEf15/ahmZNqC7HZnYXtAHK/H5fqnARJ1IkpTW1sGdXF597MCpeBqKEmO9DjzDye3Hci3b0PH6XDMqCyM30ksI5EV5kROdHs7yUGYkulLe6HNBxxw2eZUvrKJFUDG31FUNt7WT+/W4b4rCviDZAM4tnMLQz8lGgY9Xjvdy1txnjbejUsXmzAOh2CvXU5Nsv4/m9aJVSaW9ra4zZAGT6CDjgK6Ww827d95mW4FvuiA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=W+oPQYrzcw6CKs7ok229ID17TeL0Ecdtn1XrXAufYog=;
 b=JlcK3JSw2Eg9NbMev418cu1b4T9mUOMpbIzDD49agtEUcLAFI8qR9zbsuMa+8zebyPxROn5uXK0iwRoh9l/TcOhJE+mztMWY+u8uKXozic/xLSTs1acXjkmfegN/eKHn8rgghLXSsayrezW245XTEiTh2/rDh3uGxiB7TnzLVZKpMCFq6PkgdlgYysfeAFHSUz40sssLzjxh8pt37cK/M6d7OMgv46n1kSwwNVzLWcStJIIgXljM4x8pEHrmcWk25A+uLyWk75KcpBmAX9o8d+PK58TzVU/vybdkLZAkDst+zicy/o4w1sx0NlfF7qRMhak6qDId3xBAnZe7DkTVGQ==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:46 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:46 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Simon Glass
 <sjg@chromium.org>, Tom Rini <trini@konsulko.com>, Volodymyr Babchuk
 <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 07/20] drivers: core: of_addr: fix of_get_dma_range
 translation
Thread-Topic: [RFC PATCH v1 07/20] drivers: core: of_addr: fix
 of_get_dma_range translation
Thread-Index: AQHbd7bqedGTJgUEtkmE323GIj3JzQ==
Date: Wed, 5 Feb 2025 10:15:44 +0000
Message-ID: 
 <01e25a1ae3bee800a953945961a16816425f9295.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 4555482a-77dd-472a-e8db-08dd45ce0e4d
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?utf-8?q?waIuXv5HOezC2W7W3g0gum0lnIVU+TI?=
	=?utf-8?q?EJ4Lb3d7ytR7Y18rpPoNBJggu71QZNF2uZfOmN9UXE2xCYrS7eCczcxJYz+6TPH9N?=
	=?utf-8?q?IhoqGQtqDigtMMmA1xfi0IUeEMEoa8KvNV+dEuc2E3ckMRCCoCEsRNhUYt75lKpit?=
	=?utf-8?q?MMO/idqstVPIps6YjVRfDb/UXJBg2CZltIg6vxIhtQAIZ3cglHXfhoTnNRvELg4hu?=
	=?utf-8?q?mh8zp2rY1i689/qAeAwhTEHJoRxPKuez6/sRMuDry8eIcjErYt6EkIXs3FlGjy6sX?=
	=?utf-8?q?MEvfbZXoIOKWYwClE4ABn3/AR+jg3qRuRrEgyBjoTwXNYuYRbUs2xXURUebsN3J5x?=
	=?utf-8?q?eQVVspitVV1tj4IlL3wh6dV885A/AXDvH1ZT47WHCfinpIltYCMfR7r3eWIL0uAV8?=
	=?utf-8?q?DkNOtTHZMyXCfA0Ri6ZE13zzEsVizid18yGSWZrMLza9JGgH2eG36QJK2cn2pjaz8?=
	=?utf-8?q?bgIwJtaC2pG/xGwlZ9A0XgKEBLoRUHAi3vpS8Wrc4TYMJ2MP/LdOxZ+nlb/vfhaU0?=
	=?utf-8?q?P6Z2jjfxFK3O8z+eZ8+UNWgquhXctC6dU64VOYU0e8W2769bjwagL4/TkykuNz5za?=
	=?utf-8?q?jLkeG27We38jVdr7blxtPbYDbdRgBd+bkpIoM4jU4QwX99Ri75e1HPb1iBWkVu2SR?=
	=?utf-8?q?nmCD76BXGSy6/5rZlvfDooeJlqnSDeQzJRsz1Mvw05usFZbmKvdLCtgBJkU7L90H2?=
	=?utf-8?q?QgrI8EnNEFFkzXVhmluZC4Gw3nncUHUBS7qiId+QDf7I1m4bRWQLOqFtGiPbTrlJ/?=
	=?utf-8?q?Qq4/gK+gdl0gh4vl5ixAvRjnVI5sEoOPk6Me80rTvjr3S9FgShIWMptrNn7p3OKQV?=
	=?utf-8?q?xI/KikiC49qyplsGriMQsfpiHALcdJoUK/Jxcm+FphWTpQGgB7DMXGnNAWFJq/+1B?=
	=?utf-8?q?I6u7hOvItUbL0vm1tXJ3MJjVblRpFWcLpE+A0p8x4uw97WtGjwhIi6AT0Uf5T0sZK?=
	=?utf-8?q?Ly9QuCPBcRSrBBta0bpESmNB/ANf5u8os6n4Eib/BLZoA/k0QiE3mpcyRkIOaX+kC?=
	=?utf-8?q?JZq582ThuRV8gs7LRFKQ4IZ3CumfoMTEPFr/PssZyi5FDje/HdELzYvLStQqWPA+W?=
	=?utf-8?q?AwTbQAu5QZahRy35vmEE7pIJirOZLwd8pHCnNoe5H2WBUEseLJTjN9cZXsvJX3StP?=
	=?utf-8?q?GoJGKti4sHQDLwRIBOyXXyaDPuNl2sj9AXnluajHmCg6MsJK5q4vmRCS/9lrn8JQJ?=
	=?utf-8?q?1FNTm5bR/Fy/D30IvSFVEDwyKC7+SOD6pAfGBeMp1nMeRv5MDRQsZQaRqDUUrFMxG?=
	=?utf-8?q?wBl8s8K0KduQwTEzPgmpcyVlmnNkm1IPcuCYper71ZgufYVjrvdqw0cvNviT+vrOz?=
	=?utf-8?q?WT9KrmPz5hl1?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?utf-8?q?5fTN7pnXyGoABhqFKqbnqqa23Pff?=
	=?utf-8?q?TFAvFCjufY/CPJ0Dt0gFCIXkpYLFObM6Jy5vU/BhhbpZNlSvYwZM5ufsPHbegVHXe?=
	=?utf-8?q?++bne3wFff0H/OjxS5m89UnDdfJwQzlwO4Shwr9NfcWoy56PrmPPmUYdrSx5jjw32?=
	=?utf-8?q?weXbpXLmAyrML4ucUpfUAXDcpExLBjY1c9RN8wWailmYRM7sJFBk7A15O8aywcbS5?=
	=?utf-8?q?XT3iwykZxB3LkRf+3J+Aj4ZVATO8QhRIPBP3zBLwHHaD9FloQQQUUayV3j+raAymr?=
	=?utf-8?q?IvTKG/oM744dgxBalPvi7ZCU4T6oJ4wp5gcamJ2/XhHh3/sWOFTv5tpJ65SMZ/3fs?=
	=?utf-8?q?aI4K/KxlDUmuCO8+BdHl8Rpbw94ALpr4sPfTgw57ho1W4lmelVRPxV7pBMrz0LbqA?=
	=?utf-8?q?vgVCE9OnqVrfoFSCYPQfAJySMuy6jkdCn1MOCjIFn4VZsqi0IQfwDLuABZhZ0XI++?=
	=?utf-8?q?LkrVugfE7vtq33gKOJJjHy27A9kJxQi66ACL6g6k7tmHN/syBc7aZZHcdIfj2r8wH?=
	=?utf-8?q?qjAeFZJwJ3Kapca74tF36+Rd9qH30qlyqAfGz9RAiZSGb64HLA4ahFMu+z33t/gtL?=
	=?utf-8?q?MNv+JdVI8q8Pr+xbFsHQuT2eddDDksPMvD8sxw6ZdpfOX/xYGD2jp3XTLZZwDq8Su?=
	=?utf-8?q?ef47536NjRraGAoVJ7vGYQgDVlRqjfIOE0kOjFyuXSyEJvEyrfgwkteCi/96VkGN8?=
	=?utf-8?q?4xlD7fNPhHhswLo2obswg21ALNJRTAURNSjC1FFk+am2ol8gZ04NcG7ZGTkN2Yzb1?=
	=?utf-8?q?GvMv7Gltv0IhUNRfx7PEHPXyYi1zOxgyI9y595WlTb8FuptZG64aOvwRvZzUjMyJy?=
	=?utf-8?q?ReLX7Y9/uhH7TjLyQbsCYSSMaFBN7pubYmNG/0ZmLpNNrjaIMnfBz0t8Z1O3xF6rc?=
	=?utf-8?q?XvvRdkTb017ztfhKoC1AxfOHbTIrODBbyyHcQw4g6XjrNNNk5j5ejHEh21fZ7z5XX?=
	=?utf-8?q?PNWAkQdzy/VTNG5WWzakb+AvKsGeLFB6ayKM6M8NixmS44PnSF7XvK6qd6T4HT76o?=
	=?utf-8?q?DeLO/Yi9+QeDHRUw5GE+bPF+Yqf9/6fJEt2uyMpUbrsfX5ZMMX59hpqfCaQTQKK4U?=
	=?utf-8?q?5Gyk+MXcN6LRzmPUcSeeW+YwtPuzhDVxO+v2c8fGkwIEwZvWOj1lOfwcg5Uwxu3V6?=
	=?utf-8?q?fj6m38+X7iVEyiY1NTXAmeOVCZHz7P9b2cEKCChD+3RJGPDb32EZBy/IqLLHiVzLC?=
	=?utf-8?q?9yuSOVFYoq9my7jJU0crb4MHwSVUAdkuFoL1cS8OsU7RLgVtRXeJEu3ISao/cMq3f?=
	=?utf-8?q?Oiqj375EmRP5/pDJfSB87mSR8ogjcqguacHl0MSHYQceykrNiLb9fVyqLZ4nUpZi9?=
	=?utf-8?q?/cA2cQ0dvAzDwjL0B/U7Yb1bj4fdpidhHNwbETyTN6Ugyn9Ltg9BhCyZLlAO5QFrl?=
	=?utf-8?q?OhN5qhWTFrkAtAUdZQeoyrLETH6AqAjwCRWZbatNbgFQ0a6tJKa2k07xlqXBK66rP?=
	=?utf-8?q?bHVwiSr4bZsTGSlNDIm2hTkODsaO7BRxe6b5kPPuPfNw8dlUgOJ/wzUQOztqdSdlI?=
	=?utf-8?q?s00U15A1FF2aSHAP2i2uMQgKTt5ms33x2Q=3D=3D?=
Content-ID: <A1F82A20E2526D4399B23FE73A74928D@eurprd03.prod.outlook.com>
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 4555482a-77dd-472a-e8db-08dd45ce0e4d
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:44.0870 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 uAcLIX/vH2TjUuSVK/1Ylu9Y0U2joWUdydlAzgNR9TSqMH+W79MwshawnE+VPqWR8qxcKM6Fvkw1y8GDxT0d7eZE6vlbG6a52ZojKvLxyHk=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

According to the Section 2.3.9 of the Device Tree specification [0]
the format of the value of the dma-ranges property is an arbitrary
number of triplets of (child-bus-address,
parent-bus-address, length).
Where:
* The child-bus-address is a physical address within the child bus
  address space. The number of cells to represent the address depends on
  the bus and can be determined from the #address-cells of this node
  (the node in which the dma-ranges property appears).
* The parent-bus-address is a physical address within the parent bus
  address space. The number of cells to represent the parent address
  is bus dependent and can be determined from the #address-cells
  property of the node that defines the parents address space.
* The length specifies the size of the range in the childs address
  space. The number of cells to represent the size can be determined
  from the #size-cells of this node (the node in which the dma-ranges
  property appears)

This description matches comments in the of_addr source code. But
actual implementation do not match the specification.
'of_match_bus' call returns address-cells and size-cells of the parent
device. That's why the following calls were used to receive addr_cells
and size_cells of the current device:
- of_simple_addr_cells
- of_simple_size_cells

This fix was tested on RPI5 board with both device types: directly
connected (e.g Serial) and connected over PCIe (e.g ethernet).

For example when dma_ranges are parsing the following device tree
structure:
/ {
	pcie2: {
		#address-cells = <3>;
		#size-cells = <2>;
		// 64GB system RAM space at PCIe 10_00000000
		dma-ranges =
			   <0x02000000 0x00 0x00000000
			    0x1f 0x00000000
			    0x00 0x00400000>,
			   <0x43000000 0x10 0x00000000
			    0x00 0x00000000
			    0x10 0x00000000>;
		rp1: {
			#address-cells = <2>;
			#size-cells = <2>;
			dma-ranges =
			// inbound RP1 1x_xxxxxxxx -> PCIe 1x_xxxxxxxx
			  <0x10 0x00000000
			  0x43000000 0x10 0x00000000
			  0x10 0x00000000>,

			// inbound RP1 c0_40xxxxxx -> PCIe 00_00xxxxxx
			  <0xc0 0x40000000
			  0x02000000 0x0 0x00000000
			  0x0 0x00400000>,

			// inbound RP1 0x_xxxxxxxx -> PCIe 1x_xxxxxxxx
			  <0x00 0x00000000
			  0x02000000 0x10 0x00000000
			  0x10 0x00000000>;
		};
	};
};

So when we parse ranges on rp1 - #address-cells of the rp1 node should
be taken into account.
In the provided example we have the following format:
pcie2:
   #addres-cells = <0x3>;
   #size-cells = <0x2>;
   dma-ranges = < addr_hi addr_mid addr_lo
                  trans_addr_hi trans_addr_lo
		  size_hi size_lo>;

rp1:
   #addres-cells = <0x2>;
   #size-cells = <0x2>;
   dma-ranges = < addr_hi addr_lo
                  trans_addr_hi trans_addr_mid trans_addr_lo
		  size_hi size_lo>;

of_get_dma_range searches for the first dev with dma_ranges
and then executes of_match_bus which follows by count_cells call
for both device and parent.

count_cells callback returns #address-cells for the parent device to
the caller.
So in the provided example address cells should be returned 2 for rp1,
but we get 3 when using count_cells callback.
This breaks address translation and was fixed in the provided patch
by using of_simple_addr_cells call. Which will return correct
address-cells for the node. This matches the requirements of the
device-tree specification.

[0] https://readthedocs.org/projects/devicetree-specification/downloads/pdf/latest/

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/core/of_addr.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/core/of_addr.c b/drivers/core/of_addr.c
index b3b3d7ccdd..4a321a8263 100644
--- a/drivers/core/of_addr.c
+++ b/drivers/core/of_addr.c
@@ -374,16 +374,16 @@ int of_get_dma_range(const struct device_node *dev, phys_addr_t *cpu,
 	}
 
 	/* Get the address sizes both for the bus and its parent */
-	bus_node = of_match_bus((struct device_node*)dev);
-	bus_node->count_cells(dev, &na, &ns);
+	na = of_simple_addr_cells(dev);
+	ns = of_simple_size_cells(dev);
 	if (!OF_CHECK_COUNTS(na, ns)) {
 		printf("Bad cell count for %s\n", of_node_full_name(dev));
 		ret = -EINVAL;
 		goto out_parent;
 	}
 
-	bus_node = of_match_bus(parent);
-	bus_node->count_cells(parent, &pna, &pns);
+	bus_node = of_match_bus((struct device_node *)dev);
+	bus_node->count_cells(dev, &pna, &pns);
 	if (!OF_CHECK_COUNTS(pna, pns)) {
 		printf("Bad cell count for %s\n", of_node_full_name(parent));
 		ret = -EINVAL;

From patchwork Wed Feb  5 10:15:44 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042685
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=e5rr+bw2;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp15v1tcpz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:18:59 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 8FA1680BAA;
	Wed,  5 Feb 2025 14:15:37 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="e5rr+bw2";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 726088081E; Wed,  5 Feb 2025 11:15:56 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 335B9807B3
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:51 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=MyACQ25Yk5ExQ1gZECnX+T94lFE1JrLfmY68fV/ZdGu7nLpB0xhXIEWM2p2mmN1JqrQEJLmUGq8H0GXqEfWwMuVRRKyDhKovhEQw4ZuBq4jK4bx8ysL40pjWdnKcAmKyuxBpQ7ns22R4PZoBZ4c0297smp8BD5B0d+4xaDGc7X09NxCV54xRiVCZgCgnJawuGI9WuqM0I+Q/dsrEp1VC3kcwuXZbg7yweppMED23yn+W1v+dTMB75mgrmiaOpDIKjeW+23zl1PPxS95/sPKzx9CvR5q1OMizxDnz3lMZqJVVf5ZoE2zDz+yudXtRus2d8mZAjfwWHng6OCciPyf/cw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=yO1Gy7+HkG8YxboqW6/HnsLujloxsESxGGhO8scZ+r8=;
 b=jABrlW2kdmsiqgG3N5JXNHSUHDqvG3+8x3CPHZRGi71/c7h1pT537bdBIX1XoYlst+0xo/VpeYsJ379XcIe5VPicUgfHiulpwcWsbsaFO6uOE3OFe12V0x+8i/05pbLmheuFYXFrO9PDILT1yuMFoXO0MzX8F3ZCv/O7UvlgwHmXwyAWSOsKZZT3shDeGx2oW3dJ/xN5/sObmGYfPEMx6yXHgZfIfjZZrCUbhKvQLecYPuxl3PhWyLuRquK0b+FF7VzKMhnWX6+klrDalTDSRKuwNKpVhZz5N+oXWeCmjf5lqtbFZ9OeESSKqyx8A1gnYJcMPmiZUvhagDt1gOWAUA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=yO1Gy7+HkG8YxboqW6/HnsLujloxsESxGGhO8scZ+r8=;
 b=e5rr+bw2+h1qPmxkHdXEUcYb6cjgqOnBcSceDrKLNIXp4k5xDAuEv3AttYwXBXll6jGq0FMXVHGJsu5kREfbHGjCqJyvlPABW/jZLrGGEH9rmW+l3Qiu/ttU+jLUN3TA24hvjLpvBR9y5Smp3XtAU2kxpGgRa+8JGdfP/iznjpXtzCMFRCgITuFl7qSzf31NolePfIWleLo8porLYgM+NwPUo9zgqp8flETUbmZbi9xOsCXzryvbsyhpAIuuQ/yC3Lvv8xyeYA6Td+N5AKIv7D4czPQzqGsspow6BVmRVWaI3e3NVN4a3hyxArzmGBiADl3qASjuJWwH5XlvwbZiqw==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:46 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:46 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Matthias Brugger
 <mbrugger@suse.com>, Peter Robinson <pbrobinson@gmail.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 08/20] board: raspberrypi: rpi: save board_type to the
 global_data
Thread-Topic: [RFC PATCH v1 08/20] board: raspberrypi: rpi: save board_type to
 the global_data
Thread-Index: AQHbd7bq307yeOEFpky6emkkj02XGg==
Date: Wed, 5 Feb 2025 10:15:44 +0000
Message-ID: 
 <6709e5412eae9c8f96f7f0394918a12f1d8b8332.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 6ff174b6-30e6-4ab2-20ff-08dd45ce0e93
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?+8Uk+E0oYYVDKiPGdWeT53clZQ?=
	=?iso-8859-1?q?35WWbaPuvz2sdxyMgXXxfuL9+DLH+dL0EWPc24jS/6z6IFHLX7fUoLDH+Y4Q?=
	=?iso-8859-1?q?8YvfPB/9d3P6+YwdwW2cR4gpQN4SVmxaOiX8jActIetYoaTcqRLQIfkLLOlY?=
	=?iso-8859-1?q?+76d1RB+5lrfq0Qml9C6XjFF5bRzTBqqhV7AXZdfXOPiRZP8m/ppUTafHhOQ?=
	=?iso-8859-1?q?LeWJwGz9r0exNmALsjwvG3u8c2+wVWyMyCngr1jx0vUC1krTu0Fm/SAmlt1P?=
	=?iso-8859-1?q?0scOImdjyyYrLYXnO3EkWXACawcK2hEB4rfcUlNa6cVTiNeqHn4yFFi2MG6D?=
	=?iso-8859-1?q?l69PbiA+oAhCsJS0NWnmguzVw4Ic0uZQvRp6XfHqz0/X4JidLLnEcBFHfvgj?=
	=?iso-8859-1?q?sbsUH9sM4J4dJ72T19M67US7SfnRW/gVIZBDy33mzpemPppZb9iXb9cGzdS6?=
	=?iso-8859-1?q?/M/lZuLLffaexRm22bo3TnDXgkBNdh26Bmk6UAlerTUyOOPY+7NoyRDsE4pC?=
	=?iso-8859-1?q?W/SL3vAUna4P3HmFZk8gSdDMlRFqXBDPHBlCu39NtAHdhC9WrM2RxL7WWwNg?=
	=?iso-8859-1?q?3ASJR4IamuenAcb2QNx4ohILIpPnyrdecxjUH3wTp5HCP4uCTS2uUj9hzokv?=
	=?iso-8859-1?q?blYQywCPUPC2p32S9quMJSA2tv6dhFFFjuTPtH+cnNMHb+kpxGK+mqT7MiMc?=
	=?iso-8859-1?q?mx7Y3moNME1Wt2CjbVhLqxTjU2idfYxy8BQ7q4aSv6NsSdpdtg+0arpXjrs0?=
	=?iso-8859-1?q?rW3qxsOMHOZXoEnHpmuk/BMYUXjitBS5/TlisVuG8dSPw64VojOnQpiI71vX?=
	=?iso-8859-1?q?hD50bvtHSO9R5xGiMokaeSXwn/N3Dx/nSGc8Opoey76GQuJHqkoHDluThVfK?=
	=?iso-8859-1?q?2AKboyfjXTk3w7VjdNtmWNEslPCC6lHuPXE2Ej5Ow8pisrOfucViSVg7BuH5?=
	=?iso-8859-1?q?Ft/a9iMinnwwd/IxHowwX78/cGC95NBtZ+KLHMcy6+fXHVFTogIcTXQNfL/d?=
	=?iso-8859-1?q?axfA6ppXWnQuDE5cSnvcJlQYmRC0pSwvfTZ1iKsbVATcUFXcIfsxvocNGIQu?=
	=?iso-8859-1?q?z9Wm0T4ivf0hTTyumx7NOMs/PaKluCHl61a3Ii2Fh3dG9C3NUD+Cm84IVdg0?=
	=?iso-8859-1?q?ks0mmCbDuhZKCgucgSQVaDgF2YVkeDyDuhc+lVTLsVdBwt3ZwIfeaXqccEAI?=
	=?iso-8859-1?q?YzsJ3L1xnOb9MJflEUtt6U+nHke3VdFhEr8IWliyAqXcY0iD6SeOrKLWLhx6?=
	=?iso-8859-1?q?1yxnC35jOQ/w8OLxUs+KwN35I/L3AIHXgQWAlmwwVfTWmUcwJJZv5PRUeJ8e?=
	=?iso-8859-1?q?AF+X6WURBW0a2P3lta+f7K5kt+2yOQorY5CJxxwnlmH/elpBSy5aShmswPkd?=
	=?iso-8859-1?q?zedQ1d3qUFm/kBAfyI8UGbx2bBmHhf0EgWtxDSpMzuoGYbpJ7dVDLM0tzkeG?=
	=?iso-8859-1?q?wa?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?U2RnxcNti4A4xQjCjfeIxp6?=
	=?iso-8859-1?q?M+3iavjuDhi+bw0F72xaN8OkHJKKtxcgtqkKdKLDE9BbQxLCoGnI53uuNjL6?=
	=?iso-8859-1?q?scxDK4aRPCNblJ9UXwpJ2BVYAM03cthS29zzVvb5xL2jziQH2mv6rOYQFOMo?=
	=?iso-8859-1?q?+z8Gd7B4YY+LSnD/m0QWeiE/7ZUyY6XZCYx8uywwhtkP2GRxmJNjaOFiJbZv?=
	=?iso-8859-1?q?mAjJWY8cinEYhN65fAdFh03vtALjD/I5apD5is1tq2ebvlpcrqHGYwvt2bMk?=
	=?iso-8859-1?q?+3dYWNwoyDqdflX1vZpfzrfvJrXSVBKnaHhjcywO0yDXL4WSIaaG2SC6qtyg?=
	=?iso-8859-1?q?vDRN8P4MfONYUhtmWbCkUpdVByXxx6C9kgYGDxsFDW3rkOHoFqjXddy+wgdt?=
	=?iso-8859-1?q?uNZh3D/rVQkiedymA95UjjsZqJ4X32nHlO8+CAYe5Law2FKVUIFksP3kkMLx?=
	=?iso-8859-1?q?t6giOajTGObRqc4Dptvg3e1GcbxXZHsDcvWFiwmz+tmmtSut18iOQBYXbAGk?=
	=?iso-8859-1?q?bK6f9RuksM3y8gxX+JPrzSMtYJJ/h7rVdS6Syifr21xernVFXfZmE30UTwxC?=
	=?iso-8859-1?q?M+CnEu5EuFc2gocXxDCpMEkQjoz8q8ZtwCqOP0hS2zrt2YCofHgjY3+VYXbH?=
	=?iso-8859-1?q?GOTy1KDLymDCF47XF0pRISt9UhOU7aa90ZPnk6ALAjWftLiRlaVpjS5zipz2?=
	=?iso-8859-1?q?m3kSlmjd10/QIH0ZksSVvHmR5aOETu+vcmk6wN5HLikNMk2EpQVZ2uXOtF49?=
	=?iso-8859-1?q?UU4rn9S/ZAHDnXs9J+yhvbUMzZNNghFt5fqe0OILsMYqowx59/MSXYMntkCd?=
	=?iso-8859-1?q?E7e81CZaoH3IAibbH0+LlrSlEuBwr8m4eALeBJXEPboP+i6uvEZciGT9+mOs?=
	=?iso-8859-1?q?4qXkQ47Je1ymiiEbbTH5pS1/g5Oc/UedOX4iW+WXDC+McQ8OlOrYEY5Lukj5?=
	=?iso-8859-1?q?61/k3xwHbMsSy3kp+OewhkKDltEseXY7W/vGWkqI9JYqbY5woiUGUBb2b/1s?=
	=?iso-8859-1?q?c4aeGLz/KuzMzPqWh9DMPEsox1drSGiWWGIRZqOcIb8hL7AsfzWYgVkLirhg?=
	=?iso-8859-1?q?qkA0/2b0A1HsvUIFJ/BOnOOEY3z2/Af1wQPxxpl1M+FsWoje5c0KVtfyuCZv?=
	=?iso-8859-1?q?4+7otap5kHh79N0l1OHpURZjw4ZfAJZhLyGqMp9Sm8Yi/kZWu89cK/+8BhKT?=
	=?iso-8859-1?q?DbTsRYg2NJf9/mD6vTj0cUwAc0pPwoyEza3V9jmVMC3NeVx0gUF/G4cwJuln?=
	=?iso-8859-1?q?zo0pf3LEn1MOBbDO0i48SP9YBx7318inPzAHG6LwLnh9scsUdJ09oaFjtbuS?=
	=?iso-8859-1?q?cR5lcRAatj7qGNMQ06e56LeCrizmbxIQPUmGg+osFKqs8g0+/4ReVHO5zTfq?=
	=?iso-8859-1?q?tlFYuuDmJuYVUa5w/Uz54TA1L4sP/q4OlcxgkURXUms4tfvIiraXaKtjscMp?=
	=?iso-8859-1?q?sVWP5ThODaUzL7VN0t8n8mv96Y0dtWAWjR/RI5ly/d5/ubJ+rMNdt+sj6+Wi?=
	=?iso-8859-1?q?UyObmxcIjmeAb0aI/wyqyX0WCUgICz2LGf6728Z366Na1jTD4x82b6yfz8od?=
	=?iso-8859-1?q?R30CNL8tToF79DeWl4GsMuwRrY6kPCmkJEQQytJtRuYnlcJaVo7FIX8/V2LU?=
	=?iso-8859-1?q?AXakfg2wwtAKjeShTkpHd2TX2slseCYip+GHu6g=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 6ff174b6-30e6-4ab2-20ff-08dd45ce0e93
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:44.4003 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 KVZYg3ZWTVhL62olpeOmEodxDtHoEyJZe4cSloXuI+GlNr7LhhJ4S/Ykssnq3/wO8FonATOF7fEp+sHzjKBFw/xjytx+IQ4P3yHhXOvTmCU=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Save board_type retrieved from the BCM board firmware to the global
data. This information can be accessed by using gd_board_type() call to
determine the type of currently used board.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 board/raspberrypi/rpi/rpi.c        |  5 +++++
 include/broadcom/bcm_board_types.h | 25 +++++++++++++++++++++++++
 2 files changed, 30 insertions(+)
 create mode 100644 include/broadcom/bcm_board_types.h

diff --git a/board/raspberrypi/rpi/rpi.c b/board/raspberrypi/rpi/rpi.c
index 2851ebc985..32d67eb7f4 100644
--- a/board/raspberrypi/rpi/rpi.c
+++ b/board/raspberrypi/rpi/rpi.c
@@ -19,6 +19,8 @@
 #include <asm/arch/sdhci.h>
 #include <asm/global_data.h>
 #include <dm/platform_data/serial_bcm283x_mu.h>
+#include <broadcom/bcm_board_types.h>
+
 #ifdef CONFIG_ARM64
 #include <asm/armv8/mmu.h>
 #endif
@@ -489,6 +491,9 @@ static void get_board_revision(void)
 		model = &models[rev_type];
 	}
 
+	if (IS_ENABLED(CONFIG_BOARD_TYPES))
+		gd->board_type = rev_type;
+
 	printf("RPI %s (0x%x)\n", model->name, revision);
 }
 
diff --git a/include/broadcom/bcm_board_types.h b/include/broadcom/bcm_board_types.h
new file mode 100644
index 0000000000..69db528874
--- /dev/null
+++ b/include/broadcom/bcm_board_types.h
@@ -0,0 +1,25 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+/*
+ * This header defines BCM board types.
+ *
+ * Copyright (c) 2024 EPAM Systems
+ *
+ */
+#ifndef _BCM_BOARD_TYPES_H_
+#define _BCM_BOARD_TYPES_H_
+
+/*
+ * TODO: This enumerator defines the main BCM types.
+ * These types are defined by the BCM firmware and requested
+ * via mbox. Currently only one board type was added.
+ * This is needed to determine whether current board is bcm2712
+ * or other to control the behaviour of the following drivers:
+ * macb and pcie_brcmstb. New board enumerators can be added here
+ * if needed.
+ * See https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#raspberry-pi-revision-codes
+ */
+typedef enum {
+	BCM2712_RPI_5_B_NEW = 0x17,
+} bcm_board_type_t;
+
+#endif /* _BCM_BOARD_TYPES_H_ */

From patchwork Wed Feb  5 10:15:44 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042688
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=MtVPsCGG;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp16R6T9rz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:19:27 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 9B67380C66;
	Wed,  5 Feb 2025 14:15:38 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="MtVPsCGG";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id A779C80207; Wed,  5 Feb 2025 11:15:57 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-VI1-obe.outbound.protection.outlook.com
 (mail-vi1eur03on20610.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260c::610])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id B9F47807C0
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:51 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=jseegpTxyyov3wc1fJVq9NsRUcEUDW/t8cWCoVjb2KhRkRP3Qw1hgFXM/iQq0/UwQyCGMDbD+873fgDWajOiul9zst8bj55SNoDz0gIDU+kdM2IlW9VkcbjTHha92xIQsf8IG2EnscGhg2SeS1J0OaVJpdUHs2g+HjpJ6xnS1zgm9JEdjZgi9UqEA/RSpv2244G2K8hCzLqqLUrDAD2KgO0TvInXJyq4QVCO8nwb3HYb8B1/NFD43Y+KaSBpUckmExhbvQU4cHvWgWljiihEpFr4Mcl08TwzvX6SFCJTEhEMJEYRHmKCfV4OwOxMaa+M+0qHU+5y4bp/gG4ysFxihQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=3m/Dt4fWZTCQFUi32munI/HvB3anx5TMKWkIbKhbtD0=;
 b=YdPkELaKSjKxnrhGpdkKXhbcxi/+xOCEg3Tw+kM+vNG9cVFFTYYbDSh/CXYRSubA0aMqNdJuywMFrVgevyWYQ7taiJzIKCUhx9p6TjgVOCjJjATUraX/xBT51FrjnFWt7kSSJkkQDVAxWt7TRhNLUo5rYiP1Vk+1GWoDnCKxeKq/qN7Xm3aW6XlZ7mYZpWIiabhCx7mHDLQtEPecoeTJwzxa+WCMzjNmc0EADPPSaVzVGbMeRsujSM+G9fr6pMNQcTHRQgx18sHWAcq3drQDh2Xv18KoY0QYDdL5nQhGWlWjgut+7itD0qQiEbf95o8Jcn2CBageODGRIOVGmkabeQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=3m/Dt4fWZTCQFUi32munI/HvB3anx5TMKWkIbKhbtD0=;
 b=MtVPsCGGjS7cQhPNNI+d7SCxvT3K8gzmxzjwfoHHmDwli2s9vs+czbMpXfktmhpLlJfl7Au9zdReN2mNErJurlvYn1dv65K5wab+0AbP5/2WwZnYzLvdhsbd8RW+I+CjPm9KXgeFui/ORoRd6KWNBxvOeM6S0DcAmXMcG6/QoHmwkGLSjEDQ4sX0sGTB8kUBlDeSQwIpR2nukSFbXe/bsyiZ/SElxsy0k5QuFSL/dEyNIlEsawmLfk6TT/SxnI+V8FAf0H0fMXG15kTYfeIHAhouyYcxOIBSaaOKPybNEP7AtJwbec3Fqh1Vw8lbbcP/PmfNbG+7WRpgXSVKJXadMw==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:47 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:47 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 09/20] drivers: pci: add BCM2712 support for
 pcie_brcmstb driver
Thread-Topic: [RFC PATCH v1 09/20] drivers: pci: add BCM2712 support for
 pcie_brcmstb driver
Thread-Index: AQHbd7bq9Abt8OHVQ0K0EQFowwU3Ig==
Date: Wed, 5 Feb 2025 10:15:44 +0000
Message-ID: 
 <0a21f1bab4d05b115a86aca5bd07b820aacf308b.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 4bdbdfcc-d45d-46a2-a24f-08dd45ce0ed3
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?f6hrUUEbb/FQCTcWdIEYKOpNe5?=
	=?iso-8859-1?q?ZDul0G81xfRP9ZEmJlZce5PD4DfHd0lH8igBBIlasrvHNLqK1W+I28i4QhHd?=
	=?iso-8859-1?q?QPUgoEM9//lORohNkPmnXp6ABbCL73U1ubuzv4FCVDHMt9Qj8jS8rkvTVPKe?=
	=?iso-8859-1?q?R9mvHQN7Id74kUv1R1J4+09NXaqY9AH78n+ts9JdR53l5TqQud/5mNgm0LM/?=
	=?iso-8859-1?q?ZG42ju1bepxIm/G9Cewi1fUA8k5kSpJFCF0olCsCCf50OxNHpdNuw7JPjbxZ?=
	=?iso-8859-1?q?/2ucXSrTnZdL7OC1YO/0hpLmdeIaA5CZWDqlRflPj4iXvwoklabTdmsQBIG7?=
	=?iso-8859-1?q?2f4hogWcmcp+xzqG3VCLeGwq1DgWdMAH0G7U3os+gkpeKALrf6f3Ehy+vVCj?=
	=?iso-8859-1?q?ubB3YYFfTzdetbCqRvnayEgIFEDqHo0cuUF33GbVRxyJIt0J7bswHtZcf0MG?=
	=?iso-8859-1?q?ps3WLGyuUiS551R7Bla8mGD1ZpMAQ5W4OdFgJVuA9FlAru+J8biL6A73cZs1?=
	=?iso-8859-1?q?dtkBQB7yXppmb/lVFS4ZGWl9s54fO4fCbkes8bJo9NXavRuWMGGPG8Hd4FcC?=
	=?iso-8859-1?q?1ZMTEWZHLSNEy8IAGE9IjwlnvuWVVoxfF5ES8kuAQnl1N/g6wEDW7wu69RDS?=
	=?iso-8859-1?q?r7L5lEPQkZb8+RA3pn/EXuIus3/7LWB0+Z0Qb0s+YmZQr5FkukVooNTJ+qI0?=
	=?iso-8859-1?q?Po2bwddRGY5YeD2G7QC5JcixL7V1usiGHujsHp4KHdHvITVrBcS/JFg0uRxC?=
	=?iso-8859-1?q?52pEaKcUmGLYEd026hxKBzaXYPjf9e5T9WkasjR6ZpJ3b+lL2Ij0LPGC+ss/?=
	=?iso-8859-1?q?Sd499s84LR65xXnOQkbBanrTKH1ZKxXlfvSxYvUgMvLk7/t5ZUUFiY2L/8JF?=
	=?iso-8859-1?q?aSnyaQoKl8o9uFkJtkckryXkKgXpJA0HjCtrq+9JCQIlqGQZ4DB7yqWMrEri?=
	=?iso-8859-1?q?6Q3TecR0mnd2B+AiW2F6eG8dO7CNV7+AkNJyE/3NlMN3YYfG0RdHDjsfZdEM?=
	=?iso-8859-1?q?Aa+BKVwMvLQeWTO/ZJxCEM7Ef2NndXrJSM9a8O9N4IxnBe45nTY+lF0vqVme?=
	=?iso-8859-1?q?ka+LdvEKN9dhWw8dYJp3pyULRfWbS7IP8wXmX90oIw5JQ0mqICvmdsK5ZpIn?=
	=?iso-8859-1?q?42r3vFdqZl/Glgec0YvhKOvEQlVylolwVtuzzwftZRqW620lCnW9RDBibcHX?=
	=?iso-8859-1?q?tcC96ck/FeWD82DxNM56HucofaMKKL+XrTAIzHfQNKrImojEznJ2MgGUetsg?=
	=?iso-8859-1?q?O4A/yUJkWUbtQG2z+gu8s63LKEwtTBm6fysrcDKBRnT7PHQm6AhBGXnzyLf3?=
	=?iso-8859-1?q?58kJdjzl7ptyqaJX8radrhC6s0opH4L85FnlhBuYL9lghINKhMaqE35ztx8T?=
	=?iso-8859-1?q?DRY5A1Y5Wbg38dl9EE88GJqtWOWLAuIbjPBd0m6CFqCVF0kL3EtGQxsFLA9K?=
	=?iso-8859-1?q?FoJdLSXuTW8K4KJY++eBEFqdNS8rfHA1kvN01zDGVTSzKyrKQlIA8B76gnPH?=
	=?iso-8859-1?q?E92U15?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?Pk2aMVWEZhzP+NXo4GjHYby?=
	=?iso-8859-1?q?/goZ2nuJ3+asUnsKoVdaSaWEsMiQGwYWZly3WObcdCXMFuupxybD4evAQ0L6?=
	=?iso-8859-1?q?7nhSCo+FIjYXeiIZpmtLvVifjqQi6r8LEF9Fuaf3M9CPA+Md9lKLYbK7lM+D?=
	=?iso-8859-1?q?UNkROZvAaI/98KawW3r5c+djhku8Fpimw5COdtVPLi3GBF7fvC7i/enBRB3R?=
	=?iso-8859-1?q?348fvSv2vVELlFoRMqoU65OikfEba/BsQmbXG4WoIFUJbh9KMAR+tp3ZZlE/?=
	=?iso-8859-1?q?h2Bh8TP08JvCnkZqsf3NtsvL/YtVW2/AxqBJjS4VIX412UFaE/VjaBsQAEjX?=
	=?iso-8859-1?q?U2DB/eQF4HJuh9BfI7e4Zkz6u89cPXF94MYZQGUgsvJ8020dK4ArUKhVJiiK?=
	=?iso-8859-1?q?y7HIb9lpjihlj35VjZe1JL1gsCfn9AG33lWfK5VDMA9HUyKnCXogO7DkyYkw?=
	=?iso-8859-1?q?/4cgRdYr+Op4hPzgK3Vwc0Mv7+DqEGcq8BxjlmsM5sL+tPXu0R2B6orGr2oY?=
	=?iso-8859-1?q?eGjlCAS7gz87R70tx5rK8zA1aPJlPRN20noN9farVAKNcM2f/EjWgwmUP3ks?=
	=?iso-8859-1?q?n27jxFhpr6Wky4OhvnXiyaGeXYoVN/ILBraThS/jQF8v87eYI7NfMYpGoyFK?=
	=?iso-8859-1?q?WiUV342GIhHxAAE0wyCEYbdPHl6Bz9fX9WKbrnusFnPyVx6NSbdU/bYaQee6?=
	=?iso-8859-1?q?H7G4QXs1rDWQVU/JhiyqZ6cJqIH8Q3p39JE8rhi4IWuq0X8tDEpRH8Zly9Yn?=
	=?iso-8859-1?q?IduuuJAdeaVHHZbvi80uEJORxURnAO9ZGKQHayM7800lai3qEjELvTlb0ZDr?=
	=?iso-8859-1?q?RyM0A/zg/8y5nzFvSutM6igkLHBfQvc8fYs4zzz1xBRx/gIStGk3sFRvz00G?=
	=?iso-8859-1?q?XM6U1ukO3PdBom+6KIJwhv8YI/fWPjNQQnLoYTV7S6wy3+qJkGta4ctmXD5n?=
	=?iso-8859-1?q?cd6NZr8iL++apkfi8ol/sFhFoCBDtqEZ7c3sVTb6BXXfcxmdZsDJO5GxI43b?=
	=?iso-8859-1?q?8kBs1it8Qr4AMr6GQ8AHbvGJ+WLdkLv80XYLtHmReEmZCS2jfg0dyYQ1d8UD?=
	=?iso-8859-1?q?3OYm7rc/fb7zZb0796ueUpVm1PqL5C0SUGF5sspWoRpFHi1cigTCOZ2Zut4c?=
	=?iso-8859-1?q?cVp5oq7Z8KEVn3MJbn70sx3HULHcGNyNvvFY0E4bGXZWkDnys6JE+GfZz5pY?=
	=?iso-8859-1?q?3U6Rev2B8ekEoI+MsFhQVox09eJLt6RtBz0/uKiIlphNplDKVlr4n6LzMAYw?=
	=?iso-8859-1?q?y3G+u23gbfHLLK8ieIDqgtkuGmKfbIdAeMVFTv5bDP/TFC2NiaXRH0t5tcyC?=
	=?iso-8859-1?q?OCanfeG/JP9sgIoT4yDrZNp8AVUk1JG+KNahGhGNxZRV5ksUBY4THRVvJwAx?=
	=?iso-8859-1?q?tK3KU3wjFP3yiHNtxfFusLvkEBYhk6qxo5VXJQCB3Nhm9KOByjVLhoUcQbke?=
	=?iso-8859-1?q?GhxUNRGLRazMkAD9YB+EkBjJJxsXZXVJ6o9IjQZ5elLsdEdLwpM1GR8cVTUV?=
	=?iso-8859-1?q?svs8vpbpWV+cLOHoxLIW4B0c+dPyP7NlTRbNCG/oyCEXhIEDnXWSHO/OJVMS?=
	=?iso-8859-1?q?UpmQyKRueq8Cv8CuX/CoexDrQiq68VM6V4H+SZjQptrjWwUEoqq/94EqLNiZ?=
	=?iso-8859-1?q?WQHjSOPOEMDQq2KszvaJT1Vk0HGwKIwBkXbFbZA=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 4bdbdfcc-d45d-46a2-a24f-08dd45ce0ed3
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:44.8108 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 Egv7PsUUDfhCoB0FHZqL3A35E2OmSV6HAH9D0ysyu2AGfcdpeYceNyosoDfFVw86uzV+9lz2We+KN7+Pk1RRMCyCK7VIAS85OxN7X0HrtPo=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Introducing pcie support for BCM2712 on example of the RPI5 board.
This driver initializes PCIe driver on start and provides access to
the peripheral, connected to PCIe.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/pci/pcie_brcmstb.c | 314 ++++++++++++++++++++++++++++++++++---
 1 file changed, 296 insertions(+), 18 deletions(-)

diff --git a/drivers/pci/pcie_brcmstb.c b/drivers/pci/pcie_brcmstb.c
index cd45f0bee9..9de5c0e980 100644
--- a/drivers/pci/pcie_brcmstb.c
+++ b/drivers/pci/pcie_brcmstb.c
@@ -21,6 +21,7 @@
 #include <linux/bitfield.h>
 #include <linux/log2.h>
 #include <linux/iopoll.h>
+#include <reset.h>
 
 /* Offset of the mandatory PCIe capability config registers */
 #define BRCM_PCIE_CAP_REGS				0x00ac
@@ -45,6 +46,7 @@
 #define  MISC_CTRL_CFG_READ_UR_MODE_MASK		0x2000
 #define  MISC_CTRL_MAX_BURST_SIZE_MASK			0x300000
 #define  MISC_CTRL_MAX_BURST_SIZE_128			0x0
+#define  MISC_CTRL_MAX_BURST_SIZE_128_2712		0x100000
 #define  MISC_CTRL_SCB0_SIZE_MASK			0xf8000000
 
 #define PCIE_MISC_CPU_2_PCIE_MEM_WIN0_LO		0x400c
@@ -65,6 +67,9 @@
 #define PCIE_MISC_RC_BAR3_CONFIG_LO			0x403c
 #define  RC_BAR3_CONFIG_LO_SIZE_MASK			0x1f
 
+#define PCIE_MISC_PCIE_CTRL				0x4064
+#define PCIE_MISC_PCIE_CTRL_PCIE_PERSTB_MASK		0x4
+
 #define PCIE_MISC_PCIE_STATUS				0x4068
 #define  STATUS_PCIE_PORT_MASK				0x80
 #define  STATUS_PCIE_PORT_SHIFT				7
@@ -90,18 +95,23 @@
 #define PCIE_MEM_WIN0_LIMIT_HI(win)	\
 	 PCIE_MISC_CPU_2_PCIE_MEM_WIN0_LIMIT_HI + ((win) * 8)
 
-#define PCIE_MISC_HARD_PCIE_HARD_DEBUG			0x4204
+#define PCIE_MISC_HARD_PCIE_HARD_DEBUG(pcie)	\
+	((pcie)->pcie_cfg->offsets[PCIE_HARD_DEBUG])
 #define  PCIE_HARD_DEBUG_SERDES_IDDQ_MASK		0x08000000
 
 #define PCIE_MSI_INTR2_CLR				0x4508
 #define PCIE_MSI_INTR2_MASK_SET				0x4510
 
-#define PCIE_EXT_CFG_DATA				0x8000
+#define PCIE_EXT_CFG_DATA(pcie)	\
+	((pcie)->pcie_cfg->offsets[EXT_CFG_DATA])
 
-#define PCIE_EXT_CFG_INDEX				0x9000
+#define PCIE_EXT_CFG_INDEX(pcie)	\
+	((pcie)->pcie_cfg->offsets[EXT_CFG_INDEX])
 
-#define PCIE_RGR1_SW_INIT_1				0x9210
+#define PCIE_RGR1_SW_INIT_1(pcie)	\
+	((pcie)->pcie_cfg->offsets[RGR1_SW_INIT_1])
 #define  RGR1_SW_INIT_1_PERST_MASK			0x1
+#define  RGR1_SW_INIT_1_PERSTB_MASK			0x4
 #define  RGR1_SW_INIT_1_INIT_MASK			0x2
 
 /* PCIe parameters */
@@ -131,6 +141,52 @@
 #define SSC_STATUS_PLL_LOCK_MASK			0x800
 #define SSC_STATUS_PLL_LOCK_SHIFT			11
 
+#define PCIE_RC_PL_PHY_CTL_15				0x184c
+#define PCIE_RC_PL_PHY_CTL_15_DIS_PLL_PD_MASK		0x400000
+#define PCIE_RC_PL_PHY_CTL_15_PM_CLK_PERIOD_MASK	0xff
+
+#define PCIE_MISC_UBUS_CTRL				0x40a4
+#define  PCIE_MISC_UBUS_CTRL_UBUS_PCIE_REPLY_ERR_DIS_MASK	BIT(13)
+#define  PCIE_MISC_UBUS_CTRL_UBUS_PCIE_REPLY_DECERR_DIS_MASK	BIT(19)
+#define PCIE_MISC_AXI_READ_ERROR_DATA			0x4170
+#define PCIE_MISC_UBUS_TIMEOUT				0x40A8
+#define PCIE_MISC_RC_CONFIG_RETRY_TIMEOUT		0x405c
+#define PCIE_MISC_RC_BAR4_CONFIG_LO			0x40d4
+#define PCIE_MISC_RC_BAR4_CONFIG_HI			0x40d8
+#define PCIE_MISC_UBUS_BAR_CONFIG_REMAP_HI_MASK		0xff
+#define PCIE_MISC_UBUS_BAR4_CONFIG_REMAP_HI		0x4110
+#define PCIE_MISC_UBUS_BAR_CONFIG_REMAP_ENABLE		0x1
+#define PCIE_MISC_UBUS_BAR_CONFIG_REMAP_LO_MASK		0xfffff000
+#define PCIE_MISC_UBUS_BAR4_CONFIG_REMAP_LO		0x410c
+
+#define PCIE_MISC_UBUS_BAR2_CONFIG_REMAP		0x40b4
+#define  PCIE_MISC_UBUS_BAR2_CONFIG_REMAP_ACCESS_ENABLE_MASK	BIT(0)
+#define  MISC_CTRL_PCIE_RCB_MPS_MODE_MASK		0x400
+
+#define PCIE_LINK_STATE_L1				BIT(1)
+
+enum {
+	RGR1_SW_INIT_1,
+	EXT_CFG_INDEX,
+	EXT_CFG_DATA,
+	PCIE_HARD_DEBUG,
+};
+
+enum brcm_pcie_type {
+	BCM2711,
+	BCM2712
+};
+
+struct brcm_pcie;
+
+struct brcm_pcie_cfg_data {
+	const int *offsets;
+	const enum brcm_pcie_type type;
+	void (*perst_set)(struct brcm_pcie *pcie, u32 val);
+	void (*bridge_sw_init_set)(struct brcm_pcie *pcie, u32 val);
+	bool (*rc_mode)(struct brcm_pcie *pcie);
+};
+
 /**
  * struct brcm_pcie - the PCIe controller state
  * @base: Base address of memory mapped IO registers of the controller
@@ -143,6 +199,9 @@ struct brcm_pcie {
 
 	int			gen;
 	bool			ssc;
+	struct reset_ctl	rescal;
+	struct reset_ctl	bridge_reset;
+	const struct brcm_pcie_cfg_data *pcie_cfg;
 };
 
 /**
@@ -186,6 +245,44 @@ static bool brcm_pcie_rc_mode(struct brcm_pcie *pcie)
 	return (val & STATUS_PCIE_PORT_MASK) >> STATUS_PCIE_PORT_SHIFT;
 }
 
+static void brcm_pcie_perst_set_generic(struct brcm_pcie *pcie, u32 val)
+{
+	if (val)
+		setbits_le32(pcie->base + PCIE_RGR1_SW_INIT_1(pcie),
+			     RGR1_SW_INIT_1_PERST_MASK);
+	else
+		clrbits_le32(pcie->base + PCIE_RGR1_SW_INIT_1(pcie),
+			     RGR1_SW_INIT_1_PERST_MASK);
+}
+
+static void brcm_pcie_perst_set_2712(struct brcm_pcie *pcie, u32 val)
+{
+	u32 tmp;
+
+	/* Perst bit has moved and assert value is 0 */
+	tmp = readl(pcie->base + PCIE_MISC_PCIE_CTRL);
+	u32p_replace_bits(&tmp, !val, RGR1_SW_INIT_1_PERSTB_MASK);
+	writel(tmp, pcie->base + PCIE_MISC_PCIE_CTRL);
+}
+
+static void brcm_pcie_bridge_sw_init_set_generic(struct brcm_pcie *pcie, u32 val)
+{
+	if (val)
+		setbits_le32(pcie->base + PCIE_RGR1_SW_INIT_1(pcie),
+			     RGR1_SW_INIT_1_INIT_MASK);
+	else
+		clrbits_le32(pcie->base + PCIE_RGR1_SW_INIT_1(pcie),
+			     RGR1_SW_INIT_1_INIT_MASK);
+}
+
+static void brcm_pcie_bridge_sw_init_set_2712(struct brcm_pcie *pcie, u32 val)
+{
+	if (val)
+		reset_assert(&pcie->bridge_reset);
+	else
+		reset_deassert(&pcie->bridge_reset);
+}
+
 /**
  * brcm_pcie_link_up() - Check whether the PCIe link is up
  * @pcie: Pointer to the PCIe controller state
@@ -232,8 +329,8 @@ static int brcm_pcie_config_address(const struct udevice *dev, pci_dev_t bdf,
 	/* For devices, write to the config space index register */
 	idx = PCIE_ECAM_OFFSET(pci_bus, pci_dev, pci_func, 0);
 
-	writel(idx, pcie->base + PCIE_EXT_CFG_INDEX);
-	*paddress = pcie->base + PCIE_EXT_CFG_DATA + offset;
+	writel(idx, pcie->base + PCIE_EXT_CFG_INDEX(pcie));
+	*paddress = pcie->base + PCIE_EXT_CFG_DATA(pcie) + offset;
 
 	return 0;
 }
@@ -427,6 +524,98 @@ static void brcm_pcie_set_outbound_win(struct brcm_pcie *pcie,
 	writel(tmp, base + PCIE_MEM_WIN0_LIMIT_HI(win));
 }
 
+static void brcm_pcie_get_resets_dt(struct udevice *dev)
+{
+	struct brcm_pcie *pcie = dev_get_priv(dev);
+	int ret;
+
+	ret = reset_get_by_name(dev, "rescal", &pcie->rescal);
+	if (ret) {
+		printf("Unable to get rescal reset\n");
+		return;
+	}
+
+	ret = reset_get_by_name(dev, "bridge", &pcie->bridge_reset);
+	if (ret) {
+		printf("Unable to get bridge reset\n");
+		return;
+	}
+}
+
+static void brcm_pcie_do_reset(struct udevice *dev)
+{
+	struct brcm_pcie *pcie = dev_get_priv(dev);
+	int ret;
+
+	ret = reset_deassert(&pcie->rescal);
+	if (ret)
+		printf("failed to deassert 'rescal'\n");
+}
+
+static void brcm_pcie_munge_pll(struct brcm_pcie *pcie)
+{
+	u32 tmp;
+	int ret, i;
+	u8 regs[] =  { 0x16,   0x17,   0x18,   0x19,   0x1b,   0x1c,   0x1e };
+	u16 data[] = { 0x50b9, 0xbda1, 0x0094, 0x97b4, 0x5030, 0x5030, 0x0007 };
+
+	ret = brcm_pcie_mdio_write(pcie->base, MDIO_PORT0, SET_ADDR_OFFSET,
+				   0x1600);
+	for (i = 0; i < ARRAY_SIZE(regs); i++) {
+		brcm_pcie_mdio_read(pcie->base, MDIO_PORT0, regs[i], &tmp);
+		debug("PCIE MDIO pre_refclk 0x%02x = 0x%04x\n",
+		      regs[i], tmp);
+	}
+	for (i = 0; i < ARRAY_SIZE(regs); i++) {
+		brcm_pcie_mdio_write(pcie->base, MDIO_PORT0, regs[i], data[i]);
+		brcm_pcie_mdio_read(pcie->base, MDIO_PORT0, regs[i], &tmp);
+		debug("PCIE MDIO post_refclk 0x%02x = 0x%04x\n",
+		      regs[i], tmp);
+	}
+
+	udelay(200);
+}
+
+static void brcm_pcie_window_prog(struct udevice *dev)
+{
+	struct brcm_pcie *pcie = dev_get_priv(dev);
+	void __iomem *base = pcie->base;
+	int i, ret;
+	u32 tmp;
+
+	if (pcie->pcie_cfg->type != BCM2712)
+		return;
+
+	/* program additional inbound windows (RC_BAR4..RC_BAR10) */
+	for (i = 0; i < 7; i++) {
+		u64 bar_cpu, bar_size, bar_pci;
+		struct pci_region region;
+
+		ret = pci_get_dma_regions(dev, &region, i + 1);
+		if (ret)
+			break;
+
+		bar_pci = region.bus_start;
+		bar_cpu = region.phys_start;
+		bar_size = region.size;
+		tmp = lower_32_bits(bar_pci);
+		u32p_replace_bits(&tmp, brcm_pcie_encode_ibar_size(bar_size),
+				  RC_BAR2_CONFIG_LO_SIZE_MASK);
+		writel(tmp, base + PCIE_MISC_RC_BAR4_CONFIG_LO + i * 8);
+		writel(upper_32_bits(bar_pci),
+		       base + PCIE_MISC_RC_BAR4_CONFIG_HI + i * 8);
+
+		tmp = upper_32_bits(bar_cpu) &
+			PCIE_MISC_UBUS_BAR_CONFIG_REMAP_HI_MASK;
+		writel(tmp,
+		       base + PCIE_MISC_UBUS_BAR4_CONFIG_REMAP_HI + i * 8);
+		tmp = lower_32_bits(bar_cpu) &
+				PCIE_MISC_UBUS_BAR_CONFIG_REMAP_LO_MASK;
+		writel(tmp | PCIE_MISC_UBUS_BAR_CONFIG_REMAP_ENABLE,
+		       base + PCIE_MISC_UBUS_BAR4_CONFIG_REMAP_LO + i * 8);
+	}
+}
+
 static int brcm_pcie_probe(struct udevice *dev)
 {
 	struct udevice *ctlr = pci_get_controller(dev);
@@ -442,13 +631,21 @@ static int brcm_pcie_probe(struct udevice *dev)
 	u16 nlw, cls, lnksta;
 	u32 tmp;
 
+	/*
+	 * Deassert rescal reset for BCM2712.
+	 */
+	if (pcie->pcie_cfg->type == BCM2712)
+		brcm_pcie_do_reset(dev);
+
 	/*
 	 * Reset the bridge, assert the fundamental reset. Note for some SoCs,
 	 * e.g. BCM7278, the fundamental reset should not be asserted here.
 	 * This will need to be changed when support for other SoCs is added.
 	 */
-	setbits_le32(base + PCIE_RGR1_SW_INIT_1,
-		     RGR1_SW_INIT_1_INIT_MASK | RGR1_SW_INIT_1_PERST_MASK);
+	pcie->pcie_cfg->bridge_sw_init_set(pcie, 1);
+	if (pcie->pcie_cfg->type != BCM2712)
+		pcie->pcie_cfg->perst_set(pcie, 1);
+
 	/*
 	 * The delay is a safety precaution to preclude the reset signal
 	 * from looking like a glitch.
@@ -456,20 +653,35 @@ static int brcm_pcie_probe(struct udevice *dev)
 	udelay(100);
 
 	/* Take the bridge out of reset */
-	clrbits_le32(base + PCIE_RGR1_SW_INIT_1, RGR1_SW_INIT_1_INIT_MASK);
+	pcie->pcie_cfg->bridge_sw_init_set(pcie, 0);
 
-	clrbits_le32(base + PCIE_MISC_HARD_PCIE_HARD_DEBUG,
+	clrbits_le32(base + PCIE_MISC_HARD_PCIE_HARD_DEBUG(pcie),
 		     PCIE_HARD_DEBUG_SERDES_IDDQ_MASK);
 
 	/* Wait for SerDes to be stable */
 	udelay(100);
 
+	if (pcie->pcie_cfg->type == BCM2712) {
+		/* Allow a 54MHz (xosc) refclk source */
+		brcm_pcie_munge_pll(pcie);
+		/* Fix for L1SS errata */
+		tmp = readl(base + PCIE_RC_PL_PHY_CTL_15);
+		tmp &= ~PCIE_RC_PL_PHY_CTL_15_PM_CLK_PERIOD_MASK;
+		/* PM clock period is 18.52ns (round down) */
+		tmp |= 0x12;
+		writel(tmp, base + PCIE_RC_PL_PHY_CTL_15);
+	}
+
+	tmp = (pcie->pcie_cfg->type == BCM2712) ?
+			MISC_CTRL_MAX_BURST_SIZE_128_2712 :
+			MISC_CTRL_MAX_BURST_SIZE_128;
 	/* Set SCB_MAX_BURST_SIZE, CFG_READ_UR_MODE, SCB_ACCESS_EN */
 	clrsetbits_le32(base + PCIE_MISC_MISC_CTRL,
 			MISC_CTRL_MAX_BURST_SIZE_MASK,
 			MISC_CTRL_SCB_ACCESS_EN_MASK |
 			MISC_CTRL_CFG_READ_UR_MODE_MASK |
-			MISC_CTRL_MAX_BURST_SIZE_128);
+			MISC_CTRL_PCIE_RCB_MPS_MODE_MASK |
+			tmp);
 
 	pci_get_dma_regions(dev, &region, 0);
 	rc_bar2_offset = region.bus_start - region.phys_start;
@@ -482,6 +694,12 @@ static int brcm_pcie_probe(struct udevice *dev)
 	writel(upper_32_bits(rc_bar2_offset),
 	       base + PCIE_MISC_RC_BAR2_CONFIG_HI);
 
+	if (pcie->pcie_cfg->type == BCM2712) {
+		tmp = readl(base + PCIE_MISC_UBUS_BAR2_CONFIG_REMAP);
+		u32p_replace_bits(&tmp, 1, PCIE_MISC_UBUS_BAR2_CONFIG_REMAP_ACCESS_ENABLE_MASK);
+		writel(tmp, base + PCIE_MISC_UBUS_BAR2_CONFIG_REMAP);
+	}
+
 	scb_size_val = rc_bar2_size ?
 		       ilog2(rc_bar2_size) - 15 : 0xf; /* 0xf is 1GB */
 
@@ -490,6 +708,29 @@ static int brcm_pcie_probe(struct udevice *dev)
 			  MISC_CTRL_SCB0_SIZE_MASK);
 	writel(tmp, base + PCIE_MISC_MISC_CTRL);
 
+	if (pcie->pcie_cfg->type == BCM2712) {
+		/* Suppress AXI error responses and return 1s for read failures */
+		tmp = readl(base + PCIE_MISC_UBUS_CTRL);
+		u32p_replace_bits(&tmp, 1, PCIE_MISC_UBUS_CTRL_UBUS_PCIE_REPLY_ERR_DIS_MASK);
+		u32p_replace_bits(&tmp, 1, PCIE_MISC_UBUS_CTRL_UBUS_PCIE_REPLY_DECERR_DIS_MASK);
+		writel(tmp, base + PCIE_MISC_UBUS_CTRL);
+		writel(0xffffffff, base + PCIE_MISC_AXI_READ_ERROR_DATA);
+
+		/*
+		 * Adjust timeouts. The UBUS timeout also affects CRS
+		 * completion retries, as the request will get terminated if
+		 * either timeout expires, so both have to be a large value
+		 * (in clocks of 750MHz).
+		 * Set UBUS timeout to 250ms, then set RC config retry timeout
+		 * to be ~240ms.
+		 *
+		 * Setting CRSVis=1 will stop the core from blocking on a CRS
+		 * response, but does require the device to be well-behaved...
+		 */
+		writel(0xB2D0000, base + PCIE_MISC_UBUS_TIMEOUT);
+		writel(0xABA0000, base + PCIE_MISC_RC_CONFIG_RETRY_TIMEOUT);
+	}
+
 	/* Disable the PCIe->GISB memory window (RC_BAR1) */
 	clrbits_le32(base + PCIE_MISC_RC_BAR1_CONFIG_LO,
 		     RC_BAR1_CONFIG_LO_SIZE_MASK);
@@ -504,12 +745,13 @@ static int brcm_pcie_probe(struct udevice *dev)
 	/* Clear any interrupts we find on boot */
 	writel(0xffffffff, base + PCIE_MSI_INTR2_CLR);
 
+	brcm_pcie_window_prog(dev);
+
 	if (pcie->gen)
 		brcm_pcie_set_gen(pcie, pcie->gen);
 
 	/* Unassert the fundamental reset */
-	clrbits_le32(pcie->base + PCIE_RGR1_SW_INIT_1,
-		     RGR1_SW_INIT_1_PERST_MASK);
+	pcie->pcie_cfg->perst_set(pcie, 0);
 
 	/*
 	 * Wait for 100ms after PERST# deassertion; see PCIe CEM specification
@@ -528,7 +770,7 @@ static int brcm_pcie_probe(struct udevice *dev)
 		return -EINVAL;
 	}
 
-	if (!brcm_pcie_rc_mode(pcie)) {
+	if (!pcie->pcie_cfg->rc_mode(pcie)) {
 		printf("PCIe misconfigured; is in EP mode\n");
 		return -EINVAL;
 	}
@@ -596,14 +838,14 @@ static int brcm_pcie_remove(struct udevice *dev)
 	void __iomem *base = pcie->base;
 
 	/* Assert fundamental reset */
-	setbits_le32(base + PCIE_RGR1_SW_INIT_1, RGR1_SW_INIT_1_PERST_MASK);
+	pcie->pcie_cfg->perst_set(pcie, 1);
 
 	/* Turn off SerDes */
-	setbits_le32(base + PCIE_MISC_HARD_PCIE_HARD_DEBUG,
+	setbits_le32(base + PCIE_MISC_HARD_PCIE_HARD_DEBUG(pcie),
 		     PCIE_HARD_DEBUG_SERDES_IDDQ_MASK);
 
 	/* Shutdown bridge */
-	setbits_le32(base + PCIE_RGR1_SW_INIT_1, RGR1_SW_INIT_1_INIT_MASK);
+	pcie->pcie_cfg->bridge_sw_init_set(pcie, 1);
 
 	return 0;
 }
@@ -628,6 +870,11 @@ static int brcm_pcie_of_to_plat(struct udevice *dev)
 	else
 		pcie->gen = max_link_speed;
 
+	pcie->pcie_cfg = (const struct brcm_pcie_cfg_data *)dev_get_driver_data(dev);
+
+	if (pcie->pcie_cfg->type == BCM2712)
+		brcm_pcie_get_resets_dt(dev);
+
 	return 0;
 }
 
@@ -636,8 +883,39 @@ static const struct dm_pci_ops brcm_pcie_ops = {
 	.write_config	= brcm_pcie_write_config,
 };
 
+static const int pcie_offsets[] = {
+	[RGR1_SW_INIT_1] = 0x9210,
+	[EXT_CFG_INDEX]  = 0x9000,
+	[EXT_CFG_DATA]   = 0x8000,
+	[PCIE_HARD_DEBUG] = 0x4204,
+};
+
+static const struct brcm_pcie_cfg_data bcm2711_cfg = {
+	.offsets	= pcie_offsets,
+	.type		= BCM2711,
+	.perst_set	= brcm_pcie_perst_set_generic,
+	.bridge_sw_init_set = brcm_pcie_bridge_sw_init_set_generic,
+	.rc_mode	= brcm_pcie_rc_mode,
+};
+
+static const int pcie_offsets_bcm2712[] = {
+	[RGR1_SW_INIT_1] = 0x0,
+	[EXT_CFG_INDEX] = 0x9000,
+	[EXT_CFG_DATA] = 0x8000,
+	[PCIE_HARD_DEBUG] = 0x4304,
+};
+
+static const struct brcm_pcie_cfg_data bcm2712_cfg = {
+	.offsets	= pcie_offsets_bcm2712,
+	.type		= BCM2712,
+	.perst_set	= brcm_pcie_perst_set_2712,
+	.bridge_sw_init_set = brcm_pcie_bridge_sw_init_set_2712,
+	.rc_mode	= brcm_pcie_rc_mode,
+};
+
 static const struct udevice_id brcm_pcie_ids[] = {
-	{ .compatible = "brcm,bcm2711-pcie" },
+	{ .compatible = "brcm,bcm2711-pcie", .data = (ulong)&bcm2711_cfg },
+	{ .compatible = "brcm,bcm2712-pcie", .data = (ulong)&bcm2712_cfg },
 	{ }
 };
 

From patchwork Wed Feb  5 10:15:45 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042691
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=oPFqlX/V;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp1705yhMz20Jd
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:19:56 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 8B38B80C91;
	Wed,  5 Feb 2025 14:15:39 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="oPFqlX/V";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id C90D980207; Wed,  5 Feb 2025 11:15:58 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-DBA-obe.outbound.protection.outlook.com
 (mail-dbaeur03on20628.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260d::628])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 56E248078B
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:55 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=rOIa61AErcs3euwjrw3agqPr3zHQ69QP10g6pfyUa/Nhn3mQmsbabodEGF013WBCv0uL8LoP4th64s2O67lPvz6B/iHSkosHx5L5lf4I/Nrd6pYyNqr+0bsswiGTGpE/wmPIBtWn31qBUXjDbDfRgbepwotKwXGkbcCqwpHsCwlWJA0R8Uq40ZG6+vl1XUuj0AXiQE/jy7dRFfCIotQGdng+MWZm1t2e71lbC+9w2cM4KHR/xT1er6XKz1YwykCuLqAMn7nQxEyqgoIHzWVZCxzec3TlYK3Ycc5YtrOcoZkiflq77SKoPu/ok1wRqCM6iGo+/gFEiabHNMEV2og7DA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=+NOwGE38vAR1HAYfm/K7ie0r7M++9OF4RLlWWyIQ6kw=;
 b=Ssfk1ijezoQUpvWxSBXnBiPpAgBgu7L+5XvOw5a9HAKbAiI1Rk00q4IhDFTsD0H68Xw8Pc3M/gRxhIOmyQP50TBSxSGTIXITeOHit6KmVEpkPGtqPxaLMyM53FFnZmPAoA2FdVagTE/+HB9N560Oat2SkFZItsvI3euSY5u3SLwkaKqKmWadex9XQPZo7a9/MWdVxZsMerWzvmXi70WE6IDdeJzYGlg/7J7VXHjOx9Us4Qy1v16CNqXinR1qEXVwEUAwZKG4yDgqFs/TJIKk2D558D60VEF6bAZRh34Nqx7SE1Bn4Dm+Q3KVNg0Yp/D93JuVzLruMZqvwuztC/fi1w==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=+NOwGE38vAR1HAYfm/K7ie0r7M++9OF4RLlWWyIQ6kw=;
 b=oPFqlX/Vltn8En7AE9KPmW9XsuWkHGWH9ZyjoxeqYnfEeEDVa1dDCyVfzJIPUtmdCgLUIiwSKMWx8S13pBNjkI5K9PIyYQOdkRcAzUBeG2jLbfu2AZ4tF66w+MqlnvKlMTHOPJ7YjAN/R+sasbNIyJhJWTIz6nk8C6K0e12RN5v40kmQxbUWSEvzhHGWNEFMz8XYXGB0FFSBa5hXMwVI5+Q11+ingOC/PggrhImTQs1mi8Y6EudIKxKZvO7T9dJHGdFFb7OUVhxzm5bE8C4lvX8/Z2ZUOXL+zBDQZbP9aCKdoRjcB/rJgqX8I+4r6EwPf/tYShEK3xvbKOCNfZ5vlA==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:49 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:49 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Marjolaine Amate
 <marjolaine.amate@odyssee-systemes.fr>, Tom Rini <trini@konsulko.com>,
 Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 10/20] drivers: mfd: introduce RP1 chip driver for RPI5
Thread-Topic: [RFC PATCH v1 10/20] drivers: mfd: introduce RP1 chip driver for
 RPI5
Thread-Index: AQHbd7brA/0KT5zznkSdn9H7mkkvNQ==
Date: Wed, 5 Feb 2025 10:15:45 +0000
Message-ID: 
 <63a3407abc16d3f6ea854fc3b95a131c1d245b5d.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 5bcc5b65-7bce-49d7-cace-08dd45ce105c
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?75c57S6WUWzpxttgHYsykM+1H5?=
	=?iso-8859-1?q?d912yze8gSPKdbXExpGtQ1hRTnl+6O8eCgbXgMzPZzN0GG74J+lNuLuM2OlJ?=
	=?iso-8859-1?q?lq4Pl6HTMNaPa9FJEp1EeTSXC5vYY8S546qFOXBxQ9kOiQiJuW4Qjj5ju4mw?=
	=?iso-8859-1?q?RItnzruHoU0OICcIPlVWMGfx66W9D9vyN4XvxRs/GJ/+fTiKm/0kkj22kSJT?=
	=?iso-8859-1?q?JDHmxsuWJpkAymVprPPU1eMDrKPTAABENlANYkWzV+D7XAngdH7WQfxeWkMj?=
	=?iso-8859-1?q?kNiBsh+uxqkOgxJzZWmLYwi1zjPO9qtRDqn9XT5DFTUE84uCbrHaJKQL5dmz?=
	=?iso-8859-1?q?WXVNjT5THpXoI3obeVUu+ZTT0Hz/Onsv6VfcUUADFsZZfzy2l0NVIaEWSKlU?=
	=?iso-8859-1?q?Yr58hBHz0JjaAZDE/s7qs3buZjglRw7xqqjunKmWQzWfdcMgvkPx9B8wauWX?=
	=?iso-8859-1?q?AzcaL8kUfqrmbJbzX2NM23NsdZYi/EZ/cylS10iAxBVI4F/alE/+WVKDxZKJ?=
	=?iso-8859-1?q?pzQC8e5KnuuWZ/htB8wvggU9oeJXK5ni4vDsyZf0npEXz+c/XGJYSdiOuzpX?=
	=?iso-8859-1?q?8j+2MAl9Z6S/hDBkZG9DrWKG0PI5PuOb5OLYSoU4fbmqnMcUSObPke0BijOS?=
	=?iso-8859-1?q?Cta8bMTHTLvDd4BGIhxAvT1fWV5quueuUG3RmMzCGGqJNnSN0yVUl5uzmq/J?=
	=?iso-8859-1?q?j3IwZ2bp9jSxSPEMy3lzYZrF978DjurV2mBhV5jZFbxfu+hGS6qEmWOhT90I?=
	=?iso-8859-1?q?Y4RZqdKc99yP5WFj1O06+q2lhUkQQx6Bb1DJaoYeTbNjurayoeu4mayZXMsG?=
	=?iso-8859-1?q?QtgnX0JZjD8kpWWy3Gr/8+KenVdItoNR6F+e6nTl8sOQIDQ/8B2jN+A2OFNB?=
	=?iso-8859-1?q?01uDNAmJVYLPuYLx442dXHlsrUP/2n/9Mau3qCUCErMKHTsw0RiHaOUB0F9N?=
	=?iso-8859-1?q?Ajyrf0pQ3209Tx4WBeOgqxmk0spK76MwyIGAAzzKvMPFx8Gx3z+F+5euHY+Y?=
	=?iso-8859-1?q?vgGx32T1ymlhcJFdYt4R7K8TotsrZuKu47P/wTst8LboP2klfPXu7tz/Ajd7?=
	=?iso-8859-1?q?3YGsseYODf+2ZbzvqGSbUv3RJY5m768VoPoYSY0qeDnO5agmh/X+kajPT094?=
	=?iso-8859-1?q?Y38KmmY9X9OXdaKRuncpyIbpKXh13OibusaNmIR+Ttdd2mdS2bMA7DHgW5rW?=
	=?iso-8859-1?q?Y0qqO0NcbqZJXmFNQUj74udEu4MLf8WkvCpcmx0faNJO8wgWSveKTu7KqQ0h?=
	=?iso-8859-1?q?lPsrp01ivZj2+5ie19zi29jkiv0le7LUmFRO9ydG3+xH/stzqU/hoatQSJm3?=
	=?iso-8859-1?q?LYEc1g/tgGHjbxtHfoEZJNQRi5Lmy5/akd5tkW+qnCWI8v0pYzBhpfNw/YHQ?=
	=?iso-8859-1?q?nc4k/+vqkgx/YgyxmBKWmaggRQYsrTCs5nBItuLlYJZ4A1BHfM38WG+u8MKK?=
	=?iso-8859-1?q?6X/9WZPxC4bUw9NdVpp+f4BGdKZMTvd+vRzN4LFnY2fnGHKiW3NHWCvDh2j8?=
	=?iso-8859-1?q?8JU6si?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?3QiBSi8ak3wKMfeh+c0mPYM?=
	=?iso-8859-1?q?dIplbYyhtWbde/tJHCVHSn5peP6Qw9XXi/s/U9s6wjMnD85TGjOewpfNbljp?=
	=?iso-8859-1?q?Tyc2LUhgO1lsIgy/1u9cN2sBM7cN2/XSHJL/k14KAfbWeyRJsKC9L1/1EM42?=
	=?iso-8859-1?q?fMo0rEvK2fR6WcYfqYFuONjNev7fm5KWvtUBTqpZzuZ3i4A4FNd0gutfdISP?=
	=?iso-8859-1?q?kcDh82JDuA+BOaAZTvrCIVw7ENYYLuAq+gmEgrQOMweSTI4bCd5N1LVNxBj0?=
	=?iso-8859-1?q?BwE4PeRTeB3+WANg8AA6xrj0gznTH1zaBUantjTAUELmwnwMm/e7viLKQlXh?=
	=?iso-8859-1?q?I3xy48eU7c7McLkphZC/Xdphb9dCFMX0PzJv5/L8MmtEN7Ax5lD7/RjXnC/Y?=
	=?iso-8859-1?q?6gj9lm4iKOVrlqZ8s9u1HMaIulP0z2C6s8l/BN3hpXc+vV34ku30Ll12t6Wu?=
	=?iso-8859-1?q?hZrLBmEwMPWclHF9uIFNHKKZC23tCdV8IgNDVYyS2pHos14pgipJsJc6Jvbs?=
	=?iso-8859-1?q?VGawssYVbE0K+zyFWywOxg2vHXe0DEIWIVsQwRMhv+bv/EpEGYwgPMEH51ds?=
	=?iso-8859-1?q?qztXlz9/oFjHGoZRp7w/x2zGw5jMinyjhR2zDhqFWd4lMii/1CA1TI6rXNpu?=
	=?iso-8859-1?q?N2Ui4UaEe1hygO78qAWELrUu3QjJG+luYWcpHkEoCfwP935qEknWR46tom7o?=
	=?iso-8859-1?q?+YXvYtTx1SS28wceUyqc3Tw2hjdIcOhDJVmhWNgVjw69yPqmUIWxpOwlZkle?=
	=?iso-8859-1?q?CLaokLYbhEfKnSu4X7JmyuH54b5svmfRtZbUAZjDxgTkKRLuA3fLG4NpmDJ1?=
	=?iso-8859-1?q?ZXYmzTzH4NNVhFw6RtX3PULu3u2jcvH4lcXe7Q0R20PwikwRQI1ecGT8ZmUc?=
	=?iso-8859-1?q?4usrQEdyc8BhMG57bi0ux109jU0cGAO7z3f25cMcc1MifVy7AN/VgQS/Zbbg?=
	=?iso-8859-1?q?533dXDOd2WnoLtcUtRjnVEUpZthZubc9xHBXg0dMQsG9r8OYzUlO+Muwrufq?=
	=?iso-8859-1?q?PYXPWzQxiDD2x1+AUybfeLelTZvEUEnG0R967DdKYoVCEw0eMweMw07gxo2z?=
	=?iso-8859-1?q?rKWSZSzIxDi7vZvrJq1mbD9AhJ5OkKsP1Mw9VIaTkGD4/Vc7SHhSJsG8bvHw?=
	=?iso-8859-1?q?ZaPz9OA+8KXbscZjWyPJoWuPa609lCsE8h+dJPyMSLoXdPsj2e7Nsja1HkL2?=
	=?iso-8859-1?q?sdsYcoGK3e74RchjnNMCt2t/Dt7DCJ4noNhYz+0Y73n3XHNH7auAE0Ka9gvU?=
	=?iso-8859-1?q?UQIISyLFUziVPOO3oioP6R09ePph6uOixY6dkh+3cgXTgYilH6IDv/ExYo9C?=
	=?iso-8859-1?q?laeZQZozJFy0VhCkmnQTafYGxkSgiJZmhOyizb+CJON4Oq6Ki048nmoo/LQh?=
	=?iso-8859-1?q?keDe7dsr7r1N/cidAdVGuU5QoYQIytcmY8JVSIi+h1Iv5E3qcRZ59XmO4/FY?=
	=?iso-8859-1?q?A1AEq8NKiT8xbT7vx+n24g9RRG3p73y05m4J0Eush8o4lWQ96eaDKqrJmd1K?=
	=?iso-8859-1?q?tbrfn8Y2bXj2FRUjrJ7A8ou9WJ3nT4MUSrKo7/5IKIXhU6Hb4v/lbcz6znoY?=
	=?iso-8859-1?q?BHiri/AyshZC0spn/RJWiqsRB0JnOydADODRwuN+x5llf0xkaFNQ76D+PlSY?=
	=?iso-8859-1?q?B1lyIZGJzGt0icrHvGwG5RZjUeCA6LJ5VQ/InUQ=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 5bcc5b65-7bce-49d7-cace-08dd45ce105c
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:45.1582 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 4Z1Puy6dyNu4lHxtu8xi/mvYA+QRnL11uvUd7JuIQrUSbzrawa98jpUjV4uuX1SrlC2XsXXTpqRHhAlzGDlGXvuzoWsEcAhKmH3D1VjyEfw=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Raspberry PI 5 has RP1 chip connected over PCIE and working as a
bridge to different hardware.
This driver implementation was inspired by MFD RP1 driver in the Linux
Kernel.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/mfd/Kconfig  |  10 ++++
 drivers/mfd/Makefile |   1 +
 drivers/mfd/rp1.c    | 120 +++++++++++++++++++++++++++++++++++++++++++
 include/pci_ids.h    |   3 ++
 4 files changed, 134 insertions(+)
 create mode 100644 drivers/mfd/rp1.c

diff --git a/drivers/mfd/Kconfig b/drivers/mfd/Kconfig
index ae53b02f27..a9de45797f 100644
--- a/drivers/mfd/Kconfig
+++ b/drivers/mfd/Kconfig
@@ -2,3 +2,13 @@ config MFD_ATMEL_SMC
        bool "Atmel Static Memory Controller driver"
        help
 	Say yes here to support Atmel Static Memory Controller driver.
+
+config MFD_RP1
+	tristate "RP1 MFD driver"
+	depends on PCI
+	help
+	  Support for the RP1 peripheral chip.
+
+	  This driver provides support for the Raspberry Pi RP1 peripheral chip.
+	  It is responsible for enabling the Device Tree node once the PCIe endpoint
+	  has been configureds.
diff --git a/drivers/mfd/Makefile b/drivers/mfd/Makefile
index 4454815a98..c81ee5789b 100644
--- a/drivers/mfd/Makefile
+++ b/drivers/mfd/Makefile
@@ -1 +1,2 @@
 obj-$(CONFIG_MFD_ATMEL_SMC) += atmel-smc.o
+obj-$(CONFIG_MFD_RP1) += rp1.o
diff --git a/drivers/mfd/rp1.c b/drivers/mfd/rp1.c
new file mode 100644
index 0000000000..265ed668f5
--- /dev/null
+++ b/drivers/mfd/rp1.c
@@ -0,0 +1,120 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ * Copyright (c) 2024 EPAM Systems
+ *
+ * Derived from linux rp1 driver
+ * Copyright (c) 2018-22 Raspberry Pi Ltd.
+ */
+
+#include <asm/io.h>
+#include <dm.h>
+#include <dm/device_compat.h>
+#include <dm/of_access.h>
+#include <dt-bindings/mfd/rp1.h>
+#include <linux/io.h>
+#include <linux/types.h>
+#include <pci.h>
+
+#define RP1_B0_CHIP_ID 0x10001927
+#define RP1_C0_CHIP_ID 0x20001927
+
+#define RP1_PLATFORM_ASIC BIT(1)
+#define RP1_PLATFORM_FPGA BIT(0)
+
+#define RP1_DRIVER_NAME "rp1"
+
+#define PCI_DEVICE_REV_RP1_C0 2
+
+#define SYSINFO_CHIP_ID_OFFSET	0x00000000
+#define SYSINFO_PLATFORM_OFFSET	0x00000004
+
+struct rp1_dev {
+	phys_addr_t bar_start;
+};
+
+static inline dma_addr_t rp1_io_to_phys(struct rp1_dev *rp1, unsigned int offset)
+{
+	return rp1->bar_start + offset;
+}
+
+static u32 rp1_reg_read(struct rp1_dev *rp1, unsigned int base_addr, u32 offset)
+{
+	resource_size_t phys = rp1_io_to_phys(rp1, base_addr);
+	void __iomem *regblock = ioremap(phys, 0x1000);
+	u32 value = readl(regblock + offset);
+
+	iounmap(regblock);
+	return value;
+}
+
+static int rp1_get_bar_region(struct udevice *dev, phys_addr_t *bar_start)
+{
+	*bar_start = (phys_addr_t)dm_pci_map_bar(dev, PCI_BASE_ADDRESS_1, 0, 0,
+			PCI_REGION_TYPE, PCI_REGION_MEM);
+	return 0;
+}
+
+static int rp1_probe(struct udevice *dev)
+{
+	int ret;
+	struct rp1_dev *rp1 = dev_get_priv(dev);
+	u32 chip_id, platform;
+
+	/* Turn on bus-mastering */
+	dm_pci_clrset_config16(dev, PCI_COMMAND, 0, PCI_COMMAND_MASTER | PCI_COMMAND_MEMORY);
+
+	ret = rp1_get_bar_region(dev, &rp1->bar_start);
+	if (ret)
+		return ret;
+
+	/* Get chip id */
+	chip_id = rp1_reg_read(rp1, RP1_SYSINFO_BASE, SYSINFO_CHIP_ID_OFFSET);
+	platform = rp1_reg_read(rp1, RP1_SYSINFO_BASE, SYSINFO_PLATFORM_OFFSET);
+	dev_dbg(dev, "chip_id 0x%x%s\n", chip_id,
+		(platform & RP1_PLATFORM_FPGA) ? " FPGA" : "");
+
+	if (chip_id != RP1_C0_CHIP_ID) {
+		dev_err(dev, "wrong chip id (%x)\n", chip_id);
+		return -EINVAL;
+	}
+
+	return 0;
+}
+
+static int rp1_bind(struct udevice *dev)
+{
+	device_set_name(dev, RP1_DRIVER_NAME);
+	return 0;
+}
+
+static const struct pci_device_id dev_id_table[] = {
+	{ PCI_DEVICE(PCI_VENDOR_ID_RPI, PCI_DEVICE_ID_RP1_C0), },
+	{ 0, }
+};
+
+static int rp1_pcie_read_config(const struct udevice *bus, pci_dev_t bdf,
+				uint offset, ulong *valuep, enum pci_size_t size)
+{
+	/*
+	 * Leaving this call because pci subsystem calls for read_config
+	 * and produces error then this callback is not set.
+	 * Just return 0 here.s
+	 */
+	*valuep = 0;
+	return 0;
+}
+
+static const struct dm_pci_ops rp1_pcie_ops = {
+	.read_config	= rp1_pcie_read_config,
+};
+
+U_BOOT_DRIVER(rp1_driver) = {
+	.name			= RP1_DRIVER_NAME,
+	.id			= UCLASS_PCI_GENERIC,
+	.probe			= rp1_probe,
+	.bind			= rp1_bind,
+	.priv_auto		= sizeof(struct rp1_dev),
+	.ops			= &rp1_pcie_ops,
+};
+
+U_BOOT_PCI_DEVICE(rp1_driver, dev_id_table);
diff --git a/include/pci_ids.h b/include/pci_ids.h
index f1886c3a75..4027b89b25 100644
--- a/include/pci_ids.h
+++ b/include/pci_ids.h
@@ -2556,6 +2556,9 @@
 #define PCI_VENDOR_ID_TEKRAM		0x1de1
 #define PCI_DEVICE_ID_TEKRAM_DC290	0xdc29
 
+#define PCI_VENDOR_ID_RPI		0x1de4
+#define PCI_DEVICE_ID_RP1_C0		0x0001
+
 #define PCI_VENDOR_ID_TEHUTI		0x1fc9
 #define PCI_DEVICE_ID_TEHUTI_3009	0x3009
 #define PCI_DEVICE_ID_TEHUTI_3010	0x3010

From patchwork Wed Feb  5 10:15:45 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042689
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=EKbokWzO;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp16d6qNMz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:19:37 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id E726D80C6F;
	Wed,  5 Feb 2025 14:15:38 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="EKbokWzO";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 6D8DA8081A; Wed,  5 Feb 2025 11:15:58 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-DBA-obe.outbound.protection.outlook.com
 (mail-dbaeur03on20628.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260d::628])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id DE779806DC
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:54 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=ugsR6IuEuJt0TiHuCWk2ySG/V/UJBA8eI77LTJM1xKpqN4gwS1WbFkKmIjoQu+03qeI2hZ4mXOGXACviBePXvzblCX9dGdRGVk7YRtntRcO3/bkQ8k4FAtSGGX2TIGDVjBxjewsoh8zX9h+dhbTqeok5MBzKtJhD3w85D9vzaR5DOISfWIbEliYU/rekL7GIG7FvbYXXT+/HV0RhDqrRaPSOwUQ7BgjaPnClnkK0Md7iBzc388H/vYTdfGaPfhQaOcbrDu3x/PTriE7Xo1KdTIeFq1EjN9j4hN69EOiY6Cpd89sG6yhKt5PrOTbH3tKwXjibwLPl6KCownqwFKJL0g==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=X1Ya2E3zcH2DYKKQK359GafPJv8NgEqYSFD16fbtIQ4=;
 b=PcCc83DCKdCDWVb0Pbfw63f+eF681VqtygtNueF8WacJQISgQeiO6GO1ovZSLV3olAr+71ZQmozcR5gU+DHpgDYea2/X08Q6qHMRWSr4waa5ZYyJ1UdB5N0LcjSyr1CQ0rB5N5fuUnoNGLHkzFRLx9tDidFrEAO5ukREUa3eEeAxqwe+oaXzIBs0A2x+XU5idBA+Qd3g38QAU2OY1lAojdMjKOFEeDZtIke9bOZ2ZPmMs/+kncDtYTXubzcOEGoDONVQ/ocfKPuofcKUK0y9FPICyUu9/Pbs3V5J1UzqtYQtO+uvQ5IHUTXN3l93zP2ttXjRb75ftIb2XW0oyfmLsQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=X1Ya2E3zcH2DYKKQK359GafPJv8NgEqYSFD16fbtIQ4=;
 b=EKbokWzOKCOLqhePSus6+FvwuA+Fd7RTYB6VVibAhgWUFpOiNuzontcxUaptCgdoXhiw0DwcOjz/r4hA44C4yCa2KbpYUlvwkGjPpD5LLJEGccnToZuLADxZJ1HdIBmbxR1JI83noVhciLwX8rsiN+FlRoOSh6z34jDVuwgb4qG45RlAA6YRNdz43keHNnFrn+L3BDeDvFszATVEOMz1yo0Ss3Rs3Z3GLLC85y6hKSNntleDWWiqYrbyM23PJ9yJKfueRtsKLLA1TAjswVAhj/KwJFQMWF87zZOWlgX1t0tvcUtlZBHjko5tmsX/8liccZYhug0lQKNvPnPM4ApNXQ==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:50 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:50 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, =?iso-8859-1?q?Marek_Beh?=
	=?iso-8859-1?q?=FAn?= <kabel@kernel.org>,
 Marek Vasut <marek.vasut+renesas@mailbox.org>,
 Paul Barker <paul.barker.ct@bp.renesas.com>,
 Piotr Wojtaszczyk <piotr.wojtaszczyk@timesys.com>, Stefan Roese <sr@denx.de>,
 Tom Rini <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 11/20] drivers: gpio: add support of RP1 GPIO for
 Raspberry PI 5
Thread-Topic: [RFC PATCH v1 11/20] drivers: gpio: add support of RP1 GPIO for
 Raspberry PI 5
Thread-Index: AQHbd7br0krOXg/E+0+QGJmDUkVo/g==
Date: Wed, 5 Feb 2025 10:15:45 +0000
Message-ID: 
 <3f36c2863ec3dfc5efe297b80c25e315a59260e5.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 8d837b67-b9d5-46ad-c702-08dd45ce1098
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?sp74VfDSHN4atViDudUKoVOZXA?=
	=?iso-8859-1?q?hLtnpwrb5wLpIZcZOsixvrqS+RE5+YyTITcr00fOCqWshIsQH7LlvkoW1iFe?=
	=?iso-8859-1?q?nez+e9mVtmknaa7Gg/2x5d76cSw9YQ93mUrQmKA1Lzog1VNLGk68OL7B4ed8?=
	=?iso-8859-1?q?pQeIjM7jN706wtPNdgoML0A11DRY3Kjjq3WdhH94GziY2i3WRDspWaDtIpGA?=
	=?iso-8859-1?q?JB7dlT6Jpmq20n/cv4CAoIqpBiT9sbym9MByJER/pHCqG37qTxt4r8/arA+i?=
	=?iso-8859-1?q?DiywrrGWZGBfzDxoeQot9GiEBn0mrneHj5/FGZfppzYOOASRq+TJyFg9zZIl?=
	=?iso-8859-1?q?2j/YSK9cHgO9xEELBaemV50ulKAnghsSylv8bNGKU//oAe6oExUWgFAsDeLy?=
	=?iso-8859-1?q?JQ6CDiHIPfPTPHADnbUfgjuWtRtip1WLKD32SpFcv1mS/zeqDPKyIO0ApajN?=
	=?iso-8859-1?q?Kpqz9tzLIy+fUd9yR+wbtQjpW8lI4oJcf3I9yQQ3f4GyGfzvG1o7YQMqvsqP?=
	=?iso-8859-1?q?I8cgsbZcn2Q52w1j8Ws19WrhkNPiaa4q15P7jeimv5kW+ufQYGjSAFQfWR8v?=
	=?iso-8859-1?q?sirQdozt4uVWeIGE/gTVJbvvKyEkCSxdQWthfM/r1GGfc41LXKTSS6hZKVa3?=
	=?iso-8859-1?q?N1rzx+zDLex4Xhe0GXaidPDT2qUmXWd1jtKhiIY/YzZnG6gC5GoCx3aQTti4?=
	=?iso-8859-1?q?X01Aex3kZjYWAucG5pXJQYy6kl19QPWGOyWUiF4pIPhK6BGc92NhepVyNOXT?=
	=?iso-8859-1?q?7pDDeTWayfcn+u/giBZh8ItKzsDs1kGL4NzPSTeleiYwMsL/6VtbIJPVnrSp?=
	=?iso-8859-1?q?HkkfrH4ZNr/A/y6t6pAyAOs1l5wl2szrLhAJTdK7qNcWt44LG2/t8EYuB6Gy?=
	=?iso-8859-1?q?BCGsAoyF0zbML8lU/DXNm5A9nqWYbftL+32thNU4RdruEjV6QAiadJBDQuKs?=
	=?iso-8859-1?q?/BPKJNt7BYFd82fH86dUHLUZqHNE8yy7iLwF+jSbOC8mOnnAmaV5wb6mgKGn?=
	=?iso-8859-1?q?LZHbexzHCE0gsAXqaYiZPkJHrRITnecUEJTTG0GsP/PY+pKhZoKeLndDWrny?=
	=?iso-8859-1?q?+6LggD8k12/90+CEftbpRGkFdev30FYo62JdNh/3KeV9OwXm5jXyn/Z1lXIq?=
	=?iso-8859-1?q?FnIBO2GMeGxoIkt5oYw9AqNDZt0/6XhUcRY8bgGKtuP55qhN/bWCwnP3bGiB?=
	=?iso-8859-1?q?cEBapY3YN6sdH3zjaLFVihcfPnzAuzOW3jptRn87nleWdKExcWRGDoxdSp0t?=
	=?iso-8859-1?q?ptRoHJPkYpGI0abSdRcDT4E1Zx4+01+xdXMAcrQLivg6IoU0CSmrUveBiQk+?=
	=?iso-8859-1?q?0wO++uuMDuBUtFDd1r1DbRA5BENNItwTKelamXhe/qlZWtTfDf5wVWnganUh?=
	=?iso-8859-1?q?ik3YAa5EbZ8q/PWqawOZDRKV9rcVZybvI1JXDasD6TO1ezjati95pLTcLE8B?=
	=?iso-8859-1?q?1LrPH+O9AKoIG2jtwTRFiFgkujhl1o+maQLoM2wVDKRLumgpBcGYiLxxLzZW?=
	=?iso-8859-1?q?s7jxLb?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?s9tpQj4U3z/H/n3OZ2gIdKR?=
	=?iso-8859-1?q?mbk8mw7/nsBuIpVF/2xSWMFWnRk5Jb+IYgdEXBfV6vQktexL1PFG694LoUcE?=
	=?iso-8859-1?q?CkBbDUz/1gFMuD7zwf7JT88ubonPmrT10oE1SelyUvyqu9fK1DGzceFHOXAO?=
	=?iso-8859-1?q?dzUYmo6AIpYcakw4a3nf8uMEDeJvmjjd8Hcfp/WHq6XLJ/YR7p9ar90l+FxQ?=
	=?iso-8859-1?q?M9xGD+xxLmsw/eQAEYHisSoZkoeRitGMD4Gmspw38uYvsOGds4YTWY+30nJR?=
	=?iso-8859-1?q?oC6ugSL4tvyUrJ/w2lwa03T2uxShXkl6ufXjtsDOlek9kDbwvOnSIR6WqyUE?=
	=?iso-8859-1?q?BqoObVPhOoGrLFNk4tHZaXCY47kOk8fHdOPIatc+XFGmVBGTUZxvOWwgfDqD?=
	=?iso-8859-1?q?D1DkXOxhY1NESrvLTzB2akRASxG5AMGFCrRS3h+8Tsicu4lZBcDpryP0RcYM?=
	=?iso-8859-1?q?E9RywHjU7hLBpVBWQY2hpNulcGfRJEWXls3Fc+Loot5qd/Y0uRPXDERbStbd?=
	=?iso-8859-1?q?JscDTqVHTgFuspgUWtXPrH1OfPFGTT4edqehGiCRm8VbeFpoJHygfTgjQR/Z?=
	=?iso-8859-1?q?ibJ9OzV4Wi28L2eTzSVXO0gO4fs24RYCGPW7hlaZCZ8XthHM/4JBY6hyzUu5?=
	=?iso-8859-1?q?4mpdPNOj+zTgqO2Ej3cuMYejiSM8x9snZEbZhegs3CVUOQBrpB2HsdwZ7aYb?=
	=?iso-8859-1?q?FaJdNR911/Z2e1DT3uivazQBg0HJpGIZnvtzF24vRXyyC8ivHyKt6LdM4PyV?=
	=?iso-8859-1?q?7Uul+XSGVFv9pC/dbsyKRlmjqar2T6AW91V04gL1aP8x4tI8RF7iZ/rynAPa?=
	=?iso-8859-1?q?rkwEJNJw5W73D79CrYZqn6WRH+GkRYtxaQ1DvlaPowjZxWBb72h2yvsKNUkZ?=
	=?iso-8859-1?q?xsTT/qassOP6cv6pykGKFYpVn8ioTruaP2czRTdSP0MGe2S2XY4oA0M4mI3y?=
	=?iso-8859-1?q?FPP7aebK4ibDucUAY5wMGpNxCVaO8V8UDwiDqVoTnOQph0EGBaQbvadBIKS6?=
	=?iso-8859-1?q?qHOhaE/3o/1kwDdBYeLyh0/7TFHMFLDtVs7S2BNBpSEuNbY+vD52S3KOVd6t?=
	=?iso-8859-1?q?QnYa+zme7/34XwkV1kVE11z/kSKWThlGRLf3qdkkIwoxh1R4AiC7RrLCwGcM?=
	=?iso-8859-1?q?ccQi/Q+OwYb3hPd7550/+H8rsA/RC1F2O0Q7UCKmuTs8VkG1JaR6qQf/xNbL?=
	=?iso-8859-1?q?j1wpvl8eaOyEkbJYmRg9kMaeaTVsn2XI+re0sqnkj2PN/eooUC5R7klPLl7I?=
	=?iso-8859-1?q?EGp3pgPJONUZUyK0EqfytkmiZGB9UoE3CN9f5A+6IIdSVHhr3YI2m9kPu1VO?=
	=?iso-8859-1?q?AoHpd4f/UVxpsgohbscxJcQzCf2WXAAgemzCkvJowsDIVHyyCTxE1YuoJYND?=
	=?iso-8859-1?q?a/wO96NGWIZ8cdkLIJsqZudOk8AoxvyN6rUHd3sCDsQHPjHEcIzTBJG9JtHG?=
	=?iso-8859-1?q?II5LmdBzOx9SDs5c83fDwcQZTsTp81oiQoLmEnUU8z8qmp/SVrV5y/ky5pG0?=
	=?iso-8859-1?q?30BJ3kpQ60Ue9/uQumsoiG3N5hejNBjFj5TCoVFOkutGmceXE4rJ/e1mE+Au?=
	=?iso-8859-1?q?A1zW/PL81tY8Mhivfu1tL2kitcicgQw/ZfIdbFURO1npx6ZWnbisgSlRiSEr?=
	=?iso-8859-1?q?7KWpKa0TeRf71cgUrfBEFo7ekohLmjINDWj1cIw=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 8d837b67-b9d5-46ad-c702-08dd45ce1098
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:45.5220 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 g9lITAZ7EI9Egyit8hS5sJeZZSWn1tRxZK5L7KjtRuqEQi3m1qhPc83/s05nw40qVmp/78r+dNaRNaXI7WAgl3iNVxsjbv5HibiTMvIbIpM=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Raspberry PI5 has an external chip RP1 installed which provides
it's own GPIO controller. This driver implements GPIO support
for RP1 GPIO controller.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/gpio/Kconfig    |   7 +
 drivers/gpio/Makefile   |   1 +
 drivers/gpio/rp1_gpio.c | 374 ++++++++++++++++++++++++++++++++++++++++
 3 files changed, 382 insertions(+)
 create mode 100644 drivers/gpio/rp1_gpio.c

diff --git a/drivers/gpio/Kconfig b/drivers/gpio/Kconfig
index b050585389..74d5a4dbbc 100644
--- a/drivers/gpio/Kconfig
+++ b/drivers/gpio/Kconfig
@@ -340,6 +340,13 @@ config RCAR_GPIO
 	help
 	  This driver supports the GPIO banks on Renesas RCar SoCs.
 
+config RP1_GPIO
+	bool "Raspberry PR1 GPIO driver"
+	help
+	  This driver supports the GPIO banks on Raspberry RP1 chip.
+	  Raspberry PI5 has an external chip RP1 installed, which
+	  provides it's own GPIO controller.
+
 config RZA1_GPIO
 	bool "Renesas RZ/A1 GPIO driver"
 	depends on DM_GPIO && RZA1
diff --git a/drivers/gpio/Makefile b/drivers/gpio/Makefile
index 4a29315435..29d0bdf343 100644
--- a/drivers/gpio/Makefile
+++ b/drivers/gpio/Makefile
@@ -30,6 +30,7 @@ obj-$(CONFIG_NPCM_GPIO)      	+= npcm_gpio.o
 obj-$(CONFIG_PCA953X)		+= pca953x.o
 obj-$(CONFIG_ROCKCHIP_GPIO)	+= rk_gpio.o
 obj-$(CONFIG_RCAR_GPIO)		+= gpio-rcar.o
+obj-$(CONFIG_RP1_GPIO)		+= rp1_gpio.o
 obj-$(CONFIG_RZA1_GPIO)		+= gpio-rza1.o
 obj-$(CONFIG_S5P)		+= s5p_gpio.o
 obj-$(CONFIG_SANDBOX_GPIO)	+= sandbox.o sandbox_test.o
diff --git a/drivers/gpio/rp1_gpio.c b/drivers/gpio/rp1_gpio.c
new file mode 100644
index 0000000000..a64af18fcf
--- /dev/null
+++ b/drivers/gpio/rp1_gpio.c
@@ -0,0 +1,374 @@
+// SPDX-License-Identifier: GPL-2.0+
+/*
+ * Copyright (C) 2024 EPAM Systems
+ *
+ * Derived from linux/drivers/pinctrl/pinctl-rp1.c
+ * Copyright (C) 2023 Raspberry Pi Ltd.
+ */
+
+#include <dm.h>
+#include <errno.h>
+#include <asm/gpio.h>
+#include <asm/io.h>
+#include <linux/bitops.h>
+
+#define RP1_NUM_GPIOS	54
+#define RP1_NUM_BANKS	3
+
+#define RP1_RW_OFFSET			0x0000
+#define RP1_XOR_OFFSET			0x1000
+#define RP1_SET_OFFSET			0x2000
+#define RP1_CLR_OFFSET			0x3000
+
+#define RP1_GPIO_STATUS			0x0000
+#define RP1_GPIO_CTRL			0x0004
+
+#define RP1_GPIO_PCIE_INTE		0x011c
+#define RP1_GPIO_PCIE_INTS		0x0124
+
+#define RP1_GPIO_EVENTS_SHIFT_RAW	20
+#define RP1_GPIO_STATUS_FALLING		BIT(20)
+#define RP1_GPIO_STATUS_RISING		BIT(21)
+#define RP1_GPIO_STATUS_LOW		BIT(22)
+#define RP1_GPIO_STATUS_HIGH		BIT(23)
+
+#define RP1_GPIO_EVENTS_SHIFT_FILTERED	24
+#define RP1_GPIO_STATUS_F_FALLING	BIT(24)
+#define RP1_GPIO_STATUS_F_RISING	BIT(25)
+#define RP1_GPIO_STATUS_F_LOW		BIT(26)
+#define RP1_GPIO_STATUS_F_HIGH		BIT(27)
+
+#define RP1_GPIO_CTRL_FUNCSEL_LSB	0
+#define RP1_GPIO_CTRL_FUNCSEL_MASK	0x0000001f
+#define RP1_GPIO_CTRL_OUTOVER_LSB	12
+#define RP1_GPIO_CTRL_OUTOVER_MASK	0x00003000
+#define RP1_GPIO_CTRL_OEOVER_LSB	14
+#define RP1_GPIO_CTRL_OEOVER_MASK	0x0000c000
+#define RP1_GPIO_CTRL_INOVER_LSB	16
+#define RP1_GPIO_CTRL_INOVER_MASK	0x00030000
+#define RP1_GPIO_CTRL_IRQEN_FALLING	BIT(20)
+#define RP1_GPIO_CTRL_IRQEN_RISING	BIT(21)
+#define RP1_GPIO_CTRL_IRQEN_LOW		BIT(22)
+#define RP1_GPIO_CTRL_IRQEN_HIGH	BIT(23)
+#define RP1_GPIO_CTRL_IRQEN_F_FALLING	BIT(24)
+#define RP1_GPIO_CTRL_IRQEN_F_RISING	BIT(25)
+#define RP1_GPIO_CTRL_IRQEN_F_LOW	BIT(26)
+#define RP1_GPIO_CTRL_IRQEN_F_HIGH	BIT(27)
+#define RP1_GPIO_CTRL_IRQRESET		BIT(28)
+#define RP1_GPIO_CTRL_IRQOVER_LSB	30
+#define RP1_GPIO_CTRL_IRQOVER_MASK	0xc0000000
+
+#define RP1_PUD_OFF			0
+#define RP1_PUD_DOWN			1
+#define RP1_PUD_UP			2
+
+#define RP1_FSEL_COUNT			9
+
+#define RP1_FSEL_ALT0			0x00
+#define RP1_FSEL_GPIO			0x05
+#define RP1_FSEL_NONE			0x09
+#define RP1_FSEL_NONE_HW		0x1f
+
+#define RP1_DIR_OUTPUT			0
+#define RP1_DIR_INPUT			1
+
+#define RP1_OUTOVER_PERI		0
+#define RP1_OUTOVER_INVPERI		1
+#define RP1_OUTOVER_LOW			2
+#define RP1_OUTOVER_HIGH		3
+
+#define RP1_OEOVER_PERI			0
+#define RP1_OEOVER_INVPERI		1
+#define RP1_OEOVER_DISABLE		2
+#define RP1_OEOVER_ENABLE		3
+
+#define RP1_INOVER_PERI			0
+#define RP1_INOVER_INVPERI		1
+#define RP1_INOVER_LOW			2
+#define RP1_INOVER_HIGH			3
+
+#define RP1_RIO_OUT			0x00
+#define RP1_RIO_OE			0x04
+#define RP1_RIO_IN			0x08
+
+#define RP1_PAD_SLEWFAST_MASK		0x00000001
+#define RP1_PAD_SLEWFAST_LSB		0
+#define RP1_PAD_SCHMITT_MASK		0x00000002
+#define RP1_PAD_SCHMITT_LSB		1
+#define RP1_PAD_PULL_MASK		0x0000000c
+#define RP1_PAD_PULL_LSB		2
+#define RP1_PAD_DRIVE_MASK		0x00000030
+#define RP1_PAD_DRIVE_LSB		4
+#define RP1_PAD_IN_ENABLE_MASK		0x00000040
+#define RP1_PAD_IN_ENABLE_LSB		6
+#define RP1_PAD_OUT_DISABLE_MASK	0x00000080
+#define RP1_PAD_OUT_DISABLE_LSB		7
+
+#define RP1_PAD_DRIVE_2MA		0x00000000
+#define RP1_PAD_DRIVE_4MA		0x00000010
+#define RP1_PAD_DRIVE_8MA		0x00000020
+#define RP1_PAD_DRIVE_12MA		0x00000030
+
+#define FLD_GET(r, f) (((r) & (f ## _MASK)) >> (f ## _LSB))
+#define FLD_SET(r, f, v) r = (((r) & ~(f ## _MASK)) | ((v) << (f ## _LSB)))
+
+struct rp1_iobank_desc {
+	int min_gpio;
+	int num_gpios;
+	int gpio_offset;
+	int inte_offset;
+	int ints_offset;
+	int rio_offset;
+	int pads_offset;
+};
+
+const struct rp1_iobank_desc rp1_iobanks[RP1_NUM_BANKS] = {
+	/*         gpio   inte    ints     rio    pads */
+	{  0, 28, 0x0000, 0x011c, 0x0124, 0x0000, 0x0004 },
+	{ 28,  6, 0x4000, 0x411c, 0x4124, 0x4000, 0x4004 },
+	{ 34, 20, 0x8000, 0x811c, 0x8124, 0x8000, 0x8004 },
+};
+
+struct rp1_pin_info {
+	u8 num;
+	u8 bank;
+	u8 offset;
+	u8 fsel;
+
+	void __iomem *gpio;
+	void __iomem *rio;
+	void __iomem *inte;
+	void __iomem *ints;
+	void __iomem *pad;
+};
+
+struct rp1_gpio_priv {
+	void __iomem *gpio_base;
+	void __iomem *rio_base;
+	void __iomem *pads_base;
+
+	struct rp1_pin_info pins[RP1_NUM_GPIOS];
+};
+
+static struct rp1_pin_info *rp1_get_pin(struct udevice *dev,
+					unsigned int offset)
+{
+	struct rp1_gpio_priv *priv = dev_get_priv(dev);
+
+	if (priv && offset < RP1_NUM_GPIOS)
+		return &priv->pins[offset];
+
+	return NULL;
+}
+
+static void rp1_pad_update(struct rp1_pin_info *pin, u32 clr, u32 set)
+{
+	u32 padctrl = readl(pin->pad);
+
+	padctrl &= ~clr;
+	padctrl |= set;
+
+	writel(padctrl, pin->pad);
+}
+
+static void rp1_input_enable(struct rp1_pin_info *pin, int value)
+{
+	rp1_pad_update(pin, RP1_PAD_IN_ENABLE_MASK,
+		       value ? RP1_PAD_IN_ENABLE_MASK : 0);
+}
+
+static void rp1_output_enable(struct rp1_pin_info *pin, int value)
+{
+	rp1_pad_update(pin, RP1_PAD_OUT_DISABLE_MASK,
+		       value ? 0 : RP1_PAD_OUT_DISABLE_MASK);
+}
+
+static u32 rp1_get_fsel(struct rp1_pin_info *pin)
+{
+	u32 ctrl = readl(pin->gpio + RP1_GPIO_CTRL);
+	u32 oeover = FLD_GET(ctrl, RP1_GPIO_CTRL_OEOVER);
+	u32 fsel = FLD_GET(ctrl, RP1_GPIO_CTRL_FUNCSEL);
+
+	if (oeover != RP1_OEOVER_PERI || fsel >= RP1_FSEL_COUNT)
+		fsel = RP1_FSEL_NONE;
+
+	return fsel;
+}
+
+static void rp1_set_fsel(struct rp1_pin_info *pin, u32 fsel)
+{
+	u32 ctrl = readl(pin->gpio + RP1_GPIO_CTRL);
+
+	if (fsel >= RP1_FSEL_COUNT)
+		fsel = RP1_FSEL_NONE_HW;
+
+	rp1_input_enable(pin, 1);
+	rp1_output_enable(pin, 1);
+
+	if (fsel == RP1_FSEL_NONE) {
+		FLD_SET(ctrl, RP1_GPIO_CTRL_OEOVER, RP1_OEOVER_DISABLE);
+	} else {
+		FLD_SET(ctrl, RP1_GPIO_CTRL_OUTOVER, RP1_OUTOVER_PERI);
+		FLD_SET(ctrl, RP1_GPIO_CTRL_OEOVER, RP1_OEOVER_PERI);
+	}
+	FLD_SET(ctrl, RP1_GPIO_CTRL_FUNCSEL, fsel);
+
+	writel(ctrl, pin->gpio + RP1_GPIO_CTRL);
+}
+
+static int rp1_get_dir(struct rp1_pin_info *pin)
+{
+	return !(readl(pin->rio + RP1_RIO_OE) & (1 << pin->offset)) ?
+		RP1_DIR_INPUT : RP1_DIR_OUTPUT;
+}
+
+static void rp1_set_dir(struct rp1_pin_info *pin, bool is_input)
+{
+	int offset = is_input ? RP1_CLR_OFFSET : RP1_SET_OFFSET;
+
+	writel(1 << pin->offset, pin->rio + RP1_RIO_OE + offset);
+}
+
+static int rp1_get_value(struct rp1_pin_info *pin)
+{
+	return !!(readl(pin->rio + RP1_RIO_IN) & (1 << pin->offset));
+}
+
+static void rp1_set_value(struct rp1_pin_info *pin, int value)
+{
+	/* Assume the pin is already an output */
+	writel(1 << pin->offset,
+	       pin->rio + RP1_RIO_OUT + (value ? RP1_SET_OFFSET : RP1_CLR_OFFSET));
+}
+
+static int rp1_gpio_get(struct udevice *dev, unsigned int offset)
+{
+	struct rp1_pin_info *pin = rp1_get_pin(dev, offset);
+	int ret;
+
+	if (!pin)
+		return -EINVAL;
+
+	ret = rp1_get_value(pin);
+	return ret;
+}
+
+static int rp1_gpio_set(struct udevice *dev, unsigned int offset, int value)
+{
+	struct rp1_pin_info *pin = rp1_get_pin(dev, offset);
+
+	if (pin)
+		rp1_set_value(pin, value);
+
+	return 0;
+}
+
+static int rp1_gpio_direction_input(struct udevice *dev, unsigned int offset)
+{
+	struct rp1_pin_info *pin = rp1_get_pin(dev, offset);
+
+	if (!pin)
+		return -EINVAL;
+
+	rp1_set_dir(pin, RP1_DIR_INPUT);
+	rp1_set_fsel(pin, RP1_FSEL_GPIO);
+	return 0;
+}
+
+static int rp1_gpio_direction_output(struct udevice *dev, unsigned int offset, int value)
+{
+	struct rp1_pin_info *pin = rp1_get_pin(dev, offset);
+
+	if (!pin)
+		return -EINVAL;
+
+	rp1_set_value(pin, value);
+	rp1_set_dir(pin, RP1_DIR_OUTPUT);
+	rp1_set_fsel(pin, RP1_FSEL_GPIO);
+	return 0;
+}
+
+static int rp1_gpio_get_direction(struct udevice *dev, unsigned int offset)
+{
+	struct rp1_pin_info *pin = rp1_get_pin(dev, offset);
+	u32 fsel;
+
+	if (!pin)
+		return -EINVAL;
+
+	fsel = rp1_get_fsel(pin);
+	if (fsel != RP1_FSEL_GPIO)
+		return -EINVAL;
+
+	return (rp1_get_dir(pin) == RP1_DIR_OUTPUT) ?
+			GPIOF_OUTPUT :
+			GPIOF_INPUT;
+}
+
+static const struct dm_gpio_ops rp1_gpio_ops = {
+	.direction_input = rp1_gpio_direction_input,
+	.direction_output = rp1_gpio_direction_output,
+	.get_value = rp1_gpio_get,
+	.set_value = rp1_gpio_set,
+	.get_function = rp1_gpio_get_direction,
+};
+
+static int rp1_gpio_probe(struct udevice *dev)
+{
+	int i;
+	struct gpio_dev_priv *uc_priv = dev_get_uclass_priv(dev);
+	struct rp1_gpio_priv *priv = dev_get_priv(dev);
+
+	priv->gpio_base = dev_remap_addr_index(dev, 0);
+	if (!priv->gpio_base)
+		return -EINVAL;
+
+	priv->rio_base = dev_remap_addr_index(dev, 1);
+	if (!priv->rio_base)
+		return -EINVAL;
+
+	priv->pads_base = dev_remap_addr_index(dev, 2);
+	if (!priv->pads_base)
+		return -EINVAL;
+
+	uc_priv->gpio_count = RP1_NUM_GPIOS;
+	uc_priv->bank_name = dev->name;
+
+	for (i = 0; i < RP1_NUM_BANKS; i++) {
+		const struct rp1_iobank_desc *bank = &rp1_iobanks[i];
+		int j;
+
+		for (j = 0; j < bank->num_gpios; j++) {
+			struct rp1_pin_info *pin =
+				&priv->pins[bank->min_gpio + j];
+
+			pin->num = bank->min_gpio + j;
+			pin->bank = i;
+			pin->offset = j;
+
+			pin->gpio = priv->gpio_base + bank->gpio_offset +
+				    j * sizeof(u32) * 2;
+			pin->inte = priv->gpio_base + bank->inte_offset;
+			pin->ints = priv->gpio_base + bank->ints_offset;
+			pin->rio  = priv->rio_base + bank->rio_offset;
+			pin->pad  = priv->pads_base + bank->pads_offset +
+				    j * sizeof(u32);
+		}
+	}
+
+	return 0;
+}
+
+static const struct udevice_id rp1_gpio_ids[] = {
+	{ .compatible = "raspberrypi,rp1-gpio" },
+	{ /* sentinel */ }
+};
+
+U_BOOT_DRIVER(rp1_gpio) = {
+	.name = "rp1-gpio",
+	.id = UCLASS_GPIO,
+	.of_match = rp1_gpio_ids,
+	.ops = &rp1_gpio_ops,
+	.priv_auto	= sizeof(struct rp1_gpio_priv),
+	.probe = rp1_gpio_probe,
+};

From patchwork Wed Feb  5 10:15:45 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042693
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=eKnMusmF;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp17M6xVJz1yQ0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:20:15 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 3D9B280BA4;
	Wed,  5 Feb 2025 14:15:40 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="eKnMusmF";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 0671D805D7; Wed,  5 Feb 2025 11:16:00 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-DBA-obe.outbound.protection.outlook.com
 (mail-dbaeur03on20628.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260d::628])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 1BE68806FE
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:55 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=HzCW+zWbGrj58zA1/5dlv+wbmFFC16pCafiPd7UPTm5dTPNVxCkwjKOimW9x8evSta2LFm+HyFcWl13FA01OP3apURN0GoESPcrqi+XsZPvXldGVxj0iUMjZMf5kXKb/bTlpsWA4A36YyRsBu087sEsqujmKn5emeoTsR6YFzwilD8/Z+yUWZ2T0Hp1G8tWmhTKSHPP6f29IK8CpRoathrBbHdXidWQDFQL3BLk24k3Xy5Pj3/Ne7F2MBdaH0b7NMzUSi7QrFBRO7PvisZEuGWKespShDnvc86or0Wk6hoP4bb5ma8anzWUWGIHWil9NIbHda80ToFy7+3lF7dd1Ug==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=aGnXHq0urpmsWE+OBh3BZXz5yHiZkJpw6T9h/7V2QtA=;
 b=LksT9WhGEYaKTfcWjWbo61RIFERPNfMRmUZt1TcF9EsG0oGvTLGDAXqvKt1wtcgW88Ckm1/4+D5G83wAMnBtzlPEb4A1SnlJ3gvrK9HarWfzFxEi0JVIbVBvPxljMUcpUnxFWv43jXDodJgSuq3wNQRZ+saIg/BYhULe7HyBhIDBHn4wKK3tAGjTzRrtmh9CbBa1ixwar8v9CrM/8/vCep8cZDdTfD7NRHCJyxv7o/PxWl9D+aMva5B6qYGPnzobhX2tDDszeu7xZLUVFsLEMy2I+/7AB6u2i5UiLTjVrakkwoL3aIlF695Y4p2ElEqFrk9t+ZzIhMSdsb9bFcOd9w==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=aGnXHq0urpmsWE+OBh3BZXz5yHiZkJpw6T9h/7V2QtA=;
 b=eKnMusmFmSWvppuFLkilYO/IIXTWBHcdeJ1ypqiitMJ/DpJo266D7VDuAAAss+pz6MzW3j1FZ+O/XPP/P6kOYcmqa+P4sh5gMeJAD9FASEyxEDoO3tKcXNDmtfithlm2nsvFU5vjwk8IqK8l1/kAqNaWoEGa2G3g6SZdAZj7tfe7XGoBNtT9H9iaIZdVJ6p/uQCylw6+Mz5kI/K32as/G3vyAVywl1asSHxXDs9+yRCp7WdjQFW8abpgHnIu62txlUuuQtSlw227KRp6LFpLBGyBhUsw7j+u3F9pSMl+I2ytXqSl3dYL8q2Sf6zevb4s+sQ/TtonNiZ2nfRF1RiZaA==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:50 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:50 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 12/20] drivers: reset: introduce reset drivers for
 brcmstb
Thread-Topic: [RFC PATCH v1 12/20] drivers: reset: introduce reset drivers for
 brcmstb
Thread-Index: AQHbd7brRK46kdXDi020vHGfkhgHOw==
Date: Wed, 5 Feb 2025 10:15:45 +0000
Message-ID: 
 <8acccb9f5148d9042ba79249fba8323400374a8a.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 01df82ec-f696-444e-88ac-08dd45ce10ce
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?GZkJdI1Buga7g6Oj8IbDHQrGd2?=
	=?iso-8859-1?q?NID4as33hHuxgBeg3tGp165/n0E2EDyco2MW+PAWQ5J+4tV0kBx3OF70Qs3j?=
	=?iso-8859-1?q?PwcgjjSLDMGYVmylbaPTpBnkn0yvE2t9SPJIsQa5RM4c6GsIeYFXjxAdNy4T?=
	=?iso-8859-1?q?nweULutv75O8cTXw5K31y6AxPot6JfA1+4MzhNwDaDqLIzUmSoWEy32yEb6a?=
	=?iso-8859-1?q?H64dXP3zazvqiEcU7mWXp8OrIjN5iVlnRZaV/NZVxxgYAIeiXZIjnzbEqY44?=
	=?iso-8859-1?q?kmdF2Krm5z2U+gjVT1ss2nSifeC47X5tQKp/wJcxLKgK2buWtGlhaCVQIdMW?=
	=?iso-8859-1?q?52/ZexbSTIAMnL4AlwttvcTYB7qlrffTDTOU0qbevE+CGd43aiXGMtohSDu1?=
	=?iso-8859-1?q?3VNFkAPikXFsdHC1SCN2aq9b3g3c4yiVqlpICg+x+PkM7KqTVTqHKuees5yQ?=
	=?iso-8859-1?q?Cn65IZzUCNQziHOuJ08DR/dvWF9EQwk1Vcc8IJ6V2X2qKi460nDYC/CfLp7U?=
	=?iso-8859-1?q?C+0sbNAtpyKxryZLeZcqdpj8cLO6L9XuTvvNpne+PHfs+9mYvlr9ewahCqQ6?=
	=?iso-8859-1?q?XMZ7s0FH+KalSJMazlBXdpACIF4hdHeVBZRIRbcY++KAjHLeJKoybo8veDUq?=
	=?iso-8859-1?q?rxh8e3wyasPi9XO5hvilZ7nFopPfV2LUOV1W6XoU/esNYLMrsWCTG3sNYBJn?=
	=?iso-8859-1?q?UkTm7P9SgCEFT5/Z3hROBCvaJJslji1BoAr9LW7sLsXGsw6JD7c+SVPnBupb?=
	=?iso-8859-1?q?PbZT7qLel2qwNVmE2Ezibas8IAwV5mIckzkbwWbrj/Yy+7GD1Ltc09aBb54y?=
	=?iso-8859-1?q?q4b8tfrv1kP+VBBomMSBMFh+oJDYa76sytLI9YI+Ow2RSZBYEwRI31pWUFqH?=
	=?iso-8859-1?q?K6tqRDU7soOjnlZWxYds/xPdO0cxb/857LvjCpt7USdakstxq5jlHBF65OnY?=
	=?iso-8859-1?q?fNGc5Y4vZdFZ54wNHwOFUhIk47UIVi8puZeHb11uzH1Dfqe/07yRvvZba37J?=
	=?iso-8859-1?q?x3B+ZYjY/z1mH2obq81rzr9C5+deHc71k8qfXehtx6clXk0IoOuXRN2SMPB3?=
	=?iso-8859-1?q?IYuFW6I73GzcaAyBtfmEFHOa3myJFOT3mnX93TCcIVqmHmSXJOFpMljitLt7?=
	=?iso-8859-1?q?ENRFf5RvBPmKQFm8eSfYyw6ePE1FlLXRfG19WDQn621+MrXOR89klbkiIV4o?=
	=?iso-8859-1?q?rnjwkq5AVSt/Asdg3BjM7mMyRpNNfH7Ph7BLb/tF/bnUCx6z5Qj4DA+0Ssrk?=
	=?iso-8859-1?q?0hjchBYVQ3of1rCFNMhkvi3gBR8XvOui2AKk9tvcU907KD6J+Ic4Ge0ERTKy?=
	=?iso-8859-1?q?2Jvsa3S6an/G/m0jrgjeVZJH7+d0MpZ0IremdCh1wuI2ndh50LXXQ1IR1E3h?=
	=?iso-8859-1?q?whIRez1RaVWUjIsu+Vu8hhmKflCrp3/JlnKx8CiGz9RY0+ga+OiYODSVgkGU?=
	=?iso-8859-1?q?xS75pP+eJ0yow4yzxt2CRZgZ+zYsjjFZysoupQZDNiMtt+MAxlOfR6nIkWmR?=
	=?iso-8859-1?q?7wW5j+?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?MCngpFXHxcv85Iz81A/N3Sk?=
	=?iso-8859-1?q?grfP6I03zCMyzXTLfs+xNj1td+oXnUXiTTwCDR43Kh2Bk8k61R0ugysgxGJn?=
	=?iso-8859-1?q?r8mMFEhfq0kjVAGVf+16pCj33PtcKmPanPsHDZVpmkPKF0mYVSburU7Z9oEc?=
	=?iso-8859-1?q?ulKjWDIgIYvyoLI5ney311fDKluAvp93xWJLXvYlwYbODK90iZurWpzNO1jx?=
	=?iso-8859-1?q?94t1zusS1zIx6pvaNYOu3sJo1r3xz45A8h0k4gO6nHEpzuIwSoQiZSzpz3k7?=
	=?iso-8859-1?q?xgJ91xIwneO0HSpDrbs5kF9YHLN7HOMnl3L2VXP3zS+R2cLEP2TqIJZS1vRF?=
	=?iso-8859-1?q?Nos5POAaRrCnKVqISNUJ7guAxXulCJduxyYWGYH7jOeXw1GMSx67QFP9koam?=
	=?iso-8859-1?q?WHy/UTEbM2+NgdwA6YICOIXmhDTyVBTgscROnSddB53yRbPz0L+JLr7A57hd?=
	=?iso-8859-1?q?Sm7sM9WI9YXlQOj2Pp81TLiYNka35vbKaaKISRfipGsfLTbx8RiftgWtHQId?=
	=?iso-8859-1?q?mAyszBk8AgFq1eeIuQtXmeQXEWAej13NkADja23WY/i1ywh06bBr6/KzTAp8?=
	=?iso-8859-1?q?CRrrmFCbFsEf5/qXVllXIRH35W33f2QJJglFDAgvHo8S/LtVR//hhg1/IgZy?=
	=?iso-8859-1?q?dByxK8noFInE1D0D99jMXXYB/HJHJyVQRbgb16toNnaeF2CFxXqpIwRMU5lq?=
	=?iso-8859-1?q?IME38rscbJpPZdob6b1uLDaDA+vr9XP5niKmBxmiB4COYSgDcR1yOQqUPYOg?=
	=?iso-8859-1?q?Lb63BG2RPwILon68iD/vA82eqGb9BFogEK0jEjfvA8m2CsQkKAOt2+mqnR44?=
	=?iso-8859-1?q?9J7dFClxA2S4rbz4eOBwLM9h/6UmK8PQOxNSgkbJ91eYIUDXyhOMPI7AQccm?=
	=?iso-8859-1?q?t9CvQsVw3iVdUiJryBO/fs6Md4v6AInlfSWZaCyEl5OEuxoWSD8kr3xpH/vr?=
	=?iso-8859-1?q?XZHw5H24Ih5JzOI/v3GZo+aUIMaY0zxPhyToeds4zon0heHcFGHm1BR+My64?=
	=?iso-8859-1?q?R+0wvntYccDarzoCYKQ5WMzX8BrwdLr+9N7g0PX0KfNp0CA4ZAtkETEImky5?=
	=?iso-8859-1?q?uCX7/GJqqVj0RTUZHlp5eBo9sZcH+KcIJgly0roBhU0Es7fhDbIB8ghsHcCM?=
	=?iso-8859-1?q?kpljH6hmlAPE9PKRlyopqKQGPkyIHAGD1c9U3bF/bng29PJVGE9iZY1Tl5jy?=
	=?iso-8859-1?q?45veU4pPrA6sB2GZkyJKHtxHcZFiu4nIJhMx32DAX+vnJLB5iguSXYXrEjic?=
	=?iso-8859-1?q?kLJn7FSahYOaz5dtYRwp+6BMXa+XrIYOhMqNe5ffyVlmACDreztet62OFAwo?=
	=?iso-8859-1?q?4XYTIz6f/Rvx4EuxVnu4xycThhXmIGyLg9DAmPhp/bhYJfcdiR38CFf01OPc?=
	=?iso-8859-1?q?7ijacUbnchYd5UAIjcpt+FTAo8okSGOZIz79GalQjBRpmBBKWKMJriKvFkEt?=
	=?iso-8859-1?q?64TS1wJdddfaxgKF/8VlMKPaGYOH831IBT8YXZj6tyeoFrNIYfkDVdyqlKAX?=
	=?iso-8859-1?q?1E1rZdNgzZBRpm7UbDf1ehhxezq5Cexm1dFn89YjBQ5oRjzNFS5SV9+ILCZB?=
	=?iso-8859-1?q?Xxn7MIkkhfRBOmJBVfR4fiWaLoPQ9kZHPxPT/NQ2UJ1u0Uoo/CsivPQ4GGmD?=
	=?iso-8859-1?q?aCacWRsOvfUDXsoFmqAYM8+Y7KC6K2yOGhjFecw=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 01df82ec-f696-444e-88ac-08dd45ce10ce
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:45.8496 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 oPylEN+us/47g2xR5PBAGp0zp6KgBgqbQWoQnHGWFDRA2n7HVZFl+Gt2wn1W7//tGJEu/JzO/YWH9YlQQPTD81aXqjAWWgHcZj6Ke5uwGvY=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Introducing Generic Reset controller and Generic RESCAL
drivers for Broadcom boards.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/reset/Kconfig                |  14 ++++
 drivers/reset/Makefile               |   2 +
 drivers/reset/reset-brcmstb-rescal.c | 103 +++++++++++++++++++++++++++
 drivers/reset/reset-brcmstb.c        |  97 +++++++++++++++++++++++++
 4 files changed, 216 insertions(+)
 create mode 100644 drivers/reset/reset-brcmstb-rescal.c
 create mode 100644 drivers/reset/reset-brcmstb.c

diff --git a/drivers/reset/Kconfig b/drivers/reset/Kconfig
index fe5c1214f5..cabb9dafe1 100644
--- a/drivers/reset/Kconfig
+++ b/drivers/reset/Kconfig
@@ -63,6 +63,20 @@ config RESET_BCM6345
 	help
 	  Support reset controller on BCM6345.
 
+config RESET_BRCMSTB
+	bool "Generic Reset controller driver for Broadcom"
+	help
+	  This enables reset controller for Broadcom devices.
+	  If you wish to use reset resources managed by the Broadcom
+	  Reset Controller, say Y here. Otherwise, say N.
+
+config RESET_BRCMSTB_RESCAL
+	bool "Generic Rescal Reset controller driver for Broadcom"
+	help
+	  Support rescal reset controller on Broadcom.
+	  If you wish to use reset resources managed by the Broadcom
+	  Reset Controller, say Y here. Otherwise, say N.
+
 config RESET_UNIPHIER
 	bool "Reset controller driver for UniPhier SoCs"
 	depends on ARCH_UNIPHIER
diff --git a/drivers/reset/Makefile b/drivers/reset/Makefile
index 2eb639e4a6..45cf2f1b4d 100644
--- a/drivers/reset/Makefile
+++ b/drivers/reset/Makefile
@@ -13,6 +13,8 @@ obj-$(CONFIG_TEGRA186_RESET) += tegra186-reset.o
 obj-$(CONFIG_RESET_TI_SCI) += reset-ti-sci.o
 obj-$(CONFIG_RESET_HSDK) += reset-hsdk.o
 obj-$(CONFIG_RESET_BCM6345) += reset-bcm6345.o
+obj-$(CONFIG_RESET_BRCMSTB) += reset-brcmstb.o
+obj-$(CONFIG_RESET_BRCMSTB_RESCAL) += reset-brcmstb-rescal.o
 obj-$(CONFIG_RESET_UNIPHIER) += reset-uniphier.o
 obj-$(CONFIG_RESET_AST2500) += reset-ast2500.o
 obj-$(CONFIG_RESET_AST2600) += reset-ast2600.o
diff --git a/drivers/reset/reset-brcmstb-rescal.c b/drivers/reset/reset-brcmstb-rescal.c
new file mode 100644
index 0000000000..fc8fcfa8b3
--- /dev/null
+++ b/drivers/reset/reset-brcmstb-rescal.c
@@ -0,0 +1,103 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ * Broadcom STB generic reset controller
+ *
+ * Copyright (C) 2024 EPAM Systems
+ * Moved from linux kernel:
+ * Copyright (C) 2018-2020 Broadcom
+ */
+
+#include <asm/io.h>
+#include <dm.h>
+#include <dm/device_compat.h>
+#include <errno.h>
+#include <linux/bitops.h>
+#include <linux/delay.h>
+#include <linux/iopoll.h>
+#include <log.h>
+#include <malloc.h>
+#include <reset-uclass.h>
+
+#define BRCM_RESCAL_START 0x0
+#define BRCM_RESCAL_START_BIT BIT(0)
+#define BRCM_RESCAL_CTRL 0x4
+#define BRCM_RESCAL_STATUS 0x8
+#define BRCM_RESCAL_STATUS_BIT BIT(0)
+
+struct brcm_rescal_reset {
+	void __iomem *base;
+};
+
+/* Also doubles a deassert */
+static int brcm_rescal_reset_set(struct reset_ctl *rst)
+{
+	struct brcm_rescal_reset *data = dev_get_priv(rst->dev);
+	void __iomem *base = data->base;
+	u32 reg;
+	int ret;
+
+	reg = readl(base + BRCM_RESCAL_START);
+	writel(reg | BRCM_RESCAL_START_BIT, base + BRCM_RESCAL_START);
+	reg = readl(base + BRCM_RESCAL_START);
+	if (!(reg & BRCM_RESCAL_START_BIT)) {
+		dev_err(rst->dev, "failed to start SATA/PCIe rescal\n");
+		return -EIO;
+	}
+
+	ret = readl_poll_timeout(base + BRCM_RESCAL_STATUS, reg,
+				 (reg & BRCM_RESCAL_STATUS_BIT), 100);
+	if (ret) {
+		dev_err(rst->dev, "time out on SATA/PCIe rescal\n");
+		return ret;
+	}
+
+	reg = readl(base + BRCM_RESCAL_START);
+	writel(reg & ~BRCM_RESCAL_START_BIT, base + BRCM_RESCAL_START);
+
+	dev_dbg(rst->dev, "SATA/PCIe rescal success\n");
+	return 0;
+}
+
+/* A dummy function - deassert/reset does all the work */
+static int brcm_rescal_reset_assert(struct reset_ctl *rst)
+{
+	return 0;
+}
+
+static int brcm_rescal_reset_xlate(struct reset_ctl *reset_ctl,
+				   struct ofnode_phandle_args *args)
+{
+	/* This is needed if #reset-cells == 0. */
+	return 0;
+}
+
+static const struct reset_ops brcm_rescal_reset_ops = {
+	.rst_deassert = brcm_rescal_reset_set,
+	.rst_assert = brcm_rescal_reset_assert,
+	.of_xlate = brcm_rescal_reset_xlate,
+};
+
+static int brcm_rescal_reset_probe(struct udevice *dev)
+{
+	struct brcm_rescal_reset *data = dev_get_priv(dev);
+
+	data->base = dev_remap_addr(dev);
+	if (!data->base)
+		return -EINVAL;
+
+	return 0;
+}
+
+static const struct udevice_id brcm_rescal_reset_of_match[] = {
+	{.compatible = "brcm,bcm7216-pcie-sata-rescal"},
+	{},
+};
+
+U_BOOT_DRIVER(brcmstb_reset_rescal) = {
+	.name = "brcmstb-reset-rescal",
+	.id = UCLASS_RESET,
+	.of_match = brcm_rescal_reset_of_match,
+	.ops = &brcm_rescal_reset_ops,
+	.probe = brcm_rescal_reset_probe,
+	.priv_auto = sizeof(struct brcm_rescal_reset),
+};
diff --git a/drivers/reset/reset-brcmstb.c b/drivers/reset/reset-brcmstb.c
new file mode 100644
index 0000000000..7861f7c9ba
--- /dev/null
+++ b/drivers/reset/reset-brcmstb.c
@@ -0,0 +1,97 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ * Broadcom STB generic reset controller
+ *
+ * Copyright (C) 2024 EPAM Systems
+ *
+ * Moved from linux kernel:
+ * Author: Florian Fainelli <f.fainelli@gmail.com>
+ * Copyright (C) 2018 Broadcom
+ */
+
+#include <asm/io.h>
+#include <dm.h>
+#include <errno.h>
+#include <linux/bitops.h>
+#include <linux/delay.h>
+#include <log.h>
+#include <malloc.h>
+#include <reset-uclass.h>
+
+struct brcmstb_reset {
+	void __iomem *base;
+};
+
+#define SW_INIT_SET 0x00
+#define SW_INIT_CLEAR 0x04
+#define SW_INIT_STATUS 0x08
+
+#define SW_INIT_BIT(id) BIT((id) & 0x1f)
+#define SW_INIT_BANK(id) ((id) >> 5)
+
+#define usleep_range(a, b) udelay((b))
+
+/* A full bank contains extra registers that we are not utilizing but still
+ * qualify as a single bank.
+ */
+#define SW_INIT_BANK_SIZE 0x18
+
+static int brcmstb_reset_assert(struct reset_ctl *rst)
+{
+	unsigned int off = SW_INIT_BANK(rst->id) * SW_INIT_BANK_SIZE;
+	struct brcmstb_reset *priv = dev_get_priv(rst->dev);
+
+	writel_relaxed(SW_INIT_BIT(rst->id), priv->base + off + SW_INIT_SET);
+	return 0;
+}
+
+static int brcmstb_reset_deassert(struct reset_ctl *rst)
+{
+	unsigned int off = SW_INIT_BANK(rst->id) * SW_INIT_BANK_SIZE;
+	struct brcmstb_reset *priv = dev_get_priv(rst->dev);
+
+	writel_relaxed(SW_INIT_BIT(rst->id), priv->base + off + SW_INIT_CLEAR);
+	/* Maximum reset delay after de-asserting a line and seeing block
+	 * operation is typically 14us for the worst case, build some slack
+	 * here.
+	 */
+	usleep_range(100, 200);
+	return 0;
+}
+
+static int brcmstb_reset_status(struct reset_ctl *rst)
+{
+	unsigned int off = SW_INIT_BANK(rst->id) * SW_INIT_BANK_SIZE;
+	struct brcmstb_reset *priv = dev_get_priv(rst->dev);
+
+	return readl_relaxed(priv->base + off + SW_INIT_STATUS) &
+			SW_INIT_BIT(rst->id);
+}
+
+struct reset_ops brcmstb_reset_reset_ops = {
+	.rst_assert = brcmstb_reset_assert,
+	.rst_deassert = brcmstb_reset_deassert,
+	.rst_status = brcmstb_reset_status};
+
+static int brcmstb_reset_probe(struct udevice *dev)
+{
+	struct brcmstb_reset *priv = dev_get_priv(dev);
+
+	priv->base = dev_remap_addr(dev);
+	if (!priv->base)
+		return -EINVAL;
+
+	return 0;
+}
+
+static const struct udevice_id brcmstb_reset_ids[] = {
+	{.compatible = "brcm,brcmstb-reset"}, {/* sentinel */}};
+
+U_BOOT_DRIVER(brcmstb_reset) = {
+	.name = "brcmstb-reset",
+	.id = UCLASS_RESET,
+	.of_match = brcmstb_reset_ids,
+	.ops = &brcmstb_reset_reset_ops,
+	.probe = brcmstb_reset_probe,
+	.priv_auto = sizeof(struct brcmstb_reset),
+};

From patchwork Wed Feb  5 10:15:46 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042690
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=hv5OD8C6;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=85.214.62.61; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de [85.214.62.61])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp16q5RY7z20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:19:47 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 4223080C7E;
	Wed,  5 Feb 2025 14:15:39 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="hv5OD8C6";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 9151D80207; Wed,  5 Feb 2025 11:15:58 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-DBA-obe.outbound.protection.outlook.com
 (mail-dbaeur03on20628.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260d::628])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 3847E80711
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:55 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=LFo1xhOJZ6HK7yh/U7uRI+cfCBPwah+cet8FFmwIKdYOHtayOZSVyuwEjoX87YTtNlnS2BGWbk685DtM1HfLMR8YUJwCeiBL70GXgfEloiDnD+58u5+isRjgIQpTUY1nLg24OJZh+MjoUa7NdFiSEVezSm7K8G5HjQE0mNzYN9YGI9H682C8DvZgXWqBg0N5e0l8gOnfmRDWJ92WHZE7gDm0dj93i9MhEtNKwCPfmvDcbffiDJmRgVeDqHGVMKN13wjAk7TI+HMCdnWSnLEqBloUD+s3SC/AdSHHHT+K6njBMpEF+eSSNzqEQ6I8yxXg3Y02nA+UWVNH6PlVNB7v4Q==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=jCFxh7qrjP8/0K25Ubemmvb9B3rHJMr/nVvIEIflTl0=;
 b=RbJTzZszB/Jg+1qyJph7u4REBQk1nhGVCwljShJJ5xETl8MxPxO1l0PxyF7mhAm5wjapNhzhRsnd8njX+anTW3dy0Yk1KIqXFDl7pOfuWBCfBcnfmL5YkAlutEDzmoHrX40UqRgs0qecTCrA4QYQ15DwtN85T20ibjCPmwp0ZIMPBbtZeoJdmqcgy8XXWfWwQteOHV2KsJbVhr/8J3KkCHPYLg0/32JCKX/zf08/CmKzwsMWDnav42+FI8kNGzRSbAzopR0884y/bO1ZjgMkLDBkvOm3PpHLiqtNJMPiFuo7fLmESVrl2Hn/thmjaBfG1Yl8JmWrWJ0GgwVepx1QsA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=jCFxh7qrjP8/0K25Ubemmvb9B3rHJMr/nVvIEIflTl0=;
 b=hv5OD8C6Lqq96iFqh7NUqxhnPtML0eaSHPPK6AZsiIGaKNN7Niy5xaW5h5yVxWRY6uNCpoMtzItbIOHxrFn/hPmYbMQd8yXxP3fPjWFvo/GPoJ05Ugq1lh3vyueVWks7ki4SAvJ/8X1/mc7BTEIAFy/no65cNMl52oTWjdwCdv+n3joFL73b770QwG2YWHx+vbiMABvoGGV/nX4hsTr/PgVYjpVlYQlVaGNttR4/LSBGly9GaGB3YmWbXAO6v3s5aVZypu8khJgvdCWLDUyWtPHf5NdzOTt5qIXC/LsQIzpKl7Rpq4P3A7bsAerhhFCsMSlgrp7Fhu9K/YIkxgDydA==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:50 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:50 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Lukasz Majewski
 <lukma@denx.de>, Sean Anderson <seanga2@gmail.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 13/20] drivers: clk: introduce clock driver for RP1
Thread-Topic: [RFC PATCH v1 13/20] drivers: clk: introduce clock driver for
 RP1
Thread-Index: AQHbd7brDjRxS0Vj0UK0xdoVp3M/+g==
Date: Wed, 5 Feb 2025 10:15:46 +0000
Message-ID: 
 <2562959a824dd9268e5a2ccd93c67232614a5e1d.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: d0e7caaa-85ca-4f69-5a46-08dd45ce1104
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?nPaunY5ETTv1Uj7d8rxbWTVI5o?=
	=?iso-8859-1?q?lnivr7/70ar2ZbRqVkGV0EOxSlF4ByPXSEn2iRJfrVC5nnTbAznnr8b9m15T?=
	=?iso-8859-1?q?bKiUUB/cV7wxIIf3hD2mcsnm4X4nrmqCWF2y9cJh/mC15lwc4o9Eysku+4U4?=
	=?iso-8859-1?q?YW9S3qwRbNRYskhFOv4ZZwsGNvHyP/ad7lHIHcWi3cTO+kZV/19Q5wdaLTxx?=
	=?iso-8859-1?q?aV2hMzGA6HghlRxhqO3UF+504D/L4OehXERrFRVAqXflBZlgngBcNPYaaT49?=
	=?iso-8859-1?q?kVZIYXHbFA5P83AXETRQMbN8lHVaUdjhNO616wpEcYPOWemm3lZCC0t4GvWh?=
	=?iso-8859-1?q?tF7Oqu8q+kXkDhitu/F8Euq2xM8GaeZbeFtXhAtjwGjZJPosaEjykKd6X9XJ?=
	=?iso-8859-1?q?ytKi0bzLMuUSSvGBQhRLTcfb7RPPfLDlgFxpGcTW0RXKxqGkxOjaA70LtC4G?=
	=?iso-8859-1?q?A2BmhBjn7Eds3LSuCPm4Sd7XE3fwlsQCoWqvpe3C24dV5eYJajd2HS1joOU2?=
	=?iso-8859-1?q?GIcyerWsGlSJcAGKCqV3TBEXdSpd5Th86JmIBmSvRV0nH2rklnoh4wawU2QD?=
	=?iso-8859-1?q?Nt1bXYGWQXUxY5decKS8s+LnRI6WzhpVEOQbbk4UlNqcws+wR4k0V4qFjR2q?=
	=?iso-8859-1?q?lX8K1srz8vaRzBN9XPrzAkQ/cXnYwBtvd57bAaT7ppBQ/wJCFKsi618d9pHW?=
	=?iso-8859-1?q?32fj/o+sgkg+iXRO/Et5OwMiMxzJAvW6rwWPUWxcnH78++Ryjo2QnhxU3iDJ?=
	=?iso-8859-1?q?QS0elL/KTtTXkMCqIY838Qck2gFabqUK8sr43ODfoKxbZ7kOTePCKqvviWuH?=
	=?iso-8859-1?q?QR0bDA45SgBQt0gP8ixNEoLD3ZcSDmDAmjJnXVe1KH8RM/7Q+Y25bVufDRoq?=
	=?iso-8859-1?q?WzIH8p03A9P4Vhzlj0s0VUW8/tv6XwBCrC0aw3L6JNSVzEARoNhLd+YWSC9P?=
	=?iso-8859-1?q?mWkUC4XY7Aod4RwiQh56LcvRzHaTsYj64yfpk4z2L5Ini9qPKsbZTd7o7XvW?=
	=?iso-8859-1?q?pdE8DG50QBbZIdRVQ7DZ0xlH5RfOyuEjoOsiWId6ksCwBCREiDNj3hE659SM?=
	=?iso-8859-1?q?CjlEBbg/v8IO0fWjSr2Rn+KXhjaU3XkmVgvESf7ad+F/5WHqvpil/00lK0UH?=
	=?iso-8859-1?q?ulRb9qlQ23Q/iOi189lpbGAp8Q7ksV1aSa/zkpHrt1u9reQ7G6SCNpp86wlF?=
	=?iso-8859-1?q?ihwMonnMN7kTuZeZG+vx2Cxmdc/1UoP3jI+TGvu7gNwGInFiK/DK7ohJmalG?=
	=?iso-8859-1?q?qjdxKB6jOrDshMWXp579RXVg0DQ8wFt3rbCgHvbM9ATtAEnN1i2P4bjCBNqe?=
	=?iso-8859-1?q?BbL2Q94cHV01es6ptnHfw61rOM71uJqI7vROJLgLTb0zI/XGHKa7tKb8P/0J?=
	=?iso-8859-1?q?IIu/3Ldx7m5SQhOskmLn+GAYhXFtCNkTz4FcujbN8KGzpya4QSWsd983M9X9?=
	=?iso-8859-1?q?k+YPyldwXmtBr7b3qZd/mHYdoKl/Wyg1HvI7gDu+MD7Tez2KQqzH+RBqipQ0?=
	=?iso-8859-1?q?WEwH6c?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?tAK9bQmZ8cBtypqlnnAeVrd?=
	=?iso-8859-1?q?y08VWEZopPLwqX7S/O6c+Mn0V1pIdKga5qh1NBAyfMqnxKq4Lr8tjfYn0oiw?=
	=?iso-8859-1?q?coZegdliKrYAlgkQpGPffev1qRCL2wfnorOdL+tbVuLoedHWWRHUV9NcxcrB?=
	=?iso-8859-1?q?W+/5f/1/16LDFQaz0nhA39160NlyC0lOr9eUd/azxI5mOA3xyGEI/bq6wjhw?=
	=?iso-8859-1?q?c27GzKNhvUyYdbLlui4tzHTVRmlmtyWSf7WE2khsT2dYpIDRNzE/f2gyPEX6?=
	=?iso-8859-1?q?3yRtRWPr6mKoGQcBTWjQ8PxFgN6JMkpzjwPnDpV3ig7qyfgQP5658+lYxkyb?=
	=?iso-8859-1?q?pKAB/FXtv/VG6dIr/jAh7lEdz8EeukcsfLLglE0S8eVFW1s7vwlkZh/itUJC?=
	=?iso-8859-1?q?UQdpItdwQMM0IkS6esZpy13OwIGOM+ae/fJIIlkh8zskpoULcEvO5f+PxOm1?=
	=?iso-8859-1?q?S+u/Geks6mqVHYaQoPU0VrB/bs52L6kCFtzudsdxVVUbfdNLgrhhdFKNmkaT?=
	=?iso-8859-1?q?mMx2qtP8nawHRILp+3d8oeLVCdkVo36WeRpfJ2o5OVZz8DzjU1cKZbpbY8HL?=
	=?iso-8859-1?q?QfPjpN4Z2bZdYfGA1j6BMqYjuYRjiXkROsqDKmCm6LrTLM2gf3Yae5XHMemQ?=
	=?iso-8859-1?q?+iw8jUPRd/qY+xVv3PXHTyh7HRj7fadWdfEE8F1OtnvJD5yYlcA67oF553H5?=
	=?iso-8859-1?q?xKv+5WJwUCbM9bh1hKTPjP+5QPi6F1nU1QQft27JdQXfbN8g57tqoIU9K/RB?=
	=?iso-8859-1?q?nJqW1nSRFqknwpExSPuk1WIHNwlD/Is3j0HhlqPWv37/zV0/c/vDmyGSIdCw?=
	=?iso-8859-1?q?nXc0669vpMC/5KjeyOwJmLAK/sF15fr1Ihihp3vbrTC0PtJegt+tyFjOiHV+?=
	=?iso-8859-1?q?ahClpKld6QdH+NItAIPpfwrgQhtElYY9XEC0fQSC4uLQV/DUY2q4a6hnr1xi?=
	=?iso-8859-1?q?bTp5JtaYvjrV7QTqX7sm514l0GsUA1ajkCETWjZzDC4reLFXwvQO8TteKotT?=
	=?iso-8859-1?q?iwBmRT4q5OzYQE/nRddldNJMdV58cIj4IGVwPErcBBiPCNv7RsBVe1cGLv0E?=
	=?iso-8859-1?q?azijUCufsUGeGY98JSDHe0E4RLBMxm7dQhb8Au1ZmbBfpA4UcxnykfPjdOlW?=
	=?iso-8859-1?q?WHoQ3A8UkrBJMSq3N3xceBgmRg+n+BpGEdI8venWKUssVRbGptMyAn8IuUo7?=
	=?iso-8859-1?q?wJL6noNVtNayi1xspqzxyaoTtlL6bTLyj+9Zi21udhX6PUm9rDzcV7L62gqG?=
	=?iso-8859-1?q?RtICt5oMo14Ib4fdVNi6LrGs39GpTe5oL/N9rdkcx1bCkR1Pj5d1z4D2RjZD?=
	=?iso-8859-1?q?v1Udd2kPaw2YV605FcDX7V7W1DHbLprWJvO1EjJY13i9vrhOCfG6nbGJCc2P?=
	=?iso-8859-1?q?CvLlCHhYNGRMkyzTvgGds7SgtR9rhyskgtwWD0I1sYxnFld1AO2CMqmx0s8G?=
	=?iso-8859-1?q?m7d8tWN0qwj6SKh88mhr2PIL1ie89Km4AWj3rhQYNnfandhrgenoL7XkT3Mf?=
	=?iso-8859-1?q?JJeuPnL0s2J9qcb1nAnZoXDAHu/S05ASnd3GyJrnGTxbnzKpROBr5J2pY9KT?=
	=?iso-8859-1?q?IaHQjN59bFi5SkHmNTgLangWYe2Lkm4korVNau0JLU+t/G59CL8rc1bgTKUZ?=
	=?iso-8859-1?q?dTBRfdki0NYxqbU9jiWJ6Wv+PFH1H3O7e2mGY/A=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 d0e7caaa-85ca-4f69-5a46-08dd45ce1104
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:46.2985 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 KdgVPzJFrvpuYaDFJ/DDvUE7lcdTkw/h4oWGvpVGSOA8SC/amvIRad3e6c90QEGcSzvzEMyn/s82/agzBM2AvDsOQa6nwSm9hs+A88jH3aw=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Introduce clock driver for RPI5 RP1 chip. It is intended to
work with a clock controller connected to the RP1 chip of RPI5.
Current implementation supports only RP1_CLK_ETH_TSU clock.
Additional clock could be added to the rp1_data array if needed.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/clk/Kconfig   |   7 ++
 drivers/clk/Makefile  |   1 +
 drivers/clk/clk-rp1.c | 280 ++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 288 insertions(+)
 create mode 100644 drivers/clk/clk-rp1.c

diff --git a/drivers/clk/Kconfig b/drivers/clk/Kconfig
index 017dd260a5..869d7591a6 100644
--- a/drivers/clk/Kconfig
+++ b/drivers/clk/Kconfig
@@ -163,6 +163,13 @@ config CLK_OCTEON
 	help
 	  Enable this to support the clocks on Octeon MIPS platforms.
 
+config CLK_RP1
+	bool "Raspberry Pi RP1-based clock support"
+	depends on PCI && CLK
+	help
+	  Enable common clock framework support for Raspberry Pi RP1
+	  support.
+
 config SANDBOX_CLK_CCF
 	bool "Sandbox Common Clock Framework [CCF] support "
 	depends on SANDBOX
diff --git a/drivers/clk/Makefile b/drivers/clk/Makefile
index 638ad04bae..74d1408369 100644
--- a/drivers/clk/Makefile
+++ b/drivers/clk/Makefile
@@ -56,3 +56,4 @@ obj-$(CONFIG_MACH_PIC32) += clk_pic32.o
 obj-$(CONFIG_SANDBOX_CLK_CCF) += clk_sandbox_ccf.o
 obj-$(CONFIG_SANDBOX) += clk_sandbox.o
 obj-$(CONFIG_SANDBOX) += clk_sandbox_test.o
+obj-$(CONFIG_CLK_RP1) += clk-rp1.o
diff --git a/drivers/clk/clk-rp1.c b/drivers/clk/clk-rp1.c
new file mode 100644
index 0000000000..94e1227134
--- /dev/null
+++ b/drivers/clk/clk-rp1.c
@@ -0,0 +1,280 @@
+// SPDX-License-Identifier: GPL-2.0+
+/*
+ * Clock driver for RP1 PCIe multifunction chip.
+ *
+ * Copyright (C) 2024 EPAM Systems
+ *
+ * Derived from linux clk-rp1 driver
+ *   Copyright (C) 2023 Raspberry Pi Ltd.
+ */
+
+#include <clk.h>
+#include <clk-uclass.h>
+#include <dm.h>
+#include <errno.h>
+#include <asm/io.h>
+#include <linux/bitops.h>
+#include <linux/clk-provider.h>
+#include <linux/math64.h>
+
+#include <dt-bindings/clk/rp1.h>
+
+#define GPCLK_OE_CTRL			0x00000
+
+#define CLK_ETH_TSU_CTRL		0x00134
+#define CLK_ETH_TSU_DIV_INT		0x00138
+#define CLK_ETH_TSU_SEL			0x00140
+
+#define FC_NUM(idx, off)		((idx) * 32 + (off))
+
+#define DIV_INT_8BIT_MAX		0x000000ffu /* max divide for most clocks */
+
+/* Clock fields for all clocks */
+#define CLK_CTRL_ENABLE			BIT(11)
+#define CLK_DIV_FRAC_BITS		16
+
+#define KHz				1000
+#define MHz				(KHz * KHz)
+
+#define MAX_CLK_PARENTS	16
+#define DIV_U64_NEAREST(a, b) div_u64(((a) + ((b) >> 1)), (b))
+
+struct rp1_clockman {
+	struct udevice *dev;
+	void __iomem *regs;
+	spinlock_t regs_lock; /* spinlock for all clocks */
+};
+
+struct rp1_pll_core_data {
+	const char *name;
+	u32 cs_reg;
+	u32 pwr_reg;
+	u32 fbdiv_int_reg;
+	u32 fbdiv_frac_reg;
+	unsigned long flags;
+	u32 fc0_src;
+};
+
+struct rp1_pll_data {
+	const char *name;
+	const char *source_pll;
+	u32 ctrl_reg;
+	unsigned long flags;
+	u32 fc0_src;
+};
+
+struct rp1_pll_ph_data {
+	const char *name;
+	const char *source_pll;
+	unsigned int phase;
+	unsigned int fixed_divider;
+	u32 ph_reg;
+	unsigned long flags;
+	u32 fc0_src;
+};
+
+struct rp1_pll_divider_data {
+	const char *name;
+	const char *source_pll;
+	u32 sec_reg;
+	unsigned long flags;
+	u32 fc0_src;
+};
+
+struct rp1_clock_data {
+	const char *name;
+	const char *const parents[MAX_CLK_PARENTS];
+	int num_std_parents;
+	int num_aux_parents;
+	unsigned long flags;
+	u32 oe_mask;
+	u32 clk_src_mask;
+	u32 ctrl_reg;
+	u32 div_int_reg;
+	u32 div_frac_reg;
+	u32 sel_reg;
+	u32 div_int_max;
+	unsigned long max_freq;
+	u32 fc0_src;
+};
+
+struct rp1_pll_core {
+	struct clk hw;
+	struct rp1_clockman *clockman;
+	const struct rp1_pll_core_data *data;
+	unsigned long cached_rate;
+};
+
+struct rp1_pll {
+	struct clk hw;
+	struct clk_divider div;
+	struct rp1_clockman *clockman;
+	const struct rp1_pll_data *data;
+	unsigned long cached_rate;
+};
+
+struct rp1_pll_ph {
+	struct clk hw;
+	struct rp1_clockman *clockman;
+	const struct rp1_pll_ph_data *data;
+};
+
+struct rp1_clock {
+	struct clk hw;
+	struct rp1_clockman *clockman;
+	const struct rp1_clock_data *data;
+	unsigned long cached_rate;
+};
+
+struct rp1_clk_change {
+	struct clk *hw;
+	unsigned long new_rate;
+};
+
+struct rp1_clk_change rp1_clk_chg_tree[3];
+
+static inline
+void clockman_write(struct rp1_clockman *clockman, u32 reg, u32 val)
+{
+	writel(val, clockman->regs + reg);
+}
+
+static inline u32 clockman_read(struct rp1_clockman *clockman, u32 reg)
+{
+	return readl(clockman->regs + reg);
+}
+
+static struct rp1_clock_data rp1_data[] = {
+[RP1_CLK_ETH_TSU] = {
+			.name = "clk_eth_tsu",
+			.parents = {"xosc",
+				    "pll_video_sec",
+				    "clksrc_gp0",
+				    "clksrc_gp1",
+				    "clksrc_gp2",
+				    "clksrc_gp3",
+				    "clksrc_gp4",
+				    "clksrc_gp5"},
+			.num_std_parents = 0,
+			.num_aux_parents = 8,
+			.ctrl_reg = CLK_ETH_TSU_CTRL,
+			.div_int_reg = CLK_ETH_TSU_DIV_INT,
+			.div_frac_reg = 0,
+			.sel_reg = CLK_ETH_TSU_SEL,
+			.div_int_max = DIV_INT_8BIT_MAX,
+			.max_freq = 50 * MHz,
+			.fc0_src = FC_NUM(5, 7),
+	},
+};
+
+static u32 rp1_clock_choose_div(unsigned long rate, unsigned long parent_rate,
+				const struct rp1_clock_data *data)
+{
+	u64 div;
+
+	/*
+	 * Due to earlier rounding, calculated parent_rate may differ from
+	 * expected value. Don't fail on a small discrepancy near unity divide.
+	 */
+	if (!rate || rate > parent_rate + (parent_rate >> CLK_DIV_FRAC_BITS))
+		return 0;
+
+	/*
+	 * Always express div in fixed-point format for fractional division;
+	 * If no fractional divider is present, the fraction part will be zero.
+	 */
+	if (data->div_frac_reg) {
+		div = (u64)parent_rate << CLK_DIV_FRAC_BITS;
+		div = DIV_U64_NEAREST(div, rate);
+	} else {
+		div = DIV_U64_NEAREST(parent_rate, rate);
+		div <<= CLK_DIV_FRAC_BITS;
+	}
+
+	div = clamp(div,
+		    1ull << CLK_DIV_FRAC_BITS,
+		    (u64)data->div_int_max << CLK_DIV_FRAC_BITS);
+
+	return div;
+}
+
+static ulong rp1_clock_set_rate(struct clk *hw, unsigned long rate)
+{
+	struct rp1_clockman *clockman = dev_get_priv(hw->dev);
+	const struct rp1_clock_data *data = &rp1_data[hw->id];
+	u32 div = rp1_clock_choose_div(rate, 0x2faf080, data);
+
+	if (hw->id != RP1_CLK_ETH_TSU)
+		return 0;
+
+	WARN(rate > 4000000000ll, "rate is -ve (%d)\n", (int)rate);
+
+	if (WARN(!div,
+		 "clk divider calculated as 0! (%s, rate %ld, parent rate %d)\n",
+		 data->name, rate, 0x2faf080))
+		div = 1 << CLK_DIV_FRAC_BITS;
+
+	spin_lock(&clockman->regs_lock);
+
+	clockman_write(clockman, data->div_int_reg, div >> CLK_DIV_FRAC_BITS);
+	if (data->div_frac_reg)
+		clockman_write(clockman, data->div_frac_reg, div << (32 - CLK_DIV_FRAC_BITS));
+
+	spin_unlock(&clockman->regs_lock);
+
+	return 0;
+}
+
+static int rp1_clock_on(struct clk *hw)
+{
+	const struct rp1_clock_data *data = &rp1_data[hw->id];
+	struct rp1_clockman *clockman = dev_get_priv(hw->dev);
+
+	if (hw->id != RP1_CLK_ETH_TSU)
+		return 0;
+
+	spin_lock(&clockman->regs_lock);
+	clockman_write(clockman, data->ctrl_reg,
+		       clockman_read(clockman, data->ctrl_reg) | CLK_CTRL_ENABLE);
+	/* If this is a GPCLK, turn on the output-enable */
+	if (data->oe_mask)
+		clockman_write(clockman, GPCLK_OE_CTRL,
+			       clockman_read(clockman, GPCLK_OE_CTRL) | data->oe_mask);
+
+	spin_unlock(&clockman->regs_lock);
+
+	return 0;
+}
+
+static int rp1_clk_probe(struct udevice *dev)
+{
+	struct rp1_clockman *clockman = dev_get_priv(dev);
+
+	spin_lock_init(&clockman->regs_lock);
+
+	clockman->regs = dev_remap_addr(dev);
+	if (!clockman->regs)
+		return -EINVAL;
+
+	return 0;
+}
+
+static const struct udevice_id rp1_clk_of_match[] = {
+	{ .compatible = "raspberrypi,rp1-clocks" },
+	{ /* sentinel */ }
+};
+
+static struct clk_ops rp1_clk_ops = {
+	.set_rate = rp1_clock_set_rate,
+	.enable = rp1_clock_on,
+};
+
+U_BOOT_DRIVER(clk_rp1) = {
+	.name = "rp1-clk",
+	.id = UCLASS_CLK,
+	.of_match = rp1_clk_of_match,
+	.probe = rp1_clk_probe,
+	.ops = &rp1_clk_ops,
+	.priv_auto	= sizeof(struct rp1_clockman),
+	.flags = CLK_IGNORE_UNUSED,
+};

From patchwork Wed Feb  5 10:15:46 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042692
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=NzDrkQuS;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp17B3pY5z1yQ0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:20:06 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id DCBA780C99;
	Wed,  5 Feb 2025 14:15:39 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="NzDrkQuS";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id EC7BD80562; Wed,  5 Feb 2025 11:15:59 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-DBA-obe.outbound.protection.outlook.com
 (mail-dbaeur03on20628.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260d::628])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 83BBD807E1
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:55 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=xuw0AcPVwxkkMky5b2RivhyBD7EVuVgFBAAUN6E2vGtGGo3ZuQq375A9swY4+koZY3HwJedYwh6fsfCkzE8Q6rp/8dKbloM0stsoElIjqDryKw9rOV7cOgARGVemlFdeisvbFpXl6tmfuq/h8mcN9QOwLZnbUrnkUnwCXH2SGvn/VTiHRh1T3ugZsyhBWsE/p7hk1mdirhAbxRd5xDAbTz1zEwGppk5Gzk0XqSZiIO9dzl8Du4vP2y8g4cU3VEDsuR+o5HJiJGCJLdPOKXpwa1mq+YwDQWaDRlNuaR8K9/2j9wzYuWTyZ7K0gJ4WrUw1PAW9Er5VKonCT/jBYmdZcg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=tkv4cj0ZKB5JtoSGq33cHQxOnoTZ5/25y/I8Va0uhmE=;
 b=roxcVc9KGnlA0XBsQwoAnBr4hZ33D4IysIlDlzMhUmZ/42HBUvT6EH22SL7jWf284uyACxTx9xgbe3+bmgB5qiYdBEJt7H3IeMAN2dTS66iRrMeF1szCtqkPAozG/1m83uqdWpBhnkkTa5o8Fq+5onPfVB5DhxYybY+VOyJiD40GkZHXTXd4ttnNK4thWE7i4+6Dz02NbcIBb6knRDgbCj7SPooljDexhJj7Uv4uvcVq7WCcJ2Oin/iDnAUBVlbPK4G6Wud9SFJxdfbc6d3033GELFsoJGTXyxl/d2sHK9AOuQvGEZKt79IMFCrJJ7QanO1lU7JdAHUBow77QN995Q==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=tkv4cj0ZKB5JtoSGq33cHQxOnoTZ5/25y/I8Va0uhmE=;
 b=NzDrkQuSbfx0pdPBHl7lTyfUjlENaUOXKSSZE4d4+4oVh5Z6PnM+AtRODH+bduMyc1sWMESQ7wRWa8dbgDK3HfDHM6/waA9Xf/vYzh8C94rgHvV2XKTH+R8oBSNBYLRBhFsYW56i+qAWDRHPTNZ2Zc4dZBrvVtzqikeHsHmLVlhevH5XsRnjB2hr5Qelv49gKmoy7oZMw4/G4xN05KxPN+cbwalY3ooj1330cQFu1GYBtE0fbdWzkbEOO0VPUyJH7+mK/cdWJrKcGvCKNkhdxDsTlZWpa9PU0qUX2EjARDMlXYMvWtCKHXkJPoBSq0fa4jaepWmIXiBSYvnyAH/OHQ==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:51 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:51 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, BELOUARGA Mohamed
 <m.belouarga@technologyandstrategy.com>, Joe Hershberger
 <joe.hershberger@ni.com>, Ramon Fried <rfried.dev@gmail.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 14/20] drivers: net: macb: introduce ePCI connection
 support for macb
Thread-Topic: [RFC PATCH v1 14/20] drivers: net: macb: introduce ePCI
 connection support for macb
Thread-Index: AQHbd7bs8veq5io78ESC06SIfwd9hQ==
Date: Wed, 5 Feb 2025 10:15:46 +0000
Message-ID: 
 <0986c74fd7b543d47e1de30aa92663966caaea91.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 560fed58-7f61-4adf-be71-08dd45ce113b
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?sot2/lzgBqS+/bq7zCs8M8/SbP?=
	=?iso-8859-1?q?mEgGYvG+ujRsObSZjs7exSgC+AMFkE1HBFfHmUHMrLhEykshQ9m6FffLWR2Y?=
	=?iso-8859-1?q?GZTdSjo8HtIIuCAhc/VAj/2jvGYpQLFiyr5NoSYULqPXSh3NKJH9uJ2jdnBJ?=
	=?iso-8859-1?q?El1TQipEOSkVN6gnU93LhwtwDWm6/uy5Hb0AwAgQvYc5dIxFp71HdsWOF88e?=
	=?iso-8859-1?q?cDK14LSi6glfkV4aAVjxyegNuFtEUQJ4VJFyKZWVL1Iey6w1z+dX1vVFYg9G?=
	=?iso-8859-1?q?nXlk38bnZMGXyN1N2v6b+ygxsrXrid8X9RbvovSaPbAowfO3TXgq+LFn1knX?=
	=?iso-8859-1?q?6yobtjVvU0FKq74/P7rwNBAvQs3oGLZQFHpdhZljOMka3uLHqn8BdzIIfAZn?=
	=?iso-8859-1?q?vT5nGAXWPRZtlR+pWlDCJ/tL67KLsKIxiZHRE7Gyq5I5eBAtJENLxFmGrb4B?=
	=?iso-8859-1?q?v86JBbhZF+Vhk45i4nPpu9YJgpCrX7Pko5P0u5g1mjqHbfY+GxVTrINHhB7t?=
	=?iso-8859-1?q?L2+GL7OoEmhlt+3gTWCk4HEJum3Ye6AWhl7NESHUiL9WwLepmFt+UJNwJuRZ?=
	=?iso-8859-1?q?wlGhP4mtSPJeLJ+4MXxuZDD4gb/tIAEJYX153VYWmeCqLJ4OtSmN0G4qD3iC?=
	=?iso-8859-1?q?/MrozguXTwLhCoXqaSJ1EHn44b320YoQiZSE3OStAKYv4IEIZ8PUZaGidDJy?=
	=?iso-8859-1?q?IhN/ArRuPWd4VYDcvZdPkY/evqrSC7GkATUDfAL0ZZuY/OMskL4evkz5Ruvv?=
	=?iso-8859-1?q?AEQ6Xbf8Zkft+GytxUf20RJbi+Z0eOzvYe9/7OwsSDCVnifkNmeyr4q7YTCT?=
	=?iso-8859-1?q?L8hcdrS8/R+oUgJ0DszsWaTmG7j8+bfZK8R7LwmdVJL/CdF2afBMXVsRFwjE?=
	=?iso-8859-1?q?xJBEWL5FBYbHzIIQNtUe2sGTkSAckXmi164Qy9iPudS6vb0YK2z7yG46kXRz?=
	=?iso-8859-1?q?Y/atoMffTT7WB47/8YXlx0eemTGTn+XbfqusmgQDJpwcTY1Fb9iwIbjc2JVK?=
	=?iso-8859-1?q?xVg8AtOOMyDc2KTf3Pn2M+Oo5OLf5pijyfaS4SSjsyUfVuJpo4btihbEWnVK?=
	=?iso-8859-1?q?m1bZWQS1CGsC/sFvXeFHSL9QqvEFplwtR7oImn4GJ8FjJcbwTtoyY5WIsnA4?=
	=?iso-8859-1?q?c571lp0/U2PYTFj/L2+sjvRWwQUdPQERE3neQHYNEzz/vQ1XBvK5OLfPzkPL?=
	=?iso-8859-1?q?wBuj8FGvGo8FXHlK7zgGE6eUXxjd3rafT7qNlsOu6Jzt8mP8OUtHKAXGR/aQ?=
	=?iso-8859-1?q?dXBKCR2vgQm5jTxrvxhKdByXvTCPka1GxxAn58TfnvthB9Y3tTfEQQHX6KzZ?=
	=?iso-8859-1?q?k5p5oBxx0hbkPQNXe0p3yHX7jj5TgkZyxRhwdFOSBZ4d15lCK1FBsrA7SBCn?=
	=?iso-8859-1?q?/mHSBN4fM4Y2UWq7Pr8DikO6EhzqyC60M6+oJKE62W9x1eaRCLjVoHlEnmZp?=
	=?iso-8859-1?q?m1f5UV6tTpGn/w8+iT1nIyhxR5vrNHVgQKCiPwVRum9hI7uinYEDCcjqzFmI?=
	=?iso-8859-1?q?VQR/wi?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?KsAh5MS2P4N6D/J9BiHi5SD?=
	=?iso-8859-1?q?tO23VilgHoUyMHRmS4OCx2snOVWq7/JVkFL7kT4uAH0QTxN5Rm+q866z/GPE?=
	=?iso-8859-1?q?4HLdMolNgOGcmNLhqrQgu3mA+vR68LLhTxSn2Y1PvXccCIp5GvPPCRlWdTeq?=
	=?iso-8859-1?q?Rr7nlCW4j1l9HSJ/zwptNRIZPLu0MH6ILWUQDKyjbl2+TwNwOO1RPpq8D/vM?=
	=?iso-8859-1?q?yT6W4To8nApxkWo1ik3ia+bqKK29zZu64cJ4HqzJ4WBJm4BhabfHgBdb0Res?=
	=?iso-8859-1?q?7VcoKRvrmZ+u1DbvSZMWPgUeqQDDkgnx8ysOw+jHhEPwY1QjTW91Eg1hwc8Q?=
	=?iso-8859-1?q?RJzKjEXO09oXFvwyUEaj2Pzq27UuXE4HGYqvImgI5kV5apvumfvIeODWuFB0?=
	=?iso-8859-1?q?nNiXSSTd6HzTBA3ZxFUNw7VEEgDPnvCSaLUr9SA72cW+/83U9kpyUU1SoQC/?=
	=?iso-8859-1?q?90eMMmhT8AjwA5caxJuWxAsnlocu8UAwHAj2DFTkT0FYI8CyWZzYHIQyyi8w?=
	=?iso-8859-1?q?XqdGYcA4Z2e9VtAq5zoepK7TBHs8h+hTvs6NUhOk3r+c5p1zdUluTcBgFPNP?=
	=?iso-8859-1?q?Xlt975wxPP1C4bb3IpqZBpx/YQMekObKhVMFnFNUW55xYNNOLImdg6VuyYZ7?=
	=?iso-8859-1?q?wGJUfUV2jnpV3PJ0RY6Tls1H4eajuZQBriiyGLbpo36oMoxiJY4t03bLdtmW?=
	=?iso-8859-1?q?M02ZQsdO46AQxb7Wc7wI6tXxqJBuZEK/2vF+4xXvKlR2Teg4LRhFqOOOqzfo?=
	=?iso-8859-1?q?M70KUaser6QHRNz/Y31XVkFxPOfQoGwsEr1ezrXgmMs0cF5+Y0H8zupQxiUt?=
	=?iso-8859-1?q?M82UYTxYAYmjMsRMbQPiMx0hNw33OjuVpZFRpH1dNTLMALtRhJ3mvqd9rCxz?=
	=?iso-8859-1?q?KNzJs/rALPMC/FvmCFPZJrz1t6bbF5mV8/HBxwrB7N8+SLRiewMi1pQtOJdy?=
	=?iso-8859-1?q?E63B5G5tTfrKirsOcLnthA6WTmG8Qc/Bh20nguzJFyEmaFSGATOBdhal8DCl?=
	=?iso-8859-1?q?4ksbJX+LNMNQDprx6Lx1Q6iCTWALCqgY0AhaEqRfCOCUpg1ay+kAqNFoi9C/?=
	=?iso-8859-1?q?8XcJWQvoVNaFafuiajYAgzB1Lght73QHHDO307jTn++EfqPqHRvQQfRqX1l6?=
	=?iso-8859-1?q?ZCfmQCALXMJ2zPH4UbfJb2QyGFZMgCTHoMtZjUP25TMq2WDEnCtz+iHSNUW6?=
	=?iso-8859-1?q?7TX4/gZNSaLk1nLohhCoo60EFWsKMmHCuSw/q8r/V427CuxsFSHerZrjK8wx?=
	=?iso-8859-1?q?bqqOVwqedbA13DhLlZ1swveVE3uksVDkYQeMcg0Occ186GEkW6ASMx4/0Uhz?=
	=?iso-8859-1?q?h+l2CVlqPNZBzMIlmEkt7zopUB43QFbnI+CXjVvtHusLH8LKC4Vzir/rRU6Y?=
	=?iso-8859-1?q?zxIJtmTIOJ9sz+s5atOwE6sbaNkk1UIbCo7qB3ghl65pUNsT81A/p5K6yUb1?=
	=?iso-8859-1?q?7t5b+4VnllkxV/fkxA8j/WeaszFJsKqXjkR8qJwtIiwJtY2MUkoEC87dkbK5?=
	=?iso-8859-1?q?LvQdFMRC0OgT44Ecj0mk6hFq98uNOsCZjmqphmx/PKyxI2q+7FX2HMI9HDr5?=
	=?iso-8859-1?q?Id/lAYWEGG5BomvQGlN6NSEYLXvNGWaxxBH7yig9nflzb7zMNU+7uBvTXo9B?=
	=?iso-8859-1?q?T1NOOqDG0TF4Bsq7CZIZbpFZGi9S2QskceT/0uQ=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 560fed58-7f61-4adf-be71-08dd45ce113b
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:46.7137 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 S5Cnp4gEVyoetv7kbkJH/UZLuRxJnAwAGd6j8oqLI/F8XFnLS/FVhnt4K3lLUgV4D4uxy7XI1TS68LuEq5nu2p1OkD3fZAfidM2qZwl0AW4=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

On BCM2712 connected devices, such as RPI5 has an external chip called
RP1 connected to the main SOC over ePCI. Macb is connectet to the RP1
chip and should be transparent to the SOC. Introduced changes are
intended to solve mapping issues and implement full support for the
macb driver.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/net/Kconfig |   1 +
 drivers/net/macb.c  | 154 +++++++++++++++++++++++++++++++++++---------
 drivers/net/macb.h  |  16 +++++
 3 files changed, 140 insertions(+), 31 deletions(-)

diff --git a/drivers/net/Kconfig b/drivers/net/Kconfig
index b2d7b49976..22846ab7f7 100644
--- a/drivers/net/Kconfig
+++ b/drivers/net/Kconfig
@@ -525,6 +525,7 @@ config MVPP2
 config MACB
 	bool "Cadence MACB/GEM Ethernet Interface"
 	select PHYLIB
+	select DM_GPIO
 	help
 	  The Cadence MACB ethernet interface is found on many Atmel
 	  AT91 and SAMA5 parts.  This driver also supports the Cadence
diff --git a/drivers/net/macb.c b/drivers/net/macb.c
index a6a9a9b5d7..1f5b241950 100644
--- a/drivers/net/macb.c
+++ b/drivers/net/macb.c
@@ -32,6 +32,7 @@
  * core modifications here...
  */
 
+#include <broadcom/bcm_board_types.h>
 #include <net.h>
 #include <malloc.h>
 #include <miiphy.h>
@@ -45,6 +46,7 @@
 #include <linux/errno.h>
 
 #include "macb.h"
+#include "phys2bus.h"
 
 DECLARE_GLOBAL_DATA_PTR;
 
@@ -103,6 +105,8 @@ struct macb_dma_desc_64 {
 #define RXBUF_FRMLEN_MASK	0x00000fff
 #define TXBUF_FRMLEN_MASK	0x000007ff
 
+#define msleep(x) udelay((x) * 1000)
+
 struct macb_device {
 	void			*regs;
 
@@ -142,6 +146,10 @@ struct macb_device {
 	unsigned long		pclk_rate;
 #endif
 	phy_interface_t		phy_interface;
+
+	struct gpio_desc phy_reset_gpio;
+	int phy_reset_ms;
+	struct udevice *udev;
 };
 
 struct macb_usrio_cfg {
@@ -273,47 +281,70 @@ int macb_miiphy_write(struct mii_dev *bus, int phy_adr, int devad, int reg,
 
 	arch_get_mdio_control(bus->name);
 	macb_mdio_write(macb, phy_adr, reg, value);
+	return 0;
+}
 
+static int macb_miiphy_reset(struct mii_dev *bus)
+{
+	struct udevice *dev = eth_get_dev_by_name(bus->name);
+	struct macb_device *macb = dev_get_priv(dev);
+
+	if (!dm_gpio_is_valid(&macb->phy_reset_gpio))
+		return 0;
+
+	dm_gpio_set_value(&macb->phy_reset_gpio, 1);
+	msleep(macb->phy_reset_ms);
+	dm_gpio_set_value(&macb->phy_reset_gpio, 0);
 	return 0;
 }
 #endif
 
 #define RX	1
 #define TX	0
+
+/*
+ * NOTE: To handle buffers - rx_ring and tx_ring addresses should be used instead
+ * of rx_buffer_dma and tx_buffer_dma. That is because on the several boards this
+ * controller could be connected via PCIe or similar instead of the direct connection.
+ * For example in BCM2712 macb controller is connected to RP1 chip via PCIe.
+ * When macb is connected directly to the SOC the rx_ring and tx_ring are the same
+ * as rx_buffer_dma and tx_buffer_dma.
+ */
+
 static inline void macb_invalidate_ring_desc(struct macb_device *macb, bool rx)
 {
 	if (rx)
-		invalidate_dcache_range(macb->rx_ring_dma,
-			ALIGN(macb->rx_ring_dma + MACB_RX_DMA_DESC_SIZE,
-			      PKTALIGN));
+		invalidate_dcache_range((ulong)(macb->rx_ring), ALIGN((ulong)(macb->rx_ring) +
+					MACB_RX_DMA_DESC_SIZE, PKTALIGN));
 	else
-		invalidate_dcache_range(macb->tx_ring_dma,
-			ALIGN(macb->tx_ring_dma + MACB_TX_DMA_DESC_SIZE,
-			      PKTALIGN));
+		invalidate_dcache_range((unsigned long)macb->tx_ring,
+					ALIGN((unsigned long)macb->tx_ring +
+					      MACB_TX_DMA_DESC_SIZE, PKTALIGN));
 }
 
 static inline void macb_flush_ring_desc(struct macb_device *macb, bool rx)
 {
 	if (rx)
-		flush_dcache_range(macb->rx_ring_dma, macb->rx_ring_dma +
-				   ALIGN(MACB_RX_DMA_DESC_SIZE, PKTALIGN));
+		flush_dcache_range((ulong)(macb->rx_ring),
+				   (ulong)(macb->rx_ring) + ALIGN(MACB_RX_DMA_DESC_SIZE, PKTALIGN));
 	else
-		flush_dcache_range(macb->tx_ring_dma, macb->tx_ring_dma +
+		flush_dcache_range((unsigned long)macb->tx_ring,
+				   (unsigned long)macb->tx_ring +
 				   ALIGN(MACB_TX_DMA_DESC_SIZE, PKTALIGN));
 }
 
 static inline void macb_flush_rx_buffer(struct macb_device *macb)
 {
-	flush_dcache_range(macb->rx_buffer_dma, macb->rx_buffer_dma +
-			   ALIGN(macb->rx_buffer_size * MACB_RX_RING_SIZE,
-				 PKTALIGN));
+	flush_dcache_range((ulong)macb->rx_buffer,
+			   (ulong)macb->rx_buffer +
+			   ALIGN(macb->rx_buffer_size * MACB_RX_RING_SIZE, PKTALIGN));
 }
 
 static inline void macb_invalidate_rx_buffer(struct macb_device *macb)
 {
-	invalidate_dcache_range(macb->rx_buffer_dma, macb->rx_buffer_dma +
-				ALIGN(macb->rx_buffer_size * MACB_RX_RING_SIZE,
-				      PKTALIGN));
+	invalidate_dcache_range((ulong)macb->rx_buffer,
+				(ulong)macb->rx_buffer +
+				ALIGN(macb->rx_buffer_size * MACB_RX_RING_SIZE, PKTALIGN));
 }
 
 #if defined(CONFIG_CMD_NET)
@@ -339,12 +370,12 @@ static void macb_set_addr(struct macb_device *macb, struct macb_dma_desc *desc,
 static int _macb_send(struct macb_device *macb, const char *name, void *packet,
 		      int length)
 {
-	unsigned long paddr, ctrl;
+	unsigned long paddr, dmaaddr, ctrl;
 	unsigned int tx_head = macb->tx_head;
 	int i;
 
 	paddr = dma_map_single(packet, length, DMA_TO_DEVICE);
-
+	dmaaddr = dev_phys_to_bus(macb->udev, paddr);
 	ctrl = length & TXBUF_FRMLEN_MASK;
 	ctrl |= MACB_BIT(TX_LAST);
 	if (tx_head == (MACB_TX_RING_SIZE - 1)) {
@@ -358,7 +389,7 @@ static int _macb_send(struct macb_device *macb, const char *name, void *packet,
 		tx_head = tx_head * 2;
 
 	macb->tx_ring[tx_head].ctrl = ctrl;
-	macb_set_addr(macb, &macb->tx_ring[tx_head], paddr);
+	macb_set_addr(macb, &macb->tx_ring[tx_head], dmaaddr);
 
 	barrier();
 	macb_flush_ring_desc(macb, TX);
@@ -666,6 +697,22 @@ int __weak macb_linkspd_cb(struct udevice *dev, unsigned int speed)
 	return 0;
 }
 
+static void gem_init_axi(struct macb_device *bp)
+{
+	u32 amp;
+
+	/* AXI pipeline setup - don't touch values unless specified in device
+	 * tree. Some hardware could have reset values > 1.
+	 */
+	amp = gem_readl(bp, AMP);
+
+	amp = GEM_BFINS(AW2B_FILL, 1 /*bp->use_aw2b_fill*/, amp);
+	amp = GEM_BFINS(AW2W_MAX_PIPE, 8, amp);
+	amp = GEM_BFINS(AR2R_MAX_PIPE, 8, amp);
+
+	gem_writel(bp, AMP, amp);
+}
+
 static int macb_phy_init(struct udevice *dev, const char *name)
 {
 	struct macb_device *macb = dev_get_priv(dev);
@@ -815,8 +862,8 @@ static int gmac_init_multi_queues(struct macb_device *macb)
 
 	macb->dummy_desc->ctrl = MACB_BIT(TX_USED);
 	macb->dummy_desc->addr = 0;
-	flush_dcache_range(macb->dummy_desc_dma, macb->dummy_desc_dma +
-			ALIGN(MACB_TX_DUMMY_DMA_DESC_SIZE, PKTALIGN));
+	flush_dcache_range((ulong)macb->dummy_desc,
+			   (ulong)macb->dummy_desc + ALIGN(MACB_TX_DUMMY_DMA_DESC_SIZE, PKTALIGN));
 	paddr = macb->dummy_desc_dma;
 
 	for (i = 1; i < num_queues; i++) {
@@ -920,6 +967,14 @@ static int _macb_init(struct udevice *dev, const char *name)
 		macb_writel(macb, TBQPH, upper_32_bits(macb->tx_ring_dma));
 	}
 
+	/*
+	 * Call axi bus init only for BCM2712 board which has macb
+	 * connected over PCIe.
+	 */
+	if ((IS_ENABLED(CONFIG_BCM2712)) &&
+	    (gd_board_type() == BCM2712_RPI_5_B_NEW))
+		gem_init_axi(macb);
+
 	if (macb_is_gem(macb)) {
 		/* Initialize DMA properties */
 		gmac_configure_dma(macb);
@@ -1081,7 +1136,7 @@ static u32 macb_dbw(struct macb_device *macb)
 	}
 }
 
-static void _macb_eth_initialize(struct macb_device *macb)
+static void _macb_eth_initialize(struct macb_device *macb, struct udevice *dev)
 {
 	int id = 0;	/* This is not used by functions we call */
 	u32 ncfgr;
@@ -1095,13 +1150,23 @@ static void _macb_eth_initialize(struct macb_device *macb)
 	macb->rx_buffer = dma_alloc_coherent(macb->rx_buffer_size *
 					     MACB_RX_RING_SIZE,
 					     &macb->rx_buffer_dma);
+
+	macb->rx_buffer_dma = dev_phys_to_bus(dev, (ulong)macb->rx_buffer);
+
 	macb->rx_ring = dma_alloc_coherent(MACB_RX_DMA_DESC_SIZE,
 					   &macb->rx_ring_dma);
-	macb->tx_ring = dma_alloc_coherent(MACB_TX_DMA_DESC_SIZE,
-					   &macb->tx_ring_dma);
+
+	macb->rx_ring_dma = dev_phys_to_bus(dev, (ulong)macb->rx_ring);
+
+	macb->tx_ring = dma_alloc_coherent(MACB_TX_DMA_DESC_SIZE, &macb->tx_ring_dma);
+
+	macb->tx_ring_dma = dev_phys_to_bus(dev, (ulong)macb->tx_ring);
+
 	macb->dummy_desc = dma_alloc_coherent(MACB_TX_DUMMY_DMA_DESC_SIZE,
 					   &macb->dummy_desc_dma);
 
+	macb->dummy_desc_dma = dev_phys_to_bus(dev, (ulong)macb->dummy_desc);
+
 	/*
 	 * Do some basic initialization so that we at least can talk
 	 * to the PHY
@@ -1175,11 +1240,19 @@ static const struct eth_ops macb_eth_ops = {
 static int macb_enable_clk(struct udevice *dev)
 {
 	struct macb_device *macb = dev_get_priv(dev);
-	struct clk clk;
-	ulong clk_rate;
+	struct clk clk, hclk;
+	struct clk tsu_clk;
 	int ret;
 
-	ret = clk_get_by_index(dev, 0, &clk);
+	ret = clk_get_by_name(dev, "pclk", &clk);
+	if (ret)
+		return -EINVAL;
+
+	ret = clk_get_by_name_optional(dev, "hclk", &hclk);
+	if (ret)
+		return -EINVAL;
+
+	ret = clk_get_by_name_optional(dev, "tsu_clk", &tsu_clk);
 	if (ret)
 		return -EINVAL;
 
@@ -1192,11 +1265,17 @@ static int macb_enable_clk(struct udevice *dev)
 	if (ret && ret != -ENOSYS)
 		return ret;
 
-	clk_rate = clk_get_rate(&clk);
-	if (!clk_rate)
-		return -EINVAL;
+	ret = clk_enable(&hclk);
+	if (ret && ret != -ENOSYS)
+		return ret;
+
+	ret = clk_enable(&tsu_clk);
+	if (ret && ret != -ENOSYS)
+		return ret;
 
-	macb->pclk_rate = clk_rate;
+	macb->pclk_rate = 0xbebc200;
+	if (!macb->pclk_rate)
+		return -EINVAL;
 
 	return 0;
 }
@@ -1227,6 +1306,7 @@ static int macb_eth_probe(struct udevice *dev)
 	if (macb->phy_interface == PHY_INTERFACE_MODE_NA)
 		return -EINVAL;
 
+	macb->udev = dev;
 	/* Read phyaddr from DT */
 	if (!dev_read_phandle_with_args(dev, "phy-handle", NULL, 0, 0,
 					&phandle_args))
@@ -1252,7 +1332,7 @@ static int macb_eth_probe(struct udevice *dev)
 		return ret;
 #endif
 
-	_macb_eth_initialize(macb);
+	_macb_eth_initialize(macb, dev);
 
 #if defined(CONFIG_CMD_MII) || defined(CONFIG_PHYLIB)
 	macb->bus = mdio_alloc();
@@ -1261,6 +1341,7 @@ static int macb_eth_probe(struct udevice *dev)
 	strlcpy(macb->bus->name, dev->name, MDIO_NAME_LEN);
 	macb->bus->read = macb_miiphy_read;
 	macb->bus->write = macb_miiphy_write;
+	macb->bus->reset = macb_miiphy_reset;
 
 	ret = mdio_register(macb->bus);
 	if (ret < 0)
@@ -1302,6 +1383,7 @@ static int macb_eth_of_to_plat(struct udevice *dev)
 	void *blob = (void *)gd->fdt_blob;
 	int node = dev_of_offset(dev);
 	int fl_node, speed_fdt;
+	int ret;
 
 	/* fetch 'fixed-link' property */
 	fl_node = fdt_subnode_offset(blob, node, "fixed-link");
@@ -1325,6 +1407,16 @@ static int macb_eth_of_to_plat(struct udevice *dev)
 	if (!pdata->iobase)
 		return -EINVAL;
 
+	/* optional PHY reset-related properties */
+	ret = gpio_request_by_name(dev, "phy-reset-gpios", 0, &macb->phy_reset_gpio,
+				   GPIOD_IS_OUT);
+	if (ret && ret != -ENOENT) {
+		printf("Failed to obtain phy-reset gpio\n");
+		return ret;
+	}
+
+	macb->phy_reset_ms = ofnode_read_s32_default(dev_ofnode(dev), "phy-reset-duration", 10);
+
 	return macb_late_eth_of_to_plat(dev);
 }
 
diff --git a/drivers/net/macb.h b/drivers/net/macb.h
index 72b84ae96e..37b98277a6 100644
--- a/drivers/net/macb.h
+++ b/drivers/net/macb.h
@@ -69,6 +69,7 @@
 #define GEM_USRIO		0x000c /* User IO */
 #define GEM_DMACFG		0x0010 /* DMA Configuration */
 #define GEM_JML			0x0048 /* Jumbo Max Length */
+#define GEM_AMP			0x0054 /* AXI Max Pipeline */
 #define GEM_HRB			0x0080 /* Hash Bottom */
 #define GEM_HRT			0x0084 /* Hash Top */
 #define GEM_SA1B		0x0088 /* Specific1 Bottom */
@@ -764,6 +765,21 @@
 #define GEM_RX_CSUM_IP_TCP			2
 #define GEM_RX_CSUM_IP_UDP			3
 
+/* Bitfields in AMP */
+/* Maximum number of outstanding AXI read requests */
+#define GEM_AR2R_MAX_PIPE_OFFSET		0
+#define GEM_AR2R_MAX_PIPE_SIZE			8
+/* Maximum number of outstanding AXI write requests */
+#define GEM_AW2W_MAX_PIPE_OFFSET		8
+#define GEM_AW2W_MAX_PIPE_SIZE 8
+/* Select whether the max AW2W transactions operates between: */
+#define GEM_AW2B_FILL_OFFSET			16
+/*   0: the AW to W AXI channel */
+#define GEM_AW2B_FILL_AW2W			0
+/*   1: AW to B channel */
+#define GEM_AW2B_FILL_AW2B			1
+#define GEM_AW2B_FILL_SIZE			1
+
 /* limit RX checksum offload to TCP and UDP packets */
 #define GEM_RX_CSUM_CHECKED_MASK		2
 #define gem_writel_queue_TBQP(port, value, queue_num)	\

From patchwork Wed Feb  5 10:15:47 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042695
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=lhLQMKKO;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=85.214.62.61; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de [85.214.62.61])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp17k0fHkz1yQ0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:20:34 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 0059F80EB0;
	Wed,  5 Feb 2025 14:15:41 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="lhLQMKKO";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 7BBA080207; Wed,  5 Feb 2025 11:16:00 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-DBA-obe.outbound.protection.outlook.com
 (mail-dbaeur03on20628.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260d::628])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 9E104807E4
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:55 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=wIT+mYOOMSjTVaTNzXk3yBAQFmR0TEBaGui3GeWfvwrfGH+6Dp2mTaBLz8EcAlombuMH47iukVUiWosO/wOlGX/y/MwBtEO3A4+uJldXagyFxFZRxamHdx4kmsKHTrZDmVUHbGC6ZFdrJ79VgPVIVOMUD1b7sMJmimpAhZuuxpxgb+7fd+gypt9RAno9c/qqBseqwjjZ9FhoP7CzxkDHfgb1YgA9bgzQgD21nADH6PcOBfHdorRn73C61sm+WLyEeSW2aPUhzSfl6s0Xi4Th/sA3AS0GlYiVtM1w1xbk3cc8kL2exD0zxjU8hKWxBEOCNAuli1XtyRFCfkUUCqyXQA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=jM03+D57Pzf5gQxLCeD5agFv66ZqFdcTGtYXxKI8i9g=;
 b=ZeXTwsZhCMZqps2NpZaOlCYfy4iG/fqCPVDy6cmXFnhsXU2Th/qa+X9Zm7zBs9b2R2cM/yI6f7TS80Jgz+sZFjNreYcWmonuLb9FXFVzT8TzBhGlDMO6Vtsgl/PCDaDW8831uSzaJn9IkQVn4h1derHxfCmN5Eeah/m2AYldED50MurnDkoMcFPAs2d2a8NHxivUAU9XWqOEk3aCGiXmNE87owUgNIikwts+AWba1ijRVsUfyypz8/BfeNmBiOWD3YIuM4JHM/DalcBs341IYwJ4kJOfKtX+DsZN7bNo1KTr1wHz7zkUvZs+bjRxjCodkQoPloOJVd029DJeCaXwpQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=jM03+D57Pzf5gQxLCeD5agFv66ZqFdcTGtYXxKI8i9g=;
 b=lhLQMKKOAyYLcbFDIHmjsWqxrffY3pwUnDDOyTnx+BrKsGtaw1uw45hQrH+4RzZBqi99gT96s6RM/NQgXcN98DbyI22Xq/0mhIXmedMw6HBN4K2X4md+ogtRtko6G7a7sNzBeBADoZ5lyWjzHuhiR8mR3FJJVYv6Ajxea+qPao0H69XFdjdkkQln7wHpikRmxpZFWUULhDXkIb9jd82flW7aXaJyuMZCmYRyGSYv7Dh6yzSbcambeNDq527ZAa3xZqYp2ImZuD6ElyvU/m9WzneG5oc/hBnn6myrVbk40+R4hf96TRYOvgf0kx3Mn7c+P1BwkiiPYGeDMKkzw18ueA==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:51 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:51 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Matthias Brugger
 <mbrugger@suse.com>, Peter Robinson <pbrobinson@gmail.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 15/20] configs: add support for the Raspberrypi 5 board
 to default config
Thread-Topic: [RFC PATCH v1 15/20] configs: add support for the Raspberrypi 5
 board to default config
Thread-Index: AQHbd7bsVlUmrZ3BOU+lo2rAkbwrzQ==
Date: Wed, 5 Feb 2025 10:15:47 +0000
Message-ID: 
 <0e50a66bcd6313cf85b7261c721b2653c322edda.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 20c1802d-65fe-4f85-6ef5-08dd45ce116c
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?jRBzzDbavMGYuPu1pr7MkgsWQw?=
	=?iso-8859-1?q?oMBLRXkUE2L6EdfM+tdcwpWAuP4E3SzjUO4GsgVv79K4IJEs/umRCYPoePCF?=
	=?iso-8859-1?q?/barefNsx+AA7PCBRMeZOrUQtmoNfm45nO4ZJXsg85p1h+HKM0zKerNHWHkp?=
	=?iso-8859-1?q?K5Ge9eKK3Cn6KCiQpVeSDGD9SRkN6tkg51DyF/kAO/ePvdmXb1G3z2AUvu/l?=
	=?iso-8859-1?q?gUc4CJyBngcK9N6q+n06JFxPBIDphX4dJaMlRsXcsZGDjFDOP+eKEtIVVoJQ?=
	=?iso-8859-1?q?eNrF8/mzejWeg1mWkAHEbZ26u2et3GfI+19Y2SLw5lhLJNBA1etJ7SY6+gBI?=
	=?iso-8859-1?q?y68AXsePBAwQ7YZUvS9FkUOpMZdrUF6n3BODRcZN1Hb/O63fxD1U4EsUAwv1?=
	=?iso-8859-1?q?BcWnJ9RlN9pxfGpb6/vkf+AwKEfFDP3Zfwt/Q4cZrMOmq9t7nreqzSgWUmFg?=
	=?iso-8859-1?q?nwjftlPpcCEAd3Injg1dIg0v7XVH7mUP84p0ELkKWoXKMjnEuIucbw8QRH8e?=
	=?iso-8859-1?q?6zlGPewuvWc8Ra95hrMe144ArMALVlh/XaVlpx/70l5CLwgkiHKzMlq7kVH8?=
	=?iso-8859-1?q?dgdX06EWEhBi7BrXcmT1HPJZQjrpjA4krt15J4QVoHVjhuM0pHkUezyzUDq4?=
	=?iso-8859-1?q?D0O4ynDZGyh7U45XZpr2xksNznX3J5xxAQhpHR4AVF1nY6vf77Ai8uW76GUp?=
	=?iso-8859-1?q?57oVlutUlAZ/dE030MD7xHw13zSu0TyNWwS7iPv0pvjZHpzm5YVCVkPGbzhG?=
	=?iso-8859-1?q?RSpf+cOGifKA9SFHBqh+Oa0jPhTeoPLY5qcz58R7WxkKqowGXD3h8Lksa6DJ?=
	=?iso-8859-1?q?ZDfBnJEvHFCkRcujrRXJknXxbymwUEKnGmEnnq7WiMOk+Coag6upyHImDM5d?=
	=?iso-8859-1?q?QoO3uq+jpNGnxzQdUryuyPOW81iSDR4g9JrYBlHvlBYXYIf6R+ZzZkLOoVnd?=
	=?iso-8859-1?q?t0AukI3ce87Wa0lhPZ4smDTByqu55AFw4sPNguGFXlwPEdT16OVbQVLqHR/2?=
	=?iso-8859-1?q?XiuD7iSrWYUWRtFlhAu7MQi9VrQxLL2UPsXIENspegYUcziz2xhb7M2w+sLm?=
	=?iso-8859-1?q?OeDyxDMWgJFu5sozMTkYACbAICK5nOPoro0/ftkwpErR2K+l7D+Nln6pZIrr?=
	=?iso-8859-1?q?7pI/Y3yVk5fFKRszKJe2X7zIefyJ39TPUSs1Jez3fsVDL7j0QjMWh/NTiIE9?=
	=?iso-8859-1?q?gBh+pDotRtDEXJRYP312+c8qzETjO6GwN9sdDp/hIgKYWG/3PXM/i5sJZV36?=
	=?iso-8859-1?q?X8x0/QdRuJ65XAvvbqYdlazMMcIjZVK1HyJqwwL4Vag648kgpK1aG+DU/L3L?=
	=?iso-8859-1?q?7K9EDUSl4Bxo1qJh/MNzfnG3J6aQ1DR3vdQuwhSO+GWkcz7M5VNkPb7tIQwI?=
	=?iso-8859-1?q?Rfhyfd8eIaFX4Q3SyCjOEQdAkQlxDxwv9zXowyMeIF3S5w+gqVK+bD9aRN1+?=
	=?iso-8859-1?q?6PA/OQnFPmsPbbR4aZvFaOk8i5xVhE5/OJxOY+41YTmM0lmeUQIvXKgCOLMd?=
	=?iso-8859-1?q?wdgIMh?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?se7+4bDO70azZ8oX5irqn3k?=
	=?iso-8859-1?q?1aQ98NTyWhG/TvqtgEzAF1I6hBCcxNQ39QTwcWVOLNyQrWpdnVtYh1EA5MVE?=
	=?iso-8859-1?q?4rHofoDkSxeE37gUYtyKu9DhJYa7y4kTJBUCl7TtrliZcBE2nTpB1uOZc4rX?=
	=?iso-8859-1?q?PNAdPnlVet10tX5bnXc9EZ6Dv35K+FEEgvNbk1/8XCht6x5ZpqJyJc12E38p?=
	=?iso-8859-1?q?NaHqRKsOnPGtFz4Mf0YhA28OXLo0d6oG3sYMnbnAxIuArBvCG2x8HntRmZ2j?=
	=?iso-8859-1?q?r/4qgdzSq5T6/Io7cbjoKeXc8GpEbYheF9LYfp3c6frAB1KDEkCUXaThQUKf?=
	=?iso-8859-1?q?ocicyDrqWSS1v63PfjDwUp85TGN0WakVd3CbUQ5afAUx/ZY5LoqahHvO6SG7?=
	=?iso-8859-1?q?8LDa2f7KQ9rnQVvjZ9yNv7g7QVVVgYXwxEEw0sg/xeHEsfDlp48cUkUSJuAl?=
	=?iso-8859-1?q?IELU5dEFi7ubhRQ3Q6n3bLNXDgfB9ExgCeuUKJKnfltbnYfymBSpL4vJzcgM?=
	=?iso-8859-1?q?66brPgg+O/5hRmoNZJlMoeXaklM28Sn3kx0QsOqRoFxq8WjtjcnAmEd73aJf?=
	=?iso-8859-1?q?LTcFOCAWbYTFnQvQg+yO/71KV9Btrv0+y2ZewwcQNM0a7E8UAmzmEjxO4Wl/?=
	=?iso-8859-1?q?1c/6R0umBoG3fX8oMaQSPE6rWD57w+xUIAm4lF24tihy1lCpKONLPNKrL7ym?=
	=?iso-8859-1?q?95ixeQcRpUBel6Wj59X3md/tZ3f2KNDYLjVyQMvrM11eUkE+p+1qYqRbT8e9?=
	=?iso-8859-1?q?LK8NQwO6kLDx+gtPxp/G82V7x3hMub9kTPfNY5tYRVUHlT/uFN4w05HHGPo3?=
	=?iso-8859-1?q?9Mt0RZwUrQu085UFrD3mGKkI1A52vZqBX/GhmJzoM202syIwwI5RkYslowM2?=
	=?iso-8859-1?q?/AzAWaPq0+FC6yn3ezvhpPHhoTT4EyJkHiQBQmXYdt5oP+/OJhBZM5rf/PEO?=
	=?iso-8859-1?q?Up5+Oj1Z/Rs+bXHcE5gQfwMEt+9cRvsVJ3/037DGXiyaqEr8Zt1jW086uNbH?=
	=?iso-8859-1?q?oq34U04ecId9lW31votGYE/R8zPklPnenDYR+bdCKj2MpAOnr1gXaewu7PXk?=
	=?iso-8859-1?q?F3CRLnDu6caS7O9Efes5Ayfmenrhzf5Xv0MYElLwzD9nR4xSQ/t8rO2ph+b2?=
	=?iso-8859-1?q?9iyyVC2jzWWET2G3xBEta/w/naaNHNEzCuLPCP7dMfwzpbv6SgOC11t0Yn8z?=
	=?iso-8859-1?q?FxO044R2HXr6FlRhMcOFHCSoHXW8zLuwlMwvEb4cHSZuOSZAMidnpomcFrv8?=
	=?iso-8859-1?q?LLrV8hS7MhN+EXi+yt3EdtdR4ZwXtrI9cqP87Om4HMswAJ9aCq8tU2u7IRu+?=
	=?iso-8859-1?q?qXqd2S1gP2MF0vmGnsaozC1zO1yiUVTL5q4t3bt/gH3gN4JDsfcBq/y63Y19?=
	=?iso-8859-1?q?iA7z/vRSBVwBs6LvfpOiSEqnagHdL5PHmgDbCnwQhwjyGtlK+eUjqXAJEloU?=
	=?iso-8859-1?q?/FzFaN56QhygwXsWr8ZTorINm0r3EWtSCj/jBPc25L10owAshPpOPa4wP9TA?=
	=?iso-8859-1?q?gD2jqJa3JowsguXEM948T0dXG+0YBgJKpT5w315ouJQaezgC5naO0jiXisKg?=
	=?iso-8859-1?q?95cYBC58pGb4ZP7XfWst48pWpgS2MJ98iwUzTjqzJy4/lXgdHydhHvtmh4ic?=
	=?iso-8859-1?q?JER9RSsWGxMTgilk3yGQ/mzkI7HSAtpNAO85R2g=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 20c1802d-65fe-4f85-6ef5-08dd45ce116c
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:47.0554 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 mYBGfQ5r2GvlIR1QLDG8bZzdimXVEY4foserMfLhki5AhDgoQwb1lIV9n3N/NR3/84Zj0nSZWnLVD75BEi0t/wQH3A7XrI5amUQIdJ3pgJE=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Add the default configuration file for RPI5 board.
To build u-boot for Raspberrypi 5 the following command should be
used:
> make rpi_arm64_defconfig CROSS_COMPILE=aarch64-linux-gnu-

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 configs/rpi_arm64_defconfig | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/configs/rpi_arm64_defconfig b/configs/rpi_arm64_defconfig
index 02f942cf34..feeef14954 100644
--- a/configs/rpi_arm64_defconfig
+++ b/configs/rpi_arm64_defconfig
@@ -1,6 +1,7 @@
 CONFIG_ARM=y
 CONFIG_POSITION_INDEPENDENT=y
 CONFIG_ARCH_BCM283X=y
+CONFIG_BCM2712=y
 CONFIG_TARGET_RPI_ARM64=y
 CONFIG_ENV_SIZE=0x4000
 CONFIG_DEFAULT_DEVICE_TREE="bcm2711-rpi-4-b"
@@ -56,3 +57,21 @@ CONFIG_SYS_WHITE_ON_BLACK=y
 CONFIG_VIDEO_BCM2835=y
 CONFIG_CONSOLE_SCROLL_LINES=10
 CONFIG_PHYS_TO_BUS=y
+
+CONFIG_RESET_BRCMSTB=y
+CONFIG_MFD_RP1=y
+
+CONFIG_PCI_PNP=y
+
+CONFIG_RESET_RASPBERRYPI=y
+CONFIG_RESET_BRCMSTB_RESCAL=y
+
+CONFIG_MACB=y
+
+CONFIG_CLK=y
+CONFIG_CLK_RP1=y
+CONFIG_OF_REAL=y
+
+CONFIG_RP1_GPIO=y
+CONFIG_BOARD_LATE_INIT=y
+CONFIG_BOARD_TYPES=y

From patchwork Wed Feb  5 10:15:47 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042696
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=TuzV9YLr;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp17v4SBRz1yQ0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:20:43 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 4C78A80EB7;
	Wed,  5 Feb 2025 14:15:41 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="TuzV9YLr";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id B452D8078B; Wed,  5 Feb 2025 11:16:00 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_NONE,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR03-DBA-obe.outbound.protection.outlook.com
 (mail-dbaeur03on2061b.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:260d::61b])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 46301805E7
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:56 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=ZHcrNfRyZ2u6TqcBhyKV8IfOC2SRtcQT3LrsKGdyICenIPbrksT/X5VKAelw5HS4rhw/VUhkJfiIXSHCZZZ0AdzAafMqRtZlT+uBJLzjESl/1ZaOYh+EhVV6OHp+/S770Ha1hXVCND3rNJ9CCeTIod2Jxn2r6J4x8eK4eWR8xxsI1OTRF5dr9CsgAyVzjRxRRJn4bQZYZ4+aswxS6J4gg7pqqmG6KZkhF0jN47CrFm5blSdjeTAYFFG8pF70xkR0izfFza5l2RNLDoVcEX9hM5Zn359gIxOMYzJMt3Su/O3KqaJGDNjlbRKhqQV0H0MDpXBx53xiVPIKbifN++ny5w==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=B8S+bW32pcJFx31RDUdzKrOpMavTv+qbTI55lZ5xZi8=;
 b=pJfpTr/IpRuybxs/9qLWhCxjI3LJIgFd/ebO+2Vo+7w0970H1HnIw9ZwTIRSHGRwtIKL88ft368zYr5NnSvis7Rfr//HoY4EUR5f9ybpAem37HCCdnjCnlSeb0N7zEItuvx8ZyCNJvdf1+DLDqMMJPB0eqtputwcfah7bvaB9oAFBJPKBjPxZsWBBUHgbP5Rn+3cS4/zr5XZRjsv8XUWYgjNJFn8vzouvS7KqPK80ILudrQZgHi+bjLtwTSBeVZM52kGhOoEH4C1Ed0zToAFV6HpKI3k1kxoCpVYIPM1NAW0em5u/X6p2vAo4C5LS/TiKgFkHUhk6dMKqrxa9zIeoQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=B8S+bW32pcJFx31RDUdzKrOpMavTv+qbTI55lZ5xZi8=;
 b=TuzV9YLrVSg+3vLeHW7S80dcT/0Lz5ilfgm7WSalFtjyAr7zeaMnj6cdEO9ut1OUUWoc3UPcKXi5MZXt1cYVBhcOblfPgus/RO8zgpGDnPCk0zFe/39HXliBHjYelnQ5g7M4ilfX5lnScu+GMUs1pcBmvxOWpseoEbbGZ/jysDxMA0Dr+TLlzdmmbEWrXIBDiB4Id6l/yL3iLSfB7OuPxKhn/gm3EyhV1kaYkGNc5/b80VSX0yzZ2sqvOFEoyuw7oLL8glpvS2eInnXKfJRfBn1Fa4EBdhcesRwtuLmCVWkUAl0rFMWXl7OjuaEBUgbHTmr+W1I0bOKXnDarnU2h0A==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by DU0PR03MB9635.eurprd03.prod.outlook.com (2603:10a6:10:42d::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:51 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:51 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>, Matthias Brugger
 <mbrugger@suse.com>, Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Peter
 Robinson <pbrobinson@gmail.com>, Tom Rini <trini@konsulko.com>
Subject: [RFC PATCH v1 16/20] board: raspberrypi: rpi: request RP1 in
 late_init
Thread-Topic: [RFC PATCH v1 16/20] board: raspberrypi: rpi: request RP1 in
 late_init
Thread-Index: AQHbd7bsIxBH89OrSkKu76y12VB4dw==
Date: Wed, 5 Feb 2025 10:15:47 +0000
Message-ID: 
 <040415712c5d1ed8130c6cba3cb2c25c1b46d587.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|DU0PR03MB9635:EE_
x-ms-office365-filtering-correlation-id: 46eebe71-55e7-46aa-f129-08dd45ce1195
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?V1EsjWu/Jm3357F3d75Y+CaOOp?=
	=?iso-8859-1?q?Q88/sWm0oCtHsAN3DbMZu1g2fbms6mSSHipHCjkFXdKbNYHCdiSSL+ymZLaV?=
	=?iso-8859-1?q?g3aI6USHQzoaheJxXBRyHIpqqEeVC2CsWhz5s5KWEeN310dtoUylm0yD40wQ?=
	=?iso-8859-1?q?oRN9xBeQb1145oUIHP8qwf0QkLON4UFBtxaNysOgA+eOQ0hhyuIJ7KJJM0z7?=
	=?iso-8859-1?q?q7iG6h2tdWv24dJF/f/5TtNG4s3KyqftUSNSpwJ6leAnuar8ZwrxFpAfpXrj?=
	=?iso-8859-1?q?br9h0jXnW/3oQCkcSDSdyZI1QOeyDMK0OyVQ3wra9xsGhc/2rjNjNqYDAjxM?=
	=?iso-8859-1?q?Zam1EISxrIs2pz4ibuKwJ7+s/qypbocFx91jN6tSAAhS+yrm2Ys+X8P/FXRg?=
	=?iso-8859-1?q?o23JTUZ9fK7hzeYlDlkTxxo7LPIcf3YaAKK1upeCOu5Nj+2AqFAWSyytbsvn?=
	=?iso-8859-1?q?XPZfwf2zJK9M1ztCaA7ypACxhK3Mk3NKW3Dgcr9BTdsyuNQ92+rx5ESDMMCr?=
	=?iso-8859-1?q?UWNWg5RLTVMbw3en9CfDGctCUJ6vjk3V0Fk5sL2+TpLnynD1qjofW/jms9jR?=
	=?iso-8859-1?q?8T8t0/Bqi2kgLk4iJANHYVc4bXlgPXNNOAsmZszQnthrf59Ey1N1HhMgSKUN?=
	=?iso-8859-1?q?teRmOW376JXEEpNmGtbQrW8+EKDdsJq2cc0B0D5qVO1UKvyq5U4dmtfo0i6x?=
	=?iso-8859-1?q?ryzyzdczepxVsHdr5X8vLiudivVTPAuG50mDQS+CRPGoKZIINBBP0G+X3CJ7?=
	=?iso-8859-1?q?huDBv5jLhcxLTYmsh6OCCPQjJyxYBr2vkbn/Q3bXoeMW0I1PXlAl6q9Wf9gW?=
	=?iso-8859-1?q?O3UzetHJJ50SgHRHyYKl+vdZPxF2/WZBPSb7JHz9wx7dgO1qZVOxZj7kETkr?=
	=?iso-8859-1?q?RJryTISSY5+DqBFsHzicBBEr7Iky6OmJcqC8j93I9T3txesjibfCbwLyYYmH?=
	=?iso-8859-1?q?8G57IfW18Dh9X9mNZoR0hN8qG1Hr5bGyGFSSzSwbPtTwknRW8nNZ2sXnDgjf?=
	=?iso-8859-1?q?uKhngrtO98Fp/OBGR8cdQvNE4DQHX0VIsTdyOLmbR3I9DY/q/gXS/c6mEUyJ?=
	=?iso-8859-1?q?FwWW7CXyMlYLDwhoXM2sSi+1gHA+xFSMcL3yVuawC6QC7LlCBQzupnxSXvhI?=
	=?iso-8859-1?q?uVaLweBL1E7j30ywPH32pJPOeDoIRPw2mOpm0x/PKPed7KyeuWnhlyPL3JGl?=
	=?iso-8859-1?q?XUWvAXWZQdy2kwxCn+rGDxM1CXOMjJ82CuTC530egsVQWcyEtu10cDZaN4Up?=
	=?iso-8859-1?q?qtdwkC/Ae/ZvGPfs09FLQDatEX2wmagPu7N1r9AGk27n6hdZTG117gO3XC1A?=
	=?iso-8859-1?q?oLaDhVR0nt+32sYiAL/EsQ5LIQm1/a4W+g7SeAJP+KemkoXQEHsqMDEjzlVB?=
	=?iso-8859-1?q?EbUDj4SuktdVrvqsaXeYItrj9AiqoMejdZXTvbll4I2aY2GJR/b4Lx+OqyVB?=
	=?iso-8859-1?q?bvCPc3G7GAlipah7QsRtWEHOhMop5QyNjCU5kFy6BrQC+s5Tavm12uLbrtqE?=
	=?iso-8859-1?q?Kx3oDP?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?9Tnn9W8MLuGA5ykY387lGyO?=
	=?iso-8859-1?q?poKe18YdacRgz/205qtuIWGpn9E1wVxOBAeI4lokMagIErRvVSTd9TBAnkb3?=
	=?iso-8859-1?q?2iwB97Y+e80T5ZDp/Wn2KrJoLPa/7KjD6unXBpupoSI2FsGdX26HGO0O8mGu?=
	=?iso-8859-1?q?AQR1/fWX4YuE1G7yuurVQSKpdGp5DkZ/taHGqII4DXoJinE/Inmv2oO7lXKX?=
	=?iso-8859-1?q?nPRtG5fbL39TCQHW4C1p9GTaxFBDQWEcqC7lJGhnfQ8BqoGWiywPBIbHOJpa?=
	=?iso-8859-1?q?10I0xNGZbxSpCFNXj3yMOiS4CmNX+Yjcwd4FYeS+0YL2Ifvad9ORAEOueZ3E?=
	=?iso-8859-1?q?L81p9Xi8WKqxr8AmyOq8urbhcpfZ7XrrmaHp194XBNDghfc9XySTMy1OBhsf?=
	=?iso-8859-1?q?YnXwmtibGBqKJ70U+5BA9siw0UnypTtRbtI5GvVbNaBneAbVu4h40CXy15Tz?=
	=?iso-8859-1?q?eMuux278+2viDZ2/KVCs9tu8R6y0r7o0KFyCHM8igxEufEw2sDBgVZq5HHQg?=
	=?iso-8859-1?q?qr/Vi2Z781xicz6rqcQJbJnJgnSKDPTAMiLVYW65Z1gEHvDklBkzYe72nDG3?=
	=?iso-8859-1?q?bko/LTPlqazZrLDrvMbaC/TaMulE2CYwIYztHPtwUgKdEmJjCZjB/G6Z3o/y?=
	=?iso-8859-1?q?9xGh04lCtxG30scx0VTECBno/Q1BbCOHm7kAEjtKVbxdKddgeb+4stSUCJsM?=
	=?iso-8859-1?q?BojlikvO+dBnkPE2k1AY35UYox3VAlELSBfq7WWA5GkiKharu30ERmFnuaS2?=
	=?iso-8859-1?q?j4UUk2LxAY5T/42b4mCFETd/+NXXatjl0//2xuj8ITqE0Fb+Ct804OpSoiqY?=
	=?iso-8859-1?q?PkRzxEC+aVfbrxwPDWywyVf1sg97U7pM4Lry8ZSpY2h9pwMXrBYO80HdN8bP?=
	=?iso-8859-1?q?DwE6P7ivXatGSyBPTN9ku7e8pjF0o+f4NY2toPj188MIGT2qkOYyEUeUxJoq?=
	=?iso-8859-1?q?+/9EmDAj6cQgLMJu3QKj5G4bwsc9uCETUIXTk0qhdg52UzFCkTjrxIJDPcf3?=
	=?iso-8859-1?q?I+UK9UXteZNwI2ty8fWDJarbF6ERTs76KEv5TtTPwapug7q1IgTIRKW3Rn/W?=
	=?iso-8859-1?q?+ih/Lnp9JJvTu5jwQJMlpMXwaJOlXPUzYnzJQ8n0ofamgcASDDF5F5ezS8cj?=
	=?iso-8859-1?q?wMb7c3jPMCoghEnHIIviOXHp23FeUa/01JtVk4EKetTLXp7hjdop2eAahxkt?=
	=?iso-8859-1?q?kFbx6UrTsZR2lf7IiVVIRPVeZNPQ1tTHdqwQOSk94EkOL/bsQMGSd7ZKz116?=
	=?iso-8859-1?q?T2s1L+L+E1JQjmjl5+7Yphv9+GLPPOYMVE8nmj10Tuh9s4NgkSK5aRs8pUSM?=
	=?iso-8859-1?q?gvZTOJPtqH8tR1jR89L7Ac7GkfKIqjyKEhVMHEnekg6bs/Ju/TWXmyYPAAf5?=
	=?iso-8859-1?q?C2PXt43xuUaxfnBzcQqKxAXT0k+uoB1Gcy+Q5mFYXOAOfSnQF9Z0R4qA9QoY?=
	=?iso-8859-1?q?jtJPZMokm2DLxh54ZHc4EgngfEUalqOHDiWFE2w0cNLTLyUdnumAsRdg5k1O?=
	=?iso-8859-1?q?rIvLV/jOCOggPRQV5QJNziQ1dDEWUHFWn6rDEj0fXC4oI/83KpvhbSSjECJJ?=
	=?iso-8859-1?q?QsZlrNsx2KgX/WLpKouAR6AH6mMmaCjTAubQnlkM1Om6PUXgwzX+rF8elhl4?=
	=?iso-8859-1?q?ddC3w7RZcUOQ6bUjbh2Z83ZVcqtr3nvjcEH6h0g=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 46eebe71-55e7-46aa-f129-08dd45ce1195
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:47.4320 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 +ORiPwRvoPJSgaftdc4bm/yNKciI6YQuiAhuHfQVSigwJ20ur7aAdxsDbzWgbO54RqTW/8tnd2uigt1FRMbWg+RSgUdkBjE3pkGiF/ALNPQ=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DU0PR03MB9635
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

From: Volodymyr Babchuk <volodymyr_babchuk@epam.com>

RP1 chip is the PCIe device which should provide transparent access to
the peripheral connected to it for the main Soc.
Current RP1 device tree node structure and RP1 driver implementation
don't allow PCIe subsystem to make a proper initialization of RP1
device with child nodes. So RP1 probe should be called after all
initializations were done.

Signed-off-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 board/raspberrypi/rpi/rpi.c | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)

diff --git a/board/raspberrypi/rpi/rpi.c b/board/raspberrypi/rpi/rpi.c
index 32d67eb7f4..c45b1e277d 100644
--- a/board/raspberrypi/rpi/rpi.c
+++ b/board/raspberrypi/rpi/rpi.c
@@ -593,3 +593,26 @@ int ft_board_setup(void *blob, struct bd_info *bd)
 
 	return 0;
 }
+
+/* TODO: Using late_init to initialize pci device with ID_RP1.
+ * RP1 pci device should be initialized by the PCI subsystem because
+ * it is under develop right now and depends from the final device-tree
+ * format from the Linux Kernel. Current device-tree format violates
+ * pci driver model. So this should be changed after upstreaming RP1
+ * to the Linux Kernel source code.
+ * This initialization should be done only for RPI5 board.
+ */
+#ifdef CONFIG_BCM2712
+int board_late_init(void)
+{
+	struct udevice *dev;
+	int err;
+
+	err = dm_pci_find_device(PCI_VENDOR_ID_RPI, PCI_DEVICE_ID_RP1_C0,
+				 0, &dev);
+	if (err)
+		printf("RPI: RP1 device not found\n");
+
+	return 0;
+}
+#endif

From patchwork Wed Feb  5 10:15:47 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042684
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=Imx6aHGQ;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp15k1975z20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:18:50 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 3989680BA5;
	Wed,  5 Feb 2025 14:15:37 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="Imx6aHGQ";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 4571D807F1; Wed,  5 Feb 2025 11:15:56 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR05-DB8-obe.outbound.protection.outlook.com
 (mail-db8eur05on20630.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:2614::630])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id A00FF805E7
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:53 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=xlBqFwd5gcAla7kvNkwTB6LECsfnh7kBz32buMlNpuXKrUA9PO7+Ibqhf+il0ZYW6sqk6QUz6hK+tRAQfyxkS4zwM253zsY9U45jpUR16aMEXj1YAE/6N8ztf5xuio3o54Yc2aA1TwisFbcI9KV3lWD6yCiogTj2m+0p1HqvH5n9mgIJf7RDH8U4Pd1hqf4jgdwwDdmntCv8VZTAtjHHe8N/ltiErNLgAdxMsXs7F2AmgKbhzzG5F6FeZ8u0ZYlbIYLeTfwGMf7h5lAbYtwUnQN/O4ltTo7EV0jJXeIN+WAyAUzRnXLloNaPWIRL+T7AU6XYpbsqUhsA3O83wbvWiA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=4ndRS0/yBQYeoamA+Kl2thDafqfQHLbmXlTNOaXPTF0=;
 b=SZmi85f3WMGuEj9nRxH2yuhLTBiFHg91rHTxMod4TsqugDchao9xuvJAaCOxLltTMFwzQYXywuXrUziTukFjZ/c0ICNVkMr49vjRYiRt5xDWb0nl6a2Sl8R3m16B2EMbSGX9Fa4rSKrYK7cfnTvW2lcdlFlCb0jV37/3MDAEVSJy/prCC0Fr6vRb+PQKrhniynJtEU/iDC3G+WZ54JzAZfiHc7reoh4OSSevy51shTkEjJ5knHpRHwPsiVprs9ZtVwikatOD8fQFCwdz1rnyJY/Qje8eDlPwwIsMRXfSc4DIxEzaASgwaUwf2Ej6Q8ogMArgg7KO68gVyeuJtkRvhw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=4ndRS0/yBQYeoamA+Kl2thDafqfQHLbmXlTNOaXPTF0=;
 b=Imx6aHGQU/cBYW0eOkaEbS4g72OR+GZ2M+aYYvp/3/txrnL7WOZqZy+UXQoDGDsgvkxjkmkmUj7vvJyN4HwUz+iSuCGyseVypTnDnclBG/1u29DrggBy67aewCxFPcykPTxVqrtf4mEUeeiOfV6prVTBdfAvKbszpILkRirzFwjIB+QeGOY2qQ7q6M4VBbWPL72b/JtMVZ5rXVbcRI2yxBI1qqjcNEnaike8TABBjEsF3U1gtVlEGcl0KpcvNGZx0mTmWTbs5Wl36Zq8zzWBSBXCGRExurC5iqYop92HwKDZrVc8ZDm0DJccx84ZUYIeZCxUjMU5Ig04ESG23+Ky1A==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by AS2PR03MB9879.eurprd03.prod.outlook.com (2603:10a6:20b:547::20)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:52 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:52 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 17/20] HACK: drivers: mfd: set bar configuration for
 RP1 driver
Thread-Topic: [RFC PATCH v1 17/20] HACK: drivers: mfd: set bar configuration
 for RP1 driver
Thread-Index: AQHbd7bsjbYZO/pyn0CLV0NURhGPrw==
Date: Wed, 5 Feb 2025 10:15:47 +0000
Message-ID: 
 <e51ca0d2216802d2da21163a41ff72ae08e1772a.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|AS2PR03MB9879:EE_
x-ms-office365-filtering-correlation-id: c1a1d5ca-37ae-49de-df25-08dd45ce11c3
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|366016|1800799024|376014|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?kGhRyF05ReizGubXdD3WSXfvqe?=
	=?iso-8859-1?q?bvBBnnExRwYtw9+gXKnC2/WwgOA7/X4QmoHyTN16AZkMqqzmWwt2JmrRpAxu?=
	=?iso-8859-1?q?DZ7s24bwuoG9m3gW+2Exk7eXWE0UBF9slcKg4oU/2VdWEvbXCsihhhKg+7fj?=
	=?iso-8859-1?q?DEk1wcl59BNPvAEgFnAQroxElsySYusXi2e5XzSQ1nH7v0xELCSpz1vGcIZG?=
	=?iso-8859-1?q?lr45b6p4GPXvBFLLQVI0EzZvWiGTANlkrGqR0FTELBHsOtbHc+0qZ03+PFnk?=
	=?iso-8859-1?q?sK78jfW8V1H1ZFNlxgv/e2/+cuPE+v2hwoWXjl5tzbV7Fqmov0BJ8iVC6/gF?=
	=?iso-8859-1?q?yfZgFEpf/zq5vkokrBsoTOTfmw+WCYYwaC5P/8RYVNBHuZbyT4Hmt4+XH7xC?=
	=?iso-8859-1?q?sl1fZBZCK53jVJ34IM/KardUk/Vul+ewcYHPuIxJ/vn24V3sP7ku2dXYESgC?=
	=?iso-8859-1?q?z8Bf3J90ZK9fJVEGMtQY048Y3/ymw2TSX5YoSvA5HqASa/u+wb+PeVARf78W?=
	=?iso-8859-1?q?g6cwypSvV/xQdDqmK4jvg9Ws+iyy4NBAb4Yz4piIV5Qh//LWX+EZxJ0rHd3/?=
	=?iso-8859-1?q?WTkx//8ZMOOVnjYE28B+hwGhtEIfgmlMDfIffJC5coetv2p6gwAIk+zFJaAw?=
	=?iso-8859-1?q?Q8DMLOtzQsycm2jYuwvVaeaOmUypVbzAfE5mIZsLG1HMnrZJGKA7sdfNWcr9?=
	=?iso-8859-1?q?A7UVT2VV5G5wUM66RmP/d8BlEqsDqgEgQLBruQBTDouD697AucnVcp3AJfx1?=
	=?iso-8859-1?q?C9ZQT1gPkD0FhOaNlCWIa4zCFAxlelKPmMxU5uJ3du2MZzITOuyn37eg0YOv?=
	=?iso-8859-1?q?YHYBJFxZQw/ZfgDcEyLw1V+li3t1HsaCle/yVniw4uR9a/wU1CzoH4y5wIRP?=
	=?iso-8859-1?q?Re85RLs5kR7GL8Dl92O0LBgmMp5y07aAKDviNH1mu22XJaIFqVmpe7rWCUxT?=
	=?iso-8859-1?q?IvCXMQf9cJC+t3U+K39lMl1je0ESpvysN2AXxB+NIUvjCyjcYJti27+SDAuQ?=
	=?iso-8859-1?q?jiJFsz8hOs6VRnAGZpUavli2twLFZ5Px7hOGbrElnWxb+5ggNDztzh8V9UAu?=
	=?iso-8859-1?q?/QpulZVNsQEvKCgq3KVzyPBtgCMVQf3e5cfuaaFx3jYklhPTUYxbHGao8wY3?=
	=?iso-8859-1?q?cQaL1wmVm5YKITFyqyNxBw+DuZZhA64uGh03rLW6UZXkCfsPgMVmjGxAzm80?=
	=?iso-8859-1?q?e7LnjV9buZ11+ljM1HzlQ82NrZF2mlRE9vctqaMpz/5Yi3RfkOMYkOZRc8dH?=
	=?iso-8859-1?q?IYGa+Hf8KFqCfvxBojE7MteaZb/fQ4xj3MPidGkqEVFCYaUH4pVZ3OQqbPhx?=
	=?iso-8859-1?q?dqzo476JRpOlhc8uBSmdu61Q9nUYruHOzSaq3RObosCZ6JaGsUVBtYcJBILX?=
	=?iso-8859-1?q?KsjV0TTKZxOoaKkgp1whHZOkWPYYcvOlGooCps/itigCzjTsZHMxHkvIxEXL?=
	=?iso-8859-1?q?EwP5PhavmQmK168lrTc9wTH3ZDipHffnJ5pkefx1gdoP8Br7YJdDjZfKZ7KC?=
	=?iso-8859-1?q?DXlMNg?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(366016)(1800799024)(376014)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?UPu/5t5BnoIVtOWzKwGPa7N?=
	=?iso-8859-1?q?kmdyTL1k8o6B70G7imcCZG7pemd5PkiJcBRh1GbEQDxSlObVhoJcjbd+8Jq3?=
	=?iso-8859-1?q?lIiazPr6qg9os5hbB2j1jDL3aqBannNwajYPHCMhLvAjS7FG3aCLlzTw1HW5?=
	=?iso-8859-1?q?Fml0W6wph9ozCAJR5Olf7g2ary7SUZc0+a8AF1eVarZNrSXI8+wQ91bg/vbW?=
	=?iso-8859-1?q?Tqh4aSoPLHA92BMLnfWCg4Hmf2dELgxxTaXV1LQdYJJaa/dPTTVjLOpRc1TE?=
	=?iso-8859-1?q?GXRnc22HaF5LSoG7OoVr12EaDfcLXYZMxqp2vE+VnoCLeqmCZCZ4fkdSMCrL?=
	=?iso-8859-1?q?9+Hv5NJ88niVAhDh15LxHfEKIUCda4CGI9YnUEJic5vaSt5PVMY83SNk5RYy?=
	=?iso-8859-1?q?ybn34oRwALoJ3aVGmrz4hyeKnpO19ed7B7rwj62CwxPnEqtLUVMndNB70o3m?=
	=?iso-8859-1?q?duGdhJwTiEghTnK6nzyaDnbFmYZOwbq55RwyV6HfyzblxvjW3GlQ2XeApWxr?=
	=?iso-8859-1?q?lR8y+U+nwazEGi6gWqLzSqTEglYBQL9rQcDlI0M/3QvV8VGmNfnfPW3GUThe?=
	=?iso-8859-1?q?+R7qOLevgH2VvvfA4dhdl75BnHn2qh1EbcALadIM6j5dxQAaFjl2iJ1bwGz0?=
	=?iso-8859-1?q?LuXqmPO4KACUsHnYZMRLWWDpYb8WaDcLAYzwlCeMhn+k+qFkL/lkHeeEhTKY?=
	=?iso-8859-1?q?H9f2c7tgexfFd5ErVOwWXidqXXKZtJjqeZmguLaujPbdxWayiTfNXRXMVoLp?=
	=?iso-8859-1?q?VFT4t6qGwDSNs1cGZxjsXGxbhaGQ38Lvi8tJR9FrlrFmWp8tbii40GIdNzfq?=
	=?iso-8859-1?q?+8G21X2UBC7Ch1GFcOBb/9zIju2ksc2XkYEJMVvSMJdpkG8UTElKuS/cXBIX?=
	=?iso-8859-1?q?E1J+6ln1XZT+QIFFdbAJnR6x6xBlO+ikUyJtTAQw91boQ3ezd2d3OB71tjC8?=
	=?iso-8859-1?q?hUIG7FHXBtCtfptPfSENZ2cklEjLAmuTNeBe4FhbqnIyT/drJzDfHU5iS+l1?=
	=?iso-8859-1?q?LLj/cXT3wA2G9fnkGHIwAvG3njVGV9ka7HjQOog5EDWhAssDOjXJRWbifl8M?=
	=?iso-8859-1?q?0M4RI2bYODr1LLJBs9dzwIyTKNGjgZDa6VslYaeQmteRUk6TXEUlS3IQse49?=
	=?iso-8859-1?q?Q0j8RWliqxL87yjUHlbdNmT5fA0+t2u136VDL1x6NH+5U9LXxr43E3oTCfz4?=
	=?iso-8859-1?q?vtfgv8A5CQsKqG7EqVR+Nuj95TiZmhJSrxUpDnm6kXmO7LLSkzhUa8PA5p0N?=
	=?iso-8859-1?q?dxdOcSewqt9hKxeQWjKT2f4+e0NGFzGTDzGqnOhU/Yd0StmYjVeYDORYnPD/?=
	=?iso-8859-1?q?qBVGxcb+YuKRKkX0P0+OP5eD1QGkziDtayCFMQdAJr5BWjCQfFf0XJMjwG4S?=
	=?iso-8859-1?q?Ro9NCiK4kP2W+70Es9nE69SZnQZhY3wCf1Y0/mE4CKeZFB4zbzF+027CF35d?=
	=?iso-8859-1?q?6O9yS/2oDfpxOpV8XfKEqO0pxMtFHzX7DdXF3mwbysdxcmTOr3wrAOj2qHfE?=
	=?iso-8859-1?q?Nj34CjnErsagIAWgw7gkUSc7yiI+XWE97YnN39LJg7hkpdy2Kk4DSHBLKP7D?=
	=?iso-8859-1?q?Wbc9vhtBGnrWs47I6aU+QxraUEs15i6nl9UPbxMjc22KAbEFYI3UgdyjD/Kp?=
	=?iso-8859-1?q?4hSVvQjCFvgFpLddLTUqDO/xv+RdUYt/UqSyXJw=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 c1a1d5ca-37ae-49de-df25-08dd45ce11c3
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:47.7771 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 My8FfqYAXqcjlX0ayA8EamRCg5AsqM0wNdUf+rDN1vNuOFFq5RkSGvu4LpI1HWt6UVZhngP41VxNaxVRFU36bUxT+1qWJTsEk+Ao3E6lW40=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: AS2PR03MB9879
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

Set bar address in the correct order. RP1 driver in Linux Kernel rely on
the pci BAR configuration which initializes BARs based on BAR size.
This results the Linux set BARs in the same order on each boot.
U-boot does initialization without any sorting so the configuration
may be different from the Linux kernel.
Here BAR address configuration is set to match the Linux Kernel order
to avoid fails on address translation.
This should be changed after upstreaming RP1 driver to the Linux kernel
mainline.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/mfd/rp1.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/drivers/mfd/rp1.c b/drivers/mfd/rp1.c
index 265ed668f5..64008007be 100644
--- a/drivers/mfd/rp1.c
+++ b/drivers/mfd/rp1.c
@@ -63,6 +63,20 @@ static int rp1_probe(struct udevice *dev)
 	/* Turn on bus-mastering */
 	dm_pci_clrset_config16(dev, PCI_COMMAND, 0, PCI_COMMAND_MASTER | PCI_COMMAND_MEMORY);
 
+	/*
+	 * HACK: Set bar address in the correct order. RP1 driver in Linux Kernel rely on
+	 * the pci BAR configuration which initializes BARs based on BAR size.
+	 * This results the Linux set BARs in the same order on each boot.
+	 * U-boot does initialization without any sorting so the configuration
+	 * may be different from the Linux kernel.
+	 * Here BAR address configuration is set to match the Linux Kernel order
+	 * to avoid fails on address translation.
+	 * This should be changed after upstreaming RP1 driver to the Linux kernel
+	 * mainline.
+	 */
+	dm_pci_write_config32(dev, PCI_BASE_ADDRESS_1, 0);
+	dm_pci_write_config32(dev, PCI_BASE_ADDRESS_0, 0x40000);
+
 	ret = rp1_get_bar_region(dev, &rp1->bar_start);
 	if (ret)
 		return ret;

From patchwork Wed Feb  5 10:15:48 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042687
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=c4Ksyk/i;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp16G3YNVz20J0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:19:18 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 4AE5380C58;
	Wed,  5 Feb 2025 14:15:38 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="c4Ksyk/i";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id C39C480819; Wed,  5 Feb 2025 11:15:56 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR05-DB8-obe.outbound.protection.outlook.com
 (mail-db8eur05on20630.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:2614::630])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id BF0FF807DC
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:53 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=L2HGxHzPno9OFbdOsldvwYvFUsUr2GjerVuhix5t691hCwlMcTMP5LGdL/ADh0t8iSlSgnbc7UQExPpz9rzAES9hNsomRwAb7RtQ6Co5zP1s/hbhjgMg8dG/EZdD+ZsU/njZQSE0bf53DEVYM7b3kZOMgw9S2zHvWOjm68LYysJmCjyIB8fbod1cM7eVYdwAgbsQMU/DefkEQ2kW40D9rvaGG0pwQIVC0ngr430d98h+gK58YzV0STj2Gb9xaXYQUrvBtLQ24X0BnIyJ7TpLc2oqA9qR8QsX0x15b52SD8IhJyr7gKO4vvJ1ZnJxqDq9cwBMqFSX7idkvIIs7tTqdg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=p88iADW7gvcl/ghnPLUavChoJGCvtE8V2VLEC3eoe/w=;
 b=LZ+5cm5OCeECyxq/2j6iofJTvytAgBiy1vXazdnEFzjw1FyFZtLsfM7TWcwLG7bfeiOR6BluP97SBjorIJS23iPJlvpisV8qTP6KbqwN8uDNYdRQCI6d9o2iw/Tu5Z7MKq7/K2ZZSmR1RaPR4xElzI52uax5bR2o/5Eyn6yYdOSkjtnYzHc4WaS39UdxYNL7CGdB2DPVJWpo0sfLJWF9hJzg7kYmXusNG6EssYYVnu9jADqimSYyY0fMVrHOwSf201b3DEM4ED3Cb8opQiZ5OGHNnZTCr2XcuxqkkZXDakHnhZ/CYo75MjzQNwgtcN20XX9vmoZLg3U7XiW4WgAiHw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=p88iADW7gvcl/ghnPLUavChoJGCvtE8V2VLEC3eoe/w=;
 b=c4Ksyk/igBGWAxjgy1OwBkHeUv3WLFrwG59ZfHce3uKUK5NG66iXi6NK+81W+3XHC4W6CAtsUk4jKbip2SK8PHPos5/hSjdxLMUJjM8GiheMPCdSLXW22LfjNgZew/7VZb879cZu6ZdzQo+D6A1fUArIn8dj/ED9O0xN3PgS99Kvoh+6OP2JavH9kkVvK5gYOI7GWEbJhLnWK72kn1EBxfoWt1qfXviTmcuYgF+VIJmJZCKSms7OTeLtKbP3lNwLKd5pnRw+KgCGIXk02fKavVG5XmR98+9/JhOE8uWWYwwP/ZZ1G+1lxtP6M5676lJXgB2Hgp9HUoRT6tE5j7inAg==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by AS2PR03MB9879.eurprd03.prod.outlook.com (2603:10a6:20b:547::20)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:52 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:52 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 18/20] drivers: pci: pcie_brcmstb: use bus_base to
 config PCI device
Thread-Topic: [RFC PATCH v1 18/20] drivers: pci: pcie_brcmstb: use bus_base to
 config PCI device
Thread-Index: AQHbd7bsX0pRiOHWBUad7OvbLEoXPA==
Date: Wed, 5 Feb 2025 10:15:48 +0000
Message-ID: 
 <ff06b6b734de11e0dec9cdcf307db8bd77989f5c.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|AS2PR03MB9879:EE_
x-ms-office365-filtering-correlation-id: 0f2e4fc5-1de5-4ada-478e-08dd45ce11ef
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|366016|1800799024|376014|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?bAKV8kKPVNKNfzba6hGi9hWtrF?=
	=?iso-8859-1?q?khzAt38p9Q+uIan7PlRMU//IrubuMA82vCnBO3Z3NRMTG8qqWpdLG4xdt/HZ?=
	=?iso-8859-1?q?wyHNpez1Fq2s9k+vLqLlJXeP4VtxVNIojS8StPHTUHXCuS4jpyNaAhV3WjXq?=
	=?iso-8859-1?q?qd4J4iPely7BTzKM6QN9t5PgWPfZHernDaIysG/Nl5tOOvm/0RGYTvymuQd/?=
	=?iso-8859-1?q?oZR0K9uY+qsPigWfUMs8Bxjg3i+t+1DGZJangmrZ1xTjQRWtwmprypp44hLn?=
	=?iso-8859-1?q?2joUPASDeklxIcfrCn1ZKVt77fGwmkmZCXtCBdyWs8j/ajNZcc9RY//+7zaC?=
	=?iso-8859-1?q?30eYkqRy00Y1U7fh5EAuDU1Sy/bgcHh8W/TxopBBwXCZUJ2Wt1WumDLoXAzv?=
	=?iso-8859-1?q?3YDYo+qJ8PdwsAb6XCcysw7cZzirFsFBEncfXwq5C2ATlyuSXATpAl/ntLg4?=
	=?iso-8859-1?q?H/2ulyYS1B3qzFJXvvvnxUrYH0c7oxWPAlv0g5bvl8EqLzDIypgFdAqK5wD5?=
	=?iso-8859-1?q?KyJTyg1FpNPRE3OHnklpH0S3liZWPFVuDEuKp1b6sRiE4DPP5yL41GIyEnVc?=
	=?iso-8859-1?q?e2SmcUgB5XhHDRAxUYka6o/yaGKJFhBTdiBlqKTjxQbnJn15tfzyChPKudCK?=
	=?iso-8859-1?q?5+t9Rzfh4WXr3EvG5eZmlxrfvvv1hTMT9J0EmStb7p2LUcH1EfyrkDM2mE2T?=
	=?iso-8859-1?q?NXiFsROa+tfevlU7TYns1JdKbfL6f7/lt2Yga/BU0PR34mno5eMZt22Vb5bw?=
	=?iso-8859-1?q?VfwPMLnWcN5FRy6XsL+4I2qKbZAGRB1O7HnRUJY0B6REmeBtbmnVJDjWSSz6?=
	=?iso-8859-1?q?U+EH7uODjWayKtisEjJ2ii8Ede4Ye9U4UGZ159ua5MKV1GybeyKbqQkpFbCl?=
	=?iso-8859-1?q?9kj+vluLBGeZSm9LPv7nAtmlsERc7OzkBe5ZJSh8KHKGHEWF0Obj91NvcFqy?=
	=?iso-8859-1?q?h3qI6VluL2lSVZBL9JBIg7rjfmJO7p98SBWl537XTfAs34E+jlJmVb4aa7ef?=
	=?iso-8859-1?q?Allh7sFs9OCCuraqiZ0bO98lwGlE0P39TyNpmdjp/Q3GnvIZsl2IBLIm3D4X?=
	=?iso-8859-1?q?8v3QOI6cwlXCiN9JX7KJtEBcifBwtJgbmlyxhQfh6LY/S5GPvTyhzNbEIVNY?=
	=?iso-8859-1?q?f+wVGw8JYYNLSuVS/RqLDMVEYW5kteDkJgAV5iudmRAtrtCr4wxoyvizLmT2?=
	=?iso-8859-1?q?xaTOFG2/0AeIvhK5BkAC1q+gFrtcA3Ad2F/w/EI8wnkYDpLb82C5NxJU5ldO?=
	=?iso-8859-1?q?p6PfjuPVOSCEMj2Q88VaHU+sdgm2rJxKDaYnpjyiQbkFpPUfNiN2UYljQNG+?=
	=?iso-8859-1?q?9G1wiXF6tgQAh3I/LFPZp0TeIrtUfz+5jlkKvRHuzkdnfdoZv19uePixuSL/?=
	=?iso-8859-1?q?Dnpxq3XzxHW7ujTF50l8fScXFf5sMzWgHMIeBIJMaCAzVPwpDQWQnUJ/Hyym?=
	=?iso-8859-1?q?5btXeaVQpBUAuWwYG4NPUHd7cHzfLA0kNooDDtZm8w17rq9f3PWuwdgDb2ck?=
	=?iso-8859-1?q?NdWoc0?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(366016)(1800799024)(376014)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?SCX73G531+ooaYZfm7/fm1f?=
	=?iso-8859-1?q?kPDBpsWz3o4tzjHuyIbOWPKgzHXBD/5Ms0O+7blCUW/6E3omzCa2UJ4Nt0z8?=
	=?iso-8859-1?q?eewopz03Guhm1CB5CGuNaYJF+RPa35lAnNExSLhuHdONlW3K70RWCRVRE6Ju?=
	=?iso-8859-1?q?81p3+1EcHPR3i3PYX9ZWipRDwIkKlbsbJVWJmwVqmgpUpl4n0M9bvgM2s3Pi?=
	=?iso-8859-1?q?FqTqu5/FlLH4Y+70FTq/mLW5tde1XFbAt0loVtb7dnyWOWuvp9lZkVPWKTFY?=
	=?iso-8859-1?q?w07GiLuL0iL5wqyNezo7t0ATr6vyscJPxfq/7EE/hFZbvdcuR3u3ftYFTkQc?=
	=?iso-8859-1?q?s6Wa1WO+Gd9uq/Tiys/uq0dEkq8gVggf6H5H9F9bnxK2we6/MDTGh9miLqXD?=
	=?iso-8859-1?q?bAGCJeLjFS1eHv0meyBzgsI8jX9TzUf30HzpVQte+yU/LTxNOwgn/zSCERDX?=
	=?iso-8859-1?q?8YdksqhSHxjncolJxIlEjeisnjy+QVgpq9mn0gtAgOWYaXvkxJesB5/sMJxn?=
	=?iso-8859-1?q?6XrHSvspAf7AY7GJoHZe8rKdqRegmVvSUnGwHK3RfIeJehwdGR1xIDyxp6uW?=
	=?iso-8859-1?q?/e9D/ardDkzyVojjcNgTexYDEGNd7kKYbxD81M05forV1tbv84uobh9KU6I1?=
	=?iso-8859-1?q?lUd3+09BY5VwRq7xnZrTDCtXPEuGUuctLEpPEqzs702CSv9NajbIfkJzzchx?=
	=?iso-8859-1?q?Hr2ellQws4XocECiE7UxJyR7rzjks0yNc/q1pc0ZxmeRZXixpbMfxmfGONUn?=
	=?iso-8859-1?q?5DgCyC1uIZMnXhVT/kG9MH1Uh2decxHH6oZp0AeiEUF1iMIcrlA3wQBS4peQ?=
	=?iso-8859-1?q?XUvDqXLGKZhV5SYzktxVQCBxSi7Ia74BTVHqw8nQ5Frp31T2eZhu9MPGwGJW?=
	=?iso-8859-1?q?GcsNJMuXs1h7Jf9UxgzOixWCO7z2I6lmXNRtgDIdW9Yq/hO4+vCTiGUhZu4M?=
	=?iso-8859-1?q?EbFR+t4bT8xRDFwUUpUen72u9BaLZHkE12BZEh/hDUricoEogAScfpzF7W4N?=
	=?iso-8859-1?q?XmvfO12t43rTiz2OLdXVgHn1DYINnz5d3pdQ/bfMBHhpGYsMasuyLPq/87Ud?=
	=?iso-8859-1?q?WIceHu1bI+PoBQjAs5uYnKPmsHDtkD/ltXKv7N0R3nBOFTnj3iuCcojnwEtP?=
	=?iso-8859-1?q?48PfkO9q92/AA70zBgpvHvPLr/Kl+ZulQvd8rPO6KI1WTcyG6hJWz4H8DItc?=
	=?iso-8859-1?q?KrnLlxKjQ+ESGXaLxFOysnNKCqVy6+RBj+Mld3ytIE/pJ7DiJ0EWSpyPlCJV?=
	=?iso-8859-1?q?K/dNr222r2xLeqp224l5MpQRtkFYhCO3QeE8y4SeAiT7E7JVylBtavGQSjzG?=
	=?iso-8859-1?q?aUwjHBJ7Blsg4Epmq7TQBcX4BM44tQ0oCO7EvZthR3VzBpvP2sUTkxtqqrpJ?=
	=?iso-8859-1?q?ULe2sKgJR2HgKY68n39UeKzTx0ZNZ+vNz9U1YntudH6p0j2mAKE9+ceZ7DKI?=
	=?iso-8859-1?q?KP5QheMrGyIBr74O1HdaDmYN0wqtIMqzqBWxP+fkrDWudJgyofLthRZJAUZa?=
	=?iso-8859-1?q?uij71aJIJca4fQWR8u8/ydITwRMQjEacubW/HOn9Mu7/K0Qhgwbm0JAfJf9C?=
	=?iso-8859-1?q?Nq5pdcp7rECns9vcC56uY+nE/7kCcWkl6R0r3SNNCX9iNsx+aKf2I0GBW1OV?=
	=?iso-8859-1?q?cHGxVVbQAVkTmANylKVCTXF6ZHH4oW19mdg3H4g=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 0f2e4fc5-1de5-4ada-478e-08dd45ce11ef
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:48.0867 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 WEMFJQGtsOEwqDS1icEq29e3lRWMTuSxDXH7M2WBU1eRkSOHIqrwl/IfbCCg0YNOm3vSdBOT3anh5I64s0/iL6t4AzFlBmBJllrXqONRnss=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: AS2PR03MB9879
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

BRCM PCIe controller has different means of accessing to its own
config space and to device's config space. To support this quirk,
its driver uses simple heuristic:
when PCI subsystem probes Bus 0, the driver assumes
that the subsystem tries to accesses PCIe controller config space,
when PCI subsystem probes other busses, the driver uses mechanism
for device config space access. This heuristic works well when
there is only one PCIe controller in the system.
But U-Boot does not support concept of "PCI Segment", so when there
are more than one PCI controller:
- first one gets Bus address 0,
- second one - Bus address 2 and so on.
This breaks the brcm driver, because it tries to access second PCIe
controller config space as if it is device. To fix this, we introduce
additional property bus_base that holds a PCIe controller own Bus
address.
We use this property to calculate "real" Bus address for
underlying devices.
Please note that this fix may not support a case when we have
PCI-to-PCI bridges behind the second PCIe controller.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/pci/pcie_brcmstb.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/pci/pcie_brcmstb.c b/drivers/pci/pcie_brcmstb.c
index 9de5c0e980..2e58ea453e 100644
--- a/drivers/pci/pcie_brcmstb.c
+++ b/drivers/pci/pcie_brcmstb.c
@@ -202,6 +202,7 @@ struct brcm_pcie {
 	struct reset_ctl	rescal;
 	struct reset_ctl	bridge_reset;
 	const struct brcm_pcie_cfg_data *pcie_cfg;
+	uint16_t		bus_base;
 };
 
 /**
@@ -313,6 +314,7 @@ static int brcm_pcie_config_address(const struct udevice *dev, pci_dev_t bdf,
 	 * Busses 0 (host PCIe bridge) and 1 (its immediate child)
 	 * are limited to a single device each
 	 */
+	pci_bus -= pcie->bus_base;
 	if (pci_bus < 2 && pci_dev > 0)
 		return -EINVAL;
 
@@ -631,6 +633,8 @@ static int brcm_pcie_probe(struct udevice *dev)
 	u16 nlw, cls, lnksta;
 	u32 tmp;
 
+	pcie->bus_base = hose->first_busno;
+
 	/*
 	 * Deassert rescal reset for BCM2712.
 	 */

From patchwork Wed Feb  5 10:15:48 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042694
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=DLd9vKhe;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp17Y2z9yz1yQ0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:20:25 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 9382180E90;
	Wed,  5 Feb 2025 14:15:40 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="DLd9vKhe";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id 5DA4980207; Wed,  5 Feb 2025 11:16:00 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from EUR05-DB8-obe.outbound.protection.outlook.com
 (mail-db8eur05on2061f.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:2614::61f])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id 8CCCC807FB
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:55 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=YHFl/PkQnroXQ4cdzCiY+k+NdD3Plxqme9jPL4X68CJq9mFQ3Bj5GZVzHBYOGSb27Mf/UKGVmdfdPTUPrxQs+T2xcgBU7qpnrijAIikkLiqyQKgCemNcM8Fe8GFTqowaye8O3hLsJmIesEnMPaBnAcpWVkQ9dOuWuq1imbOszb9xPlb4pSQ4X1ubJRSlkErCYqO8NOfgWTGyUkhEnrdbb9e5o9PpfqNcvLJFCnRebeWhzB3Ex62ogyFTO26Rcl874pDzL3fuJ+hjrakNIEJz7Ysg69k3Ub9gnPaLxJbY1Yw5OJZBceZFFf8cw8oZmt3TUY9bvrpZy/kuhHP10okcRg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=isFTt1CLLEDWRBi4emRYVqG/FoKLgmP6uBl/mJuyzfU=;
 b=cjE4MYuU8Ww2k6Ru4BeneZAJ2Q/QwZqWop7RTykEbjzER7kY1EcK2ggcUafsiM6RAk0TGbCJvW34PD3HP0Vb9UnbTdsSdEoFPD3yFPXea7ApBTi5PVbrtPuSUsuEjLKAwUit3fFEkIIRBNMwrGLBki8SIGlz06hkOZLLh6uhi7IcsUFg4cdZe8mGVWLUlIFE2ojExKflodv0/Sr2qpMThTZBl9yBmexneIDklm2Q8S5CWKsS7F5jV19rJ/VgLrTc3QDSR0/3lHtSAr5Lxk4/dsS2jPhOXgkRVQ9lC+HhjKWYqwA2zvmcKtI5QHQUJ6El97+h6WQRdC6FkaobdNc9tw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=isFTt1CLLEDWRBi4emRYVqG/FoKLgmP6uBl/mJuyzfU=;
 b=DLd9vKheaZIZ3UlGgtTBo9woOBuOCf62xkMg9VfZ6oy5POnKiTaMkt2VXI9886H6tZV4EpMWZK6QKHatrF//tqgpipfioeJSJ8w/MBVzgi2sashRr7/kosuGFo2hy/XFV27MH004+lpKYXwp9rNyhpUcDNLyUQZucDe1Iz/17zcnBQFzqXoI698vBNAy44kr1g8qgk9dQvQ/RFzKb9WP8KvGqFmDT4MFwXYHpW3MT0XOgTr4QPCNCLnmgEgIdncvLdI7E9/rx8t4n1ioalobrTd/jWkMTbj2KgF2U4Rb3EReEeLVkrmYvo8uT0/whtLIVRDUpHL35LAwwrK+hrJarA==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by AS2PR03MB9879.eurprd03.prod.outlook.com (2603:10a6:20b:547::20)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8422.11; Wed, 5 Feb
 2025 10:15:52 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:52 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>, Tom Rini
 <trini@konsulko.com>, Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>
Subject: [RFC PATCH v1 19/20] drivers: pci: pcie_brcmstb: set correct reset
 state on pcie_remove
Thread-Topic: [RFC PATCH v1 19/20] drivers: pci: pcie_brcmstb: set correct
 reset state on pcie_remove
Thread-Index: AQHbd7bty3FajbY8+E+cVb/woGJ44w==
Date: Wed, 5 Feb 2025 10:15:48 +0000
Message-ID: 
 <857d42ec4a5e643d80abf52daf29f42bf3ea35a8.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|AS2PR03MB9879:EE_
x-ms-office365-filtering-correlation-id: 3511ccc6-4c47-45aa-39c1-08dd45ce1211
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|366016|1800799024|376014|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?AQOrNj33yKgK7O+fJILJr5E0iJ?=
	=?iso-8859-1?q?4psHt24bgkaD+sCf6IIm+QKAbxaS8KDtlksoZY3tRT1kTwC79wyOfyuMmlm7?=
	=?iso-8859-1?q?B8UBZMz57GAwR7nBk6kMFyLaXYVMg/kn9IQ+TfoxrKlNNezxGWB2LVMh4Rhb?=
	=?iso-8859-1?q?nm8/cO38A9VPidfANYrCYmPxzbAOxGeE7b18MAVlkhmM/znmBuqmrz1HkrDB?=
	=?iso-8859-1?q?whEvr2yXQCf6IrVak0xv616bBfakwyGohuq2/jSMybS3qvEngcTviV3XyItM?=
	=?iso-8859-1?q?Z/L1+0AdfU/lo6Muqg9UHHUXwOzWrFeCn4x1oE3IwnMP/nfmFtoLG/fg5U6n?=
	=?iso-8859-1?q?FH4mhApfBTjwEfTUnlgdwgJ20GlRfGaQPNkrnQtmgs22ur+75xXGsq3DN2LS?=
	=?iso-8859-1?q?ryDMqecXX7fq2q/C/iexbgfC6Iz52Z6SjD+mQXcIQ56yF2d5Ju/4J4Pn4b59?=
	=?iso-8859-1?q?vMvtVypvSeYTe1L6+j+Evkvwlcj9XcSWc8k/uOmRzLnQOF7Xtd0HkzQ7i7QS?=
	=?iso-8859-1?q?ojUjxJaWP4fDa9mJ8AK2J707rneqMxnkQ22Egb2h1cdvWmGCj5WMdHWsYwiN?=
	=?iso-8859-1?q?8uWQ8IbhDOH8wYF9hYcc5HsJkKdQtKSvwthvgsoiJ9nC5qVzSJLFWPBHsSvD?=
	=?iso-8859-1?q?9k5PiArtcqC1HHsHmzaDZnIpta1+0hUVrPU4hvlUSNdXQmPlZc9OJReau1d9?=
	=?iso-8859-1?q?CYelSwxZn0hQPsoAH/ZKP4+y0RicPuhaSyH26jTA+YpUoiyeMNi9e0Wt5N3i?=
	=?iso-8859-1?q?n4KgjcSNL8HUuqmtzPKWnCitx9LX4oajxjs6elxsxhPlFnhLz/i8qiJJo9CS?=
	=?iso-8859-1?q?6f+/WV8z6Htfdl7lw8M+BKJ5vsxlj7TZzGEnaru8gIZRGdf7oDKWiSD+8tiW?=
	=?iso-8859-1?q?PfK682PSWeeB3bmcRWI48ySuX1OiD1NIF0S7P0ftt2IYyLkkIYHrwPLXhb6O?=
	=?iso-8859-1?q?NXStitdgjcGVoD/YkumhHHPZxNcDmbWCZN7S4xzA2cDIl+fyoHaImS6b4VUM?=
	=?iso-8859-1?q?u9Rob3D3G0byn/RzDMUgtZeG7G1f91TVqAKC5gIgCn+VTWkT3/7CpooCFujl?=
	=?iso-8859-1?q?0aDgBvEoQ4fc3Q+dVam5o9CyhnSRDDQ13jgzHkMI6V1q/SeaYDNGwZpjHtFv?=
	=?iso-8859-1?q?PJcV23KrZjTZQ2FcxClBKAUhNuCRwmB4YVXyG4zZH0Xtv7FnuNeekxFJ64AK?=
	=?iso-8859-1?q?IY2aoIq0MIOHjuidyjsTciNz5R6ozNI/mHjRtQZSuiwNhcLYLZ7SadFMmNf2?=
	=?iso-8859-1?q?WC378yPo26m+BLhEcZkuwxRsPBy2ua0pkTMyXIqttFAFLNy04IoaRJhIwf+X?=
	=?iso-8859-1?q?jnoebCv64tRtjmEEpdBD0UCVc+uop7YJqDjIS+fCixPIarlwjZLBCW79asGc?=
	=?iso-8859-1?q?LZhMMdReYKjfbzoZ8l0p6DfYM/vvcVmm9MPEKMP+ki7Sds4LbAeM+HGvBAdO?=
	=?iso-8859-1?q?2z02mbA1amqXfuPWUxdZ8Xxh8BEWdd3Q0CLLWm+iKcxpbuqd7t6UveyDBORU?=
	=?iso-8859-1?q?4o16wC?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(366016)(1800799024)(376014)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?PPAiepFlvycK1QQjByjdcV/?=
	=?iso-8859-1?q?uIaWGp3K6ymmaqjS3/Bpxuxi4d54BIZ1nSJbp4FJtOzChMSUtPerdy7CWjJg?=
	=?iso-8859-1?q?SZ6DoNv7p5O7iSIxtmipwbT/YjoY6aEd3Bgiyi+YwP1o2njXegq7ANq2zTCr?=
	=?iso-8859-1?q?GnongVXXdk0VZIsO4SxQZxpqaVY+EoFsYFWBMoL34RrxADhY6E+zBzTlkN6w?=
	=?iso-8859-1?q?SfrA2+Dv11U7qdFL5nt5nFpLmknOkdiqM4Qi9ydY8ZYlAxSIjTqSpbOtXzFO?=
	=?iso-8859-1?q?PPwyIAp+bSBEaj967O9XKzO47TWcGW+HyDXcSAafh5klsaTTgci5twORB4lt?=
	=?iso-8859-1?q?P9SVZs4ZW6507anKsczrad4XPisOjCVGoYMOn3QM1zJ82ZqCJx6kfYL5Db58?=
	=?iso-8859-1?q?FLRpFZc4c9ZbFjQVMQ7IZs9PNvdIT3Q3n4wFUUqjfnCdxEjf8R4JB4S6a/Zg?=
	=?iso-8859-1?q?g0mBySngOlBDbtl/4pqycyAtP2iPcs9ITDqQlwQl1EJCSQ+1P6+Yh5auSmrf?=
	=?iso-8859-1?q?RtTeRE7d85eylQh2FTfQe9bqO1vX5+LFx1y0paaPkt/FOcFqxb3p76P8N5DH?=
	=?iso-8859-1?q?GXRd+rPrxCNHwNmy1iyljZvU7WHbllIN78YrGA2P2kAv5gWU/VJRv+J9qByt?=
	=?iso-8859-1?q?RZMSap2JJ+QbjVW2DxLLJoMK7IPhOvyQhaDDW6udMYhdoyUEVABMZF1p+HEp?=
	=?iso-8859-1?q?mBesMe66wn94EFZNbuW6B8z6VILEBhGUKj2O1ZvYnTlMb4Ygp5ri61PvpLIl?=
	=?iso-8859-1?q?SSPDrGrp+MG0r2GUGeSwgXTlQ9n9NMItmD6iDnTxycyQmawI8OpQuKm5LPc0?=
	=?iso-8859-1?q?hHWQ98T8D/8I+2VZuhcLAYPDrp7JyQlQEfTQpqPoVO1+xcDk8dHsMRt0gFv7?=
	=?iso-8859-1?q?s1NKk4MnRGa0FkFmlpXPQSXJMb4vI0egJKw5um2osK4jslDhJYTEr5bvbCaJ?=
	=?iso-8859-1?q?GJjBqIyP6eLV2fSpakavH/hvwW4T0Ca88KHB8hliVjkthCDKsGYItwj/n7iK?=
	=?iso-8859-1?q?dey/QEi5URm3vKbD0qQpRgN95aPZ0Hr+zekLQ7k/nEn4Yy1isCSpFQkSwFPf?=
	=?iso-8859-1?q?q+UQkHvT628daawssqNHoEJ3AJCH70eMHGGnM4qVK4D+G2H71941tzJP0Qta?=
	=?iso-8859-1?q?JvqJujmLeB4e/040PBpCZEpJnUcx2MfV1LHfAtzenn64EXJFEpd1lf+4j6Oa?=
	=?iso-8859-1?q?Jx8Aq42/xYZA/pBzLJjO7rASKJD5TiJHG1XzFMl5J+GK+2lBnRpWY/n6c5tg?=
	=?iso-8859-1?q?45wJOM/R0ms2sV50VTtyyD0WsnnOIxdchhPRzDI28TqoUwm9l7FN9gTS+nCY?=
	=?iso-8859-1?q?AMq2Uwvy1mbPdL7CUAFpDTJORpFrmvOO1fcS3xXdtg1sRfUy5Q/DdXiS20yc?=
	=?iso-8859-1?q?tIaN9ECmQNcY0hSK9hHH/jyu1Rc2ZD1CVbAuPAXOLAEtM8GBoLV/mPsknHZI?=
	=?iso-8859-1?q?4UOVDoxEG4KiMmzPMEyB3/6uUSAlTd+UKOf90vYwfP6l1emj9MMrmdHRimvo?=
	=?iso-8859-1?q?uMwbqzMCUJ40daGrequYxx4Mi8F19DIfU8BGBs8qf23/hwuQ5TWEEg5wyDbP?=
	=?iso-8859-1?q?586vcFTktg+wNjd9tgbXq3Sdv0o8xqggDhwjUT6db42lbgbv6luLr5JxMDuk?=
	=?iso-8859-1?q?a4JInGxGpBvqGp2xbot1YMlsQXz7oyS5K3QNsWA=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 3511ccc6-4c47-45aa-39c1-08dd45ce1211
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:48.3802 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 mfq3FByG65kEUzj4zYe+jYht65X/HSbpZP+XmXfOoryThzArGOOSES10XNslWN4FVtlbTdLaHosjubXn4TrL5t+B1a5MX8RpcLRjx6rF5q8=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: AS2PR03MB9879
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

For the controllers that are utilizing reset for bridge sw init,
such as BCM2712, reset should be deasserted after assertion.
Leaving it in asserted state may lead to unexpected hangs in
the Linux Kernel driver because it do not perform reset initialization
and start accessing the device memory.

We've met this issue on the Raspberry PI5 kernel and got the following
log:

[    1.842953] brcm-pcie 1000110000.pcie: host bridge /axi/pcie@110000 ranges:
[    1.849953] brcm-pcie 1000110000.pcie:   No bus range found for /axi/pcie@110000, using [bus 00-ff]
[    1.859104] brcm-pcie 1000110000.pcie:      MEM 0x1b00000000..0x1bfffffffb -> 0x0000000000
[    1.867407] brcm-pcie 1000110000.pcie:      MEM 0x1800000000..0x1affffffff -> 0x0400000000
[    1.875707] brcm-pcie 1000110000.pcie:   IB MEM 0x0000000000..0x0fffffffff -> 0x1000000000nc

After that system reports a context switch error after 120 sec timeout.

Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---

 drivers/pci/pcie_brcmstb.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/drivers/pci/pcie_brcmstb.c b/drivers/pci/pcie_brcmstb.c
index 2e58ea453e..c5fe5f9d20 100644
--- a/drivers/pci/pcie_brcmstb.c
+++ b/drivers/pci/pcie_brcmstb.c
@@ -851,6 +851,16 @@ static int brcm_pcie_remove(struct udevice *dev)
 	/* Shutdown bridge */
 	pcie->pcie_cfg->bridge_sw_init_set(pcie, 1);
 
+	/*
+	 * For the controllers that are utilizing reset for bridge Sw init,
+	 * such as BCM2712, reset should be deasserted after assertion.
+	 * Leaving it in asserted state may lead to unexpected hangs in
+	 * the Linux Kernel driver because it do not perform reset initialization
+	 * and start accessing device memory.
+	 */
+	if (pcie->pcie_cfg->type == BCM2712)
+		pcie->pcie_cfg->bridge_sw_init_set(pcie, 0);
+
 	return 0;
 }
 

From patchwork Wed Feb  5 10:15:48 2025
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
X-Patchwork-Id: 2042697
X-Patchwork-Delegate: pbrobinson@gmail.com
Return-Path: <u-boot-bounces@lists.denx.de>
X-Original-To: incoming@patchwork.ozlabs.org
Delivered-To: patchwork-incoming@legolas.ozlabs.org
Authentication-Results: legolas.ozlabs.org;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.a=rsa-sha256
 header.s=selector1 header.b=dkl1DIPi;
	dkim-atps=neutral
Authentication-Results: legolas.ozlabs.org;
 spf=pass (sender SPF authorized) smtp.mailfrom=lists.denx.de
 (client-ip=2a01:238:438b:c500:173d:9f52:ddab:ee01; helo=phobos.denx.de;
 envelope-from=u-boot-bounces@lists.denx.de; receiver=patchwork.ozlabs.org)
Received: from phobos.denx.de (phobos.denx.de
 [IPv6:2a01:238:438b:c500:173d:9f52:ddab:ee01])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature ECDSA (secp384r1))
	(No client certificate requested)
	by legolas.ozlabs.org (Postfix) with ESMTPS id 4Yp1846TDdz1yQ0
	for <incoming@patchwork.ozlabs.org>; Thu,  6 Feb 2025 00:20:52 +1100 (AEDT)
Received: from h2850616.stratoserver.net (localhost [IPv6:::1])
	by phobos.denx.de (Postfix) with ESMTP id 1BA4680EFB;
	Wed,  5 Feb 2025 14:15:42 +0100 (CET)
Authentication-Results: phobos.denx.de;
 dmarc=pass (p=quarantine dis=none) header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=u-boot-bounces@lists.denx.de
Authentication-Results: phobos.denx.de;
	dkim=pass (2048-bit key;
 unprotected) header.d=epam.com header.i=@epam.com header.b="dkl1DIPi";
	dkim-atps=neutral
Received: by phobos.denx.de (Postfix, from userid 109)
 id DA04980207; Wed,  5 Feb 2025 11:16:01 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on phobos.denx.de
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
 DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_BLOCKED,
 SPF_HELO_PASS,SPF_PASS autolearn=ham autolearn_force=no version=3.4.2
Received: from DUZPR83CU001.outbound.protection.outlook.com
 (mail-northeuropeazlp170130004.outbound.protection.outlook.com
 [IPv6:2a01:111:f403:c200::4])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested)
 by phobos.denx.de (Postfix) with ESMTPS id D1EE180762
 for <u-boot@lists.denx.de>; Wed,  5 Feb 2025 11:15:56 +0100 (CET)
Authentication-Results: phobos.denx.de; dmarc=pass (p=quarantine dis=none)
 header.from=epam.com
Authentication-Results: phobos.denx.de;
 spf=pass smtp.mailfrom=Oleksii_Moisieiev@epam.com
ARC-Seal: i=1; a=rsa-sha256; s=arcselector10001; d=microsoft.com; cv=none;
 b=qtlxa+PFmqjx/cF9JFfJu/Kjylgh5TMeBv5iU2QnPbwCFdAAGgrHvuzsrC8YSfOhy3X+nuq6YJA8KwoDS4QgRk77HknNZMg0a+peW8tgmE5WigUWHwms9gySw8l3f4lOjhw4M62Xoqv+stByG2TRL/z//SqiUaQSojfPsKB5VVmPOksnbdJqO8Xpb8TVy86XeyGfS4VTjOY4Xt7JH+/zc6WunWema6ej4SJPeienzzu5jOkkcWBwjzIAHA+7erkWV3j2gOf8Wl01ijnSEw9cdleOZKfkekOIPoL9tbo2D/0KSWR4lC5iOLWuiZPk1hmAuU13irqgLT5FXr4By/frRw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector10001;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-AntiSpam-MessageData-ChunkCount:X-MS-Exchange-AntiSpam-MessageData-0:X-MS-Exchange-AntiSpam-MessageData-1;
 bh=jSElq+PL1nRdZyrbvVqqaQou3N3sLZXtfGeYXZdeeYQ=;
 b=KlG0A6S5dfSPyR2vSTlLVPDd0YiHODsRayHBjDVYkG5IndsqTkZzJYvLp5yqUI5DF6wUV0JRhQr3Ue2h/urz9Wp42Uh1zLv2Qkb/PY1fjyXGsVoy1hdC1fxINf3/D3unzW1nM+NNAM1qIztWAMkvr6M8WIpfI+biI22pmHIF49aBfCiJEoH7utbhPFlwBO/Y8/ZnxCYb54cenOMQxNmItbh7LdlQwm9elQHjbRGrkazKH19qIYa89E+zCh1kK/gxXzFmS3dKlxO7eGHTaYvYcS5UmG+NoB6UVAvCzXG0UgyZUybuKwdSiYkykmSIr32szCEMMNy3sm5N6kScFrXi7w==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=epam.com; dmarc=pass action=none header.from=epam.com;
 dkim=pass header.d=epam.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=epam.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=jSElq+PL1nRdZyrbvVqqaQou3N3sLZXtfGeYXZdeeYQ=;
 b=dkl1DIPiwxxH1df9f08/FY0UYp3yoIFHKIt2/mV33Axehl3r1+QxIJELdiJ72zBTc50iTxWo1eosb6B4weUWD/AIP3nTBoufMg9T8nSHgKbz7QJp7z3h44pXO9CBDRJZzqNmUTNSOGvAPe6rPVFzddsQxuRYPbi6gQsfcsXHeL7cYN/44KT2Ui0yIX1xfvGPZJq3TDNRgBH00vbcLPJfxvJAGrcIm0JR/Rc8BALH23kfU7yulgae/AOwkIqUchrAvjmfGojDV1h5uRqRwCi6IY5B42AL7I+TqQS/zdu6uE8DTBsuF4JUD0Y/e3+8U3DG9MraIUomWZ3rMVlCylheFw==
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com (2603:10a6:102:32e::21)
 by PAVPR03MB9336.eurprd03.prod.outlook.com (2603:10a6:102:30b::17)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.8398.24; Wed, 5 Feb
 2025 10:15:54 +0000
Received: from PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc]) by PAVPR03MB8946.eurprd03.prod.outlook.com
 ([fe80::f12d:7394:bbe3:dfc%6]) with mapi id 15.20.8398.025; Wed, 5 Feb 2025
 10:15:54 +0000
From: Oleksii Moisieiev <Oleksii_Moisieiev@epam.com>
To: "u-boot@lists.denx.de" <u-boot@lists.denx.de>
CC: Volodymyr Babchuk <Volodymyr_Babchuk@epam.com>, Oleksii Moisieiev
 <Oleksii_Moisieiev@epam.com>, Tom Rini <trini@konsulko.com>
Subject: [RFC PATCH v1 20/20] bcm2712: enable linux kernel image header
Thread-Topic: [RFC PATCH v1 20/20] bcm2712: enable linux kernel image header
Thread-Index: AQHbd7btQUke+GD7XEqvTxcwYzoQPw==
Date: Wed, 5 Feb 2025 10:15:48 +0000
Message-ID: 
 <fb1005ae274eee0f539564a4a3c1f6fc9350f40c.1738749764.git.oleksii_moisieiev@epam.com>
References: <cover.1738749764.git.oleksii_moisieiev@epam.com>
In-Reply-To: <cover.1738749764.git.oleksii_moisieiev@epam.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: dkim=none (message not signed)
 header.d=none;dmarc=none action=none header.from=epam.com;
x-ms-publictraffictype: Email
x-ms-traffictypediagnostic: PAVPR03MB8946:EE_|PAVPR03MB9336:EE_
x-ms-office365-filtering-correlation-id: 29481125-da80-44b0-2b9d-08dd45ce132b
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
 ARA:13230040|1800799024|376014|366016|38070700018;
x-microsoft-antispam-message-info: =?iso-8859-1?q?oZymarK7cu68ukanEnVnOO4+qg?=
	=?iso-8859-1?q?DqsBdkSumbVu1w39p73h5g91iWnxi+KxP7Vcum0vSaRv8WtK5uZRmj85vujy?=
	=?iso-8859-1?q?otMMwKRLvCWgjVV9Dl294BAOpHc242inLgpwfcRMyjY+lV0YY6z/KbG7DIyK?=
	=?iso-8859-1?q?THlNKS2BfW/p3Lw80nzHkIJohCU9pXPnxbsjJl7Vo6brBW9CGmxqqPPLRuhH?=
	=?iso-8859-1?q?mxyrG+coVtXX4dmCjzey+8MZMSDzu4ZA4a8ZbITlpGBUmrP7OjuIg82gtN4K?=
	=?iso-8859-1?q?h7oepKlFzTcBI9/lE79BaWnkditI1DvzJNgq/5ugmeZcHvaaVZGCyfu4onX0?=
	=?iso-8859-1?q?d7Y7LpOwGLjPwzniukYB2omMUBc3SUncWY+/08NAt//zvFUSr/1IJf87X4Cc?=
	=?iso-8859-1?q?DnE7b+1yXE7+HEYVM5X6qnr4w1i25DASioncy9s2qwwSeLCSZ9BcRIg5fB3c?=
	=?iso-8859-1?q?l4L4v4JDUhSQSKDe5MkWO1mmjlQQCSe5IvuaJJ7hZryiujCIJ2VjLiX/PdMU?=
	=?iso-8859-1?q?eYfru3vsOuHF0TuCAuJv5o3a8CpiPzHbVvF/ZitIdVyNdPIGMB2enBRDOaVM?=
	=?iso-8859-1?q?bEq7muv96k7JSf2le2+x9aLjcWeAaoQxJthViU5hJB6rqV2oPFDbcvNWFwUt?=
	=?iso-8859-1?q?btyapPvKABf68vQzcIhURxqTgLgq2d5Aq8Afe13ZD8kqg2LdeKE+LSYA6qFU?=
	=?iso-8859-1?q?1bwMXDUwH/0X+DoLKh62ZleT818EykKLGDq/VQ4XGfraRhws7HjDoP/QnPOR?=
	=?iso-8859-1?q?RrWoNscGvQn4VWUTEZPdf7uaF04ZzAPunDK3tDzyTAfNTpTbJ7CH88eydkp0?=
	=?iso-8859-1?q?/E7ivlSDxnup6/iFj5Ze5YB2qZjbw3EHc+RlubqQWteRN+YHk3Ngvt5YAeXV?=
	=?iso-8859-1?q?9/RZjUFhYqxmWMrhU/n12K715FI5CHsg44ypZOSxMLMhPNb+PU1Q3F44Y6yp?=
	=?iso-8859-1?q?XzdQj6vsw3AkQdWQ2Lnzi4jzB/cW/NUX9h1CIENXC7nvvtsKfpWL46froRiU?=
	=?iso-8859-1?q?bMSy+32wyFpYvvlL4cNfy/CmBia8Hhg5tJbP6J+WaTkFOeNyAZscu0aZIgzm?=
	=?iso-8859-1?q?aMuXppiVFcuy1mU2KsjvJqOcomuogOJhSeSvaMLWOTBnoKWCrwrFruWD93M4?=
	=?iso-8859-1?q?TRcFEbREl8/3R8xtn/1Zl+1NYfI3cqJE8cI3lJsHclq7ttxF2eLJHjc2B/55?=
	=?iso-8859-1?q?Pze4Xqwl5vwxd9Ny6ZmH+9yIRvz7PfTr9A45PY1oyx3CcmIY/VdpJE6vch1J?=
	=?iso-8859-1?q?TgEYLTB9yD/iYJSuGN+0dqXXbrEBTKis6BW8UQ+T2G3xmc8uudN96aEQNsI1?=
	=?iso-8859-1?q?0LB3yzNbjabwDc4JNsptNzydePGSaLsNxscLX0OIItlsN8NQOUfuqj+TXFEV?=
	=?iso-8859-1?q?lppY7aFmGDSkQZ296NGDbDvOeHfI8cxENlYLsn2X0r0SfqoZWbuglZTwd9L3?=
	=?iso-8859-1?q?Yj+tPKRX7lCTFDu/zYoZiqmx/dxVI73ZKbN9i8/HG7gBoH039n5l+lSqvS7a?=
	=?iso-8859-1?q?4YvYEX?=
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:PAVPR03MB8946.eurprd03.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(13230040)(1800799024)(376014)(366016)(38070700018); DIR:OUT; SFP:1101;
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?iso-8859-1?q?395U8kffpxtLvoZkpOMLewj?=
	=?iso-8859-1?q?rriSrP4Y4vcjUhKDRpVih21Z4BpBN3A5x0yD+bNp4EXw+I3U29MJVe4XD9Z6?=
	=?iso-8859-1?q?gN8FQH3I0619mqPA/wqUnnFT04n2cZaJa75sq9xZeTMTcl1urRH1CGh1PnU4?=
	=?iso-8859-1?q?SHYDnKnYxdSD6iYucs99IFfrCFQqUMvcF5NUp6l1xyhEfiipA7wfnm8qTMCK?=
	=?iso-8859-1?q?KUJGlA2WJ2PZQ+ulkQdyv1TiMu9svVhmPvX7oyxPwiPEJCR7geXhIfEVfDcm?=
	=?iso-8859-1?q?Xpc9a3Fopm2O38NOIqWhoCgv/+9ZiDGhGo/iDeuzJCOiPUkvLU/kt2e5/IaD?=
	=?iso-8859-1?q?X9wNARTTSkIBUSfc3GQKNl9LEIVFmAJE0qB7nKvxYct0zEe3HoawIx0EQpN3?=
	=?iso-8859-1?q?DzyhvVIxJ9hlmRLEj1KKGCaU79RfgUaa0Aoi+qwND5pA9YQ6+Rr01rGjHCpz?=
	=?iso-8859-1?q?7fh6wgo0PJP8jSWI6QvjDbqSX/gYEHOt5yxeGGYmVrjWANOkpf3KgX629v2i?=
	=?iso-8859-1?q?NybuMrTZh4sJUQQ0jxm9p++nN8ppyvKxCKJFNLssfTWrwLbrKDoixjbjX8qD?=
	=?iso-8859-1?q?d8A6uShgjzoqCDA6ZHZkwHgXUlovX9a/AhUhSswsavJOAiKLGoDQ7aiPcNss?=
	=?iso-8859-1?q?yiGqfjQiIU3bn/EZtvA0x/+YQwG8/oSWNBBZfdObGw1cL4Y9+2kiHKAXiaTw?=
	=?iso-8859-1?q?LX9U5sWfLmBXePQwdoQ00X7AnxBgYlk6fMlcCtdCdS4HHTyZCVC3undivThS?=
	=?iso-8859-1?q?fD+EnwglXivO4kySQS8dxX4KmHEhovOLkOz1KYvuSZgDJKKk173o5Wzzc2/O?=
	=?iso-8859-1?q?1zfG+c8ePPaJLt6g+pO8mFsJqjUWsQwmkvPJpyKgHtBaMcrOx0P+kdN1XpF/?=
	=?iso-8859-1?q?iCmOeeNyvzYaqbUJ0IIyEIznEC+hKOUVL5VmnX41IYe3RXV7/0XIkLQ7rMzM?=
	=?iso-8859-1?q?A0g3dFxKLaQxnHfi8OVezvdpKIRqxfwyn+3eU8yUNX/NUFM1bgidvnccYwLU?=
	=?iso-8859-1?q?jutBcZQfX2r6J+eWWorQZt42dPBdsnvOOEvtY/cBenVkqMYVFXlED1a8XOwD?=
	=?iso-8859-1?q?poZCDSCizOAr65KZ7hj+kEd2y9vkhVU5WwBmYN3GAL0VcIlaBNe49/urWUMk?=
	=?iso-8859-1?q?OisnAK5vicRGvOTgXahBTVLSAzDWN0QGM9350R847VWDucqcfrkiU6IdbXc4?=
	=?iso-8859-1?q?11fodZV5FBEu8r610pQkZzB4fNiXW/q/yPqg9+VFRc6s4M+THH45GGqMzk/A?=
	=?iso-8859-1?q?zCGbPAMn1xd0WmjeKzyAYqUAetuVNN1IVpLsXBzV7EYEIgwz6cS0HE8oGopg?=
	=?iso-8859-1?q?7q//7kjPENQw9sEvPmZ9YyvbTg/iFNfnaODdZruJUVudKGxbDzZKh+KVgJNv?=
	=?iso-8859-1?q?xPqBqQxBuGi7QMFUJ54UcENftL6RuxuGfiZ3U1apEG9g6fLt/GTiI9j9YLvv?=
	=?iso-8859-1?q?Y4GDigcCjL32JDVUP4DVOHLJgAbPB9Gwovi2EytK1CfWE7UO+xD+L/RrMLjO?=
	=?iso-8859-1?q?yp1pSTxev+lUFVT5yWhLBSu3RdtM8CX1YLe8SsenG8QpLnJ92JlHCJyh1UiI?=
	=?iso-8859-1?q?q3fUJs2jwEDs6m+8o2rWwEcZ24TsKscSlrZWxEdUdrDlKD71yitvdI1tnllG?=
	=?iso-8859-1?q?MwnIATKhhTCRTLMqE2OR6Rx6yX5n0MUQ3wFM5rg=3D=3D?=
MIME-Version: 1.0
X-OriginatorOrg: epam.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: PAVPR03MB8946.eurprd03.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 
 29481125-da80-44b0-2b9d-08dd45ce132b
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Feb 2025 10:15:48.7317 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: b41b72d0-4e9f-4c26-8a69-f949f367c91d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: 
 P9MSn4Nazese649Fd8R8b9xBjgM+z+HCoQVekgHTWKF65Q7KzRP1jxAQRtvfEGdmRu/pCdFVFqAM4IQUzxZ8bLV1ZN/9uYi5E3K8U31iDow=
X-MS-Exchange-Transport-CrossTenantHeadersStamped: PAVPR03MB9336
X-Mailman-Approved-At: Wed, 05 Feb 2025 14:15:26 +0100
X-BeenThere: u-boot@lists.denx.de
X-Mailman-Version: 2.1.39
Precedence: list
List-Id: U-Boot discussion <u-boot.lists.denx.de>
List-Unsubscribe: <https://lists.denx.de/options/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=unsubscribe>
List-Archive: <https://lists.denx.de/pipermail/u-boot/>
List-Post: <mailto:u-boot@lists.denx.de>
List-Help: <mailto:u-boot-request@lists.denx.de?subject=help>
List-Subscribe: <https://lists.denx.de/listinfo/u-boot>,
 <mailto:u-boot-request@lists.denx.de?subject=subscribe>
Errors-To: u-boot-bounces@lists.denx.de
Sender: "U-Boot" <u-boot-bounces@lists.denx.de>
X-Virus-Scanned: clamav-milter 0.103.8 at phobos.denx.de
X-Virus-Status: Clean

From: Volodymyr Babchuk <volodymyr_babchuk@epam.com>

This change is needed to make OP-TEE operable on RPI5.

This is somewhat convoluted, but in the essence, OP-TEE image is being
loaded at address 0x80000 and we can't change that. Problem is that
last versions (like 2024/06/05) of RPI5 firmware tries to load
non-kernel images to the same address 0x80000, thus, overwriting
OP-TEE image.

This patch enables Linux kernel image for U-Boot, so firmware will
treat U-Boot as a kernel image, placing it at different address,
namely at 0x200000.

Signed-off-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
Reviewed-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Tested-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
Signed-off-by: Oleksii Moisieiev <oleksii_moisieiev@epam.com>
---

 arch/arm/mach-bcm283x/Kconfig | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/arch/arm/mach-bcm283x/Kconfig b/arch/arm/mach-bcm283x/Kconfig
index c7509146be..9cc8f66de1 100644
--- a/arch/arm/mach-bcm283x/Kconfig
+++ b/arch/arm/mach-bcm283x/Kconfig
@@ -46,8 +46,12 @@ config BCM2711_64B
 
 config BCM2712
 	bool "Broadcom BCM2712 SoC support"
+	select LINUX_KERNEL_IMAGE_HEADER
 	depends on ARCH_BCM283X
 
+config LNX_KRNL_IMG_TEXT_OFFSET_BASE
+	default TEXT_BASE
+
 menu "Broadcom BCM283X family"
 	depends on ARCH_BCM283X
 
